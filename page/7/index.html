<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="曲肱而枕">
<meta property="og:type" content="website">
<meta property="og:title" content="Lucia">
<meta property="og:url" content="http://lupeipei.github.io/page/7/index.html">
<meta property="og:site_name" content="Lucia">
<meta property="og:description" content="曲肱而枕">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lucia">
<meta name="twitter:description" content="曲肱而枕">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lupeipei.github.io/page/7/"/>





  <title> Lucia </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lucia</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/09/30/web-together-build-4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/30/web-together-build-4/" itemprop="url">
                  Together网站搭建之踩坑系列4
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-30T07:42:25+08:00">
                2017-09-30
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/30/web-together-build-4/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/30/web-together-build-4/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>这是功能实现的第三篇，扯一扯<strong>如何添加省市自治区地址, 并实现热门城市筛选功能</strong>。</p>
<p>完整作品源码及效果，看这里<a href="https://togetherisbetter.cn/" target="_blank" rel="external">作品网站</a>,   <a href="https://github.com/Lupeipei/Together" target="_blank" rel="external">作品源码</a>。</p>
<h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul>
<li><a href="https://lupeipei.github.io/2017/09/28/web-together-build-2/">给活动添加收藏功能，并使用Ajax进行优化</a></li>
<li><a href="https://lupeipei.github.io/2017/09/29/web-together-build-3/">给活动Events添加分类筛选</a></li>
<li>添加省市自治区地址, 并实现热门城市筛选</li>
<li><a href="https://lupeipei.github.io/2017/10/01/web-together-build-5/">添加时间筛选</a></li>
<li><a href="https://lupeipei.github.io/2017/10/02/web-together-build-6/">添加评论区，并使用ajax优化</a></li>
<li><a href="https://lupeipei.github.io/2017/10/03/web-together-build-7/">实作活动申请</a></li>
<li><a href="https://lupeipei.github.io/2017/10/04/web-together-build-8/">在个人中心实作密码修改</a></li>
</ul>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>先说<strong>如何添加省市区地址</strong>。</p>
<p>上效果图：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79ly1fjzauggy8ig30zh0i2aby.gif" alt=""></p>
<p><strong>Step1、安装相应的gem及配件</strong></p>
<ul>
<li><p>在gemfile中添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem &apos;china_city&apos;</div></pre></td></tr></table></figure>
</li>
<li><p>终端运行：<code>bundle install</code></p>
</li>
<li><p>在<code>app/assets/javascripts/application.js</code>中，添加：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//= require jquery</span></div><div class="line"><span class="comment">//= require 'china_city/jquery.china_city'</span></div></pre></td></tr></table></figure>
<p>注意：如果文件中已经添加了jquery， 则无需再添加</p>
</li>
<li><p>在<code>config/routes.rb</code>中添加：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mount ChinaCity::Engine =&gt; <span class="string">'/china_city'</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>Step2、使用</strong></p>
<p>代码以together网站为例</p>
<ul>
<li><p>给event添加省区、城市栏位，终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g migration add_province_and_city_to_events</div></pre></td></tr></table></figure>
<p>修改<code>db/migration/xxx_add_province_and_city_to_events</code>:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddProvinceAndCityToEvents</span> &lt; ActiveRecord::Migration[5.0]</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change</span></span></div><div class="line">    add_column <span class="symbol">:events</span>, <span class="symbol">:province</span>, <span class="symbol">:string</span></div><div class="line">    add_column <span class="symbol">:events</span>, <span class="symbol">:city</span>, <span class="symbol">:string</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>终端运行：<code>rake db:migrate</code></p>
</li>
<li><p>将新增的province，city添加到<code>app/controllers/events_controller.rb</code>的params中。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">event_params</span></span></div><div class="line">-  params.<span class="keyword">require</span>(<span class="symbol">:event</span>).permit(<span class="symbol">:title</span>, <span class="symbol">:logo</span>,.....)</div><div class="line">+  params.<span class="keyword">require</span>(<span class="symbol">:event</span>).permit(<span class="symbol">:province</span>, <span class="symbol">:city</span>, <span class="symbol">:title</span>, <span class="symbol">:logo</span>,.....)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p>在events的<code>new.html.erb</code> 及<code>edit.html.erb</code>中添加如下代码, 让用户新建活动时选择省市区：【这里是用simple_form格式】</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line">&lt;div class="form-group"&gt;</div><div class="line">   &lt;div class="city-group"&gt;</div><div class="line">     &lt;%= f.select :province, ChinaCity.list.unshift(["--省份--", 230000]), &#123;&#125;, class: "city-select"%&gt;</div><div class="line">     &lt;%= f.select :city, ChinaCity.list(f.object.province).presence || [["--城市--", 230900]], &#123;&#125;, class: "city-select"%&gt;</div><div class="line">   &lt;/div&gt;</div><div class="line"> &lt;/div&gt;</div><div class="line"> ......</div></pre></td></tr></table></figure>
</li>
<li><p>回显省份及城市，这里，在需要回显的地方, 如index页面，添加如下代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;% @events.each do |event| %&gt;</div><div class="line">......</div><div class="line">	&lt;div class="city"&gt;</div><div class="line">      &lt;%= ChinaCity.get(event.province) %&gt; - &lt;%= ChinaCity.get(event.city)%&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">.....</div></pre></td></tr></table></figure>
<p>这里，显示的都是XX省XX市， 如果只希望显示城市， 且没有”市”这个后缀，可以改成：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;% @events.each do |event| %&gt;</div><div class="line">......</div><div class="line">	&lt;div class="city"&gt;</div><div class="line">      &lt;%= ChinaCity.get(event.city).split("市").first %&gt;</div><div class="line">	&lt;/div&gt;</div><div class="line">.....</div></pre></td></tr></table></figure>
</li>
</ul>
<p>OK！</p>
<p>接下来，看看如何实现热门城市筛选功能。</p>
<p>上效果图：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fjzaug4ip2g30zh0i21kz.gif" alt=""></p>
<p><strong>Step1、建model</strong></p>
<ul>
<li><p>建立city model，终端运行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rails g model city city:string</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
</li>
<li><p>这里，为了跟ChinaCity中城市的<a href="http://www.stats.gov.cn/tjsj/tjbz/xzqhdm/201504/t20150415_712722.html" target="_blank" rel="external">行政区划代码</a>保持一致，在<code>app/models/city.rb</code>中，添加了北上广深杭州，成都的行政区划代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">City</span> &lt; ApplicationRecord</span></div><div class="line"></div><div class="line"> + CITY = [<span class="string">"110000"</span>,<span class="string">"310000"</span>,<span class="string">"440100"</span>,<span class="string">"440300"</span>,<span class="string">"330100"</span>,<span class="string">"510100"</span>]</div><div class="line"> + validates_inclusion_of <span class="symbol">:city</span>, <span class="symbol">:in</span> =&gt; CITY</div><div class="line"></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>BTW，最开始的时候，我想着如果根据活动添加的情况，将所有出现的city都罗列出来，那这个筛选项就是动态的，可能存在并发的情况，固定城市反而更好。</p>
</li>
<li><p>在seeds文档中，添加如下代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># City部分</span></div><div class="line">City.delete_all</div><div class="line"></div><div class="line">City.create!(<span class="symbol">city:</span> <span class="string">"110000"</span>)</div><div class="line">City.create!(<span class="symbol">city:</span> <span class="string">"310000"</span>)</div><div class="line">City.create!(<span class="symbol">city:</span> <span class="string">"440100"</span>)</div><div class="line">City.create!(<span class="symbol">city:</span> <span class="string">"440300"</span>)</div><div class="line">City.create!(<span class="symbol">city:</span> <span class="string">"330100"</span>)</div><div class="line">City.create!(<span class="symbol">city:</span> <span class="string">"510100"</span>)</div></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>Step2、添加城市列表筛选</strong></p>
<ul>
<li><p>显示筛选项，在events的 <code>index.html.erb</code>中，添加如下代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;div class="submenu" style="margin-bottom: 3px;"&gt;</div><div class="line">  &lt;span&gt;&lt;i class="fa fa-paper-plane fa-lg"&gt;&lt;/i&gt; 城市: &lt;/span&gt;</div><div class="line">  &lt;div class="btn-group" style="margin-left: 20px;"&gt;</div><div class="line">    &lt;%= link_to "全部", events_path, :class =&gt; "btn btn-default btn-group #&#123;(params[:city].blank?)? "active" : ""&#125;"%&gt;</div><div class="line">    &lt;% City.all.each do |c| %&gt;</div><div class="line">      &lt;%= link_to ChinaCity.get(c.city).split("市").first, events_path(city: c.city), :class =&gt; "btn btn-default btn-group #&#123;(params[:city] == c.city)? "active" : "" &#125;"%&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>在<code>event.rb</code>中加入以下代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scope <span class="symbol">:by_city</span>, -&gt;(c)&#123;where( <span class="symbol">:city</span> =&gt; c )&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>在<code>events_controller.rb</code>，添加如下代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> <span class="function"><span class="keyword">def</span> <span class="title">index</span></span></div><div class="line">   @events = Event.order(<span class="string">"created_at DESC"</span>)</div><div class="line">......</div><div class="line"> + <span class="keyword">if</span> params[<span class="symbol">:city</span>].present?</div><div class="line"> +  @events = @events.by_city(params[<span class="symbol">:city</span>]).order(<span class="string">"created_at DESC"</span>)</div><div class="line"> + <span class="keyword">end</span></div><div class="line"> <span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>做到这里，试一试筛选功能，你会发现一个bug，直辖市是筛选不出来的，比如北京，上海这种，怎么回事？</p>
<p>因为这些市，保存在了province这个栏位里面，而它们对应的city则保存了“市辖区”，“县”对应的区划代码。我们来修改一下：</p>
<ul>
<li><p>在<code>events_controller.rb</code>，对于create部分，做如下修改：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span></span></div><div class="line">  @event = Event.new(event_params)</div><div class="line">  @event.user = current_user</div><div class="line">+  <span class="keyword">if</span> ChinaCity.get(@event.city) ==  <span class="string">"市辖区"</span> <span class="params">||</span> ChinaCity.get(event.city) == <span class="string">"县"</span></div><div class="line">+   @event.city = @event.province</div><div class="line">+ <span class="keyword">end</span></div><div class="line">  ......</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>现在试试，可以筛选啦！</p>
</li>
</ul>
<p>P.S. 是不是发现跟前面一篇添加分类筛选有相似之处？</p>
<p>参考：</p>
<p><a href="https://forum.qzy.camp/t/topic/1659/5" target="_blank" rel="external">省市区详细地址教程</a></p>
<p><a href="https://github.com/saberma/china_city" target="_blank" rel="external">Rails Engine Gem China_City</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/09/29/web-together-build-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/29/web-together-build-3/" itemprop="url">
                  Together网站搭建之踩坑系列3
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-29T06:34:34+08:00">
                2017-09-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/29/web-together-build-3/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/29/web-together-build-3/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>这是功能实现的第二篇，扯一扯<strong>如何添加分类筛选功能</strong>。</p>
<p>完整作品源码及效果，看这里<a href="https://togetherisbetter.cn/" target="_blank" rel="external">作品网站</a>,   <a href="https://github.com/Lupeipei/Together" target="_blank" rel="external">作品源码</a>。</p>
<h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul>
<li><a href="https://lupeipei.github.io/2017/09/28/web-together-build-2/">给活动添加收藏功能，并使用Ajax进行优化</a></li>
<li>给活动Events添加分类筛选</li>
<li><a href="https://lupeipei.github.io/2017/09/30/web-together-build-4/">添加省市自治区地址, 并实现热门城市筛选</a></li>
<li><a href="https://lupeipei.github.io/2017/10/01/web-together-build-5/">添加时间筛选</a></li>
<li><a href="https://lupeipei.github.io/2017/10/02/web-together-build-6/">添加评论区，并使用ajax优化</a></li>
<li><a href="https://lupeipei.github.io/2017/10/03/web-together-build-7/">实作活动申请</a></li>
<li><a href="https://lupeipei.github.io/2017/10/04/web-together-build-8/">在个人中心实作密码修改</a></li>
</ul>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>先上效果图：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fjqcf5bajjg30x40i0k2j.gif" alt=""></p>
<p><strong>如何实现？</strong></p>
<ul>
<li><p>新建model category</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rails g model category name:string</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
</li>
<li><p>在event中新增category的栏位</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rails g migration add_category_id_to_event category_id:integer</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
</li>
<li><p>建立category和event的关系，在<code>event.rb</code>中添加</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">belongs_to <span class="symbol">:categroy</span></div></pre></td></tr></table></figure>
<p><code>category.rb</code>中添加：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">has_many <span class="symbol">:events</span></div></pre></td></tr></table></figure>
</li>
<li><p>在event的new ，edit中添加如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= select_tag(:category_id, options_for_select(@categories), :prompt =&gt; &quot;类别&quot;) %&gt;</div></pre></td></tr></table></figure>
<p>如果是simple_form格式，可添加如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">%=</span> <span class="attr">f.association</span> <span class="attr">:category</span> %&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>在<code>events_controller.rb</code>中，将category_id添加到params白名单中：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">event_params</span></span></div><div class="line">  params.<span class="keyword">require</span>(<span class="symbol">:event</span>).permit(<span class="symbol">:title</span>, ......, <span class="symbol">:category_id</span>)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p>为方便后续部署到heroku,可在seeds文档中新建category。在seeds.rb中添加如下代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Category部分</span></div><div class="line">Category.delete_all</div><div class="line"></div><div class="line">Category.create!(<span class="symbol">id:</span><span class="number">1</span>, <span class="symbol">name:</span> <span class="string">"音乐"</span>)</div><div class="line">Category.create!(<span class="symbol">id:</span><span class="number">2</span>, <span class="symbol">name:</span> <span class="string">"户外"</span>)</div><div class="line">Category.create!(<span class="symbol">id:</span><span class="number">3</span>, <span class="symbol">name:</span> <span class="string">"约厨"</span>)</div><div class="line">Category.create!(<span class="symbol">id:</span><span class="number">4</span>, <span class="symbol">name:</span> <span class="string">"交友"</span>)</div><div class="line">Category.create!(<span class="symbol">id:</span><span class="number">5</span>, <span class="symbol">name:</span> <span class="string">"读书"</span>)</div><div class="line">Category.create!(<span class="symbol">id:</span><span class="number">6</span>, <span class="symbol">name:</span> <span class="string">"游戏"</span>)</div></pre></td></tr></table></figure>
</li>
<li><p>在event 的index页面显示分类列表，在event的<code>index.html.erb</code>中添加如下代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;div class="btn-group"&gt;</div><div class="line">	&lt;%= link_to "全部", events_path, :class =&gt; "btn btn-default btn-group #&#123;(params[:category].blank?)? "active" : ""&#125;"%&gt;</div><div class="line">	&lt;% Category.all.each do |c| %&gt;</div><div class="line">  	&lt;%= link_to c.name, events_path(category: c), :class =&gt; "btn btn-default btn-group #&#123;(params[:category] == c)? "active" : "" &#125;"%&gt;</div><div class="line">	&lt;% end %&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>用上scope，在<code>event.rb</code>中加入以下代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scope <span class="symbol">:by_category</span>, -&gt;(c)&#123;where( <span class="symbol">:category_id</span> =&gt; c )&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>修改<code>events_controller.rb</code>，修改index部分：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span></span></div><div class="line">  @events = Event.order(<span class="string">"created_at DESC"</span>)</div><div class="line">  <span class="keyword">if</span> params[<span class="symbol">:category</span>].present?</div><div class="line">    @events = @events.by_category(params[<span class="symbol">:category</span>]).order(<span class="string">"created_at DESC"</span>)</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>大功告成！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/09/28/web-together-build-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/28/web-together-build-2/" itemprop="url">
                  Together网站搭建之踩坑系列2
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-28T06:59:16+08:00">
                2017-09-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/28/web-together-build-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/28/web-together-build-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>打算后面写一些功能实现方面的小文章，详见目录。</p>
<p>完整作品源码及效果，看这里<a href="https://togetherisbetter.cn/" target="_blank" rel="external">作品网站</a>,   <a href="https://github.com/Lupeipei/Together" target="_blank" rel="external">作品源码</a>。</p>
<p>今天先来一个收藏功能+Ajax优化.</p>
<h4 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h4><ul>
<li>给活动添加收藏功能，并使用Ajax进行优化</li>
<li><a href="https://lupeipei.github.io/2017/09/29/web-together-build-3/">给活动Events添加分类筛选</a></li>
<li><a href="https://lupeipei.github.io/2017/09/30/web-together-build-4/">添加省市自治区地址, 并实现热门城市筛选</a></li>
<li><a href="https://lupeipei.github.io/2017/10/01/web-together-build-5/">添加时间筛选</a></li>
<li><a href="https://lupeipei.github.io/2017/10/02/web-together-build-6/">添加评论区，并使用ajax优化</a></li>
<li><a href="https://lupeipei.github.io/2017/10/03/web-together-build-7/">实作活动申请</a></li>
<li><a href="https://lupeipei.github.io/2017/10/04/web-together-build-8/">在个人中心实作密码修改</a></li>
</ul>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>先上效果图：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fjw79s6kufg30zv0j74qp.gif" alt=""></p>
<p>咱分两步走：</p>
<h5 id="Step1、制作收藏功能"><a href="#Step1、制作收藏功能" class="headerlink" title="Step1、制作收藏功能"></a>Step1、制作收藏功能</h5><ul>
<li><p>新建一个favorite model，终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rails g model favorite user_id:integer event_id:integer</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
</li>
<li><p>建立favorite与user，event的关系</p>
<ul>
<li><p>在app/models/favorite.rb中，加入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">belongs_to :user</div><div class="line">belongs_to :event</div></pre></td></tr></table></figure>
</li>
<li><p>在<code>app/models/event.rb</code>中，加入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">has_many :favorites</div><div class="line">has_many :fans, through: :favorites, source: :user</div></pre></td></tr></table></figure>
</li>
<li><p>在<code>app/models/user.rb</code>中，加入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">has_many :favorites</div><div class="line">has_many :favorite_events, through: :favorites, source: :event</div></pre></td></tr></table></figure>
</li>
<li><p>在<code>app/models/user.rb</code>中，加入是否已收藏活动的判断，及收藏与取消收藏的method：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">is_favorite_of?</span><span class="params">(event)</span></span></div><div class="line">  favorite_events.<span class="keyword">include</span>?(event)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">favorite!</span><span class="params">(event)</span></span></div><div class="line">  favorite_events &lt;&lt; event</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">unfavorite!</span><span class="params">(event)</span></span></div><div class="line">  favorite_events.delete(event)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>修改<code>config/routes.rb</code>中events 部分：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">resources <span class="symbol">:events</span> <span class="keyword">do</span></div><div class="line">  put <span class="symbol">:favorite</span>, <span class="symbol">on:</span> <span class="symbol">:member</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p>在需要添加收藏的页面，比如event的show或者index，加上收藏及取消收藏，代码以index页面为例：</p>
<p>【这里，建议你安装<code>font-awesome-rails</code>这个gem，如果没有，也没关系，用button代替即可】</p>
<p>装了<code>font-awesome-rails</code>，可以这么来：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;% @events.each do |event| %&gt;</div><div class="line">.......</div><div class="line">&lt;% if current_user &amp;&amp; current_user.is_favorite_of?(event)%&gt;</div><div class="line">    &lt;%= link_to favorite_event_path(event,type: "unfavorite"), method: :put do %&gt;</div><div class="line">    &lt;i class="fa fa-star"&gt; 已收藏 &lt;/i&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line">&lt;% else %&gt;</div><div class="line">    &lt;%= link_to favorite_event_path(event,type: "favorite"), method: :put do %&gt;</div><div class="line">    &lt;i class="fa fa-star-o"&gt; 收藏&lt;/i&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line">&lt;% end %&gt;</div><div class="line">.......</div></pre></td></tr></table></figure>
<p>没有装，咱可以这么来：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&lt;% @events.each <span class="keyword">do</span> <span class="params">|event|</span> %&gt;</div><div class="line">.......</div><div class="line">&lt;% <span class="keyword">if</span> current_user &amp;&amp; current_user.is_favorite_of?(event)%&gt;</div><div class="line">    &lt;%= link_to(<span class="string">'已收藏'</span>,favorite_event_path(event,<span class="symbol">type:</span> <span class="string">"unfavorite"</span>), <span class="symbol">method:</span> <span class="symbol">:put</span>, <span class="class"><span class="keyword">class</span>: "<span class="title">btn</span> <span class="title">btn</span>-<span class="title">default</span>") %&gt;</span></div><div class="line">&lt;% <span class="keyword">else</span> %&gt;</div><div class="line">    &lt;%= link_to(<span class="string">'收藏'</span>,favorite_event_path(event,<span class="symbol">type:</span> <span class="string">"favorite"</span>), <span class="symbol">method:</span> <span class="symbol">:put</span>, <span class="class"><span class="keyword">class</span>: "<span class="title">btn</span> <span class="title">btn</span>-<span class="title">success</span>") %&gt;</span></div><div class="line">&lt;% <span class="keyword">end</span> %&gt;</div><div class="line">.......</div></pre></td></tr></table></figure>
</li>
<li><p>编辑<code>app/controller/events_controller.rb</code>，加上favorite方法，同时在before_action中加上favorite</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">before_action <span class="symbol">:authenticate_user!</span>, <span class="symbol">only:</span> [<span class="symbol">:favorite</span>, .....]</div><div class="line"></div><div class="line">.....</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">favorite</span></span></div><div class="line">    @event = Event.find(params[<span class="symbol">:id</span>])</div><div class="line">    type = params[<span class="symbol">:type</span>]</div><div class="line">    <span class="keyword">if</span> type == <span class="string">"favorite"</span></div><div class="line">      current_user.favorite!(@event)</div><div class="line">    <span class="keyword">else</span> type == <span class="string">"unfavorite"</span></div><div class="line">      current_user.unfavorite!(@event)</div><div class="line">    <span class="keyword">end</span></div><div class="line">    redirect_to <span class="symbol">:back</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  ......</div></pre></td></tr></table></figure>
<p>到这里，功能基本OK了，下面我们请上Ajax.</p>
</li>
</ul>
<h5 id="Step2、Ajax优化"><a href="#Step2、Ajax优化" class="headerlink" title="Step2、Ajax优化"></a>Step2、Ajax优化</h5><p>目标：实现快速收藏，同时显示收藏人数</p>
<ul>
<li><p>编辑<code>app/views/events/index.html.erb</code>,把原来用作收藏的html部分删除，放入partial中：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">&lt;% @events.each do |event| %&gt;</div><div class="line">.......</div><div class="line">-  &lt;% if current_user &amp;&amp; current_user.is_favorite_of?(event)%&gt;</div><div class="line">-     &lt;%= link_to('已收藏',favorite_event_path(event,type: "unfavorite"), method: :put, class: "btn btn-default") %&gt;</div><div class="line">-  &lt;% else %&gt;</div><div class="line">-     &lt;%= link_to('收藏',favorite_event_path(event,type: "favorite"), method: :put, class: "btn btn-success") %&gt;</div><div class="line">- &lt;% end %&gt;</div><div class="line"></div><div class="line">+    &lt;div id="favorite-&lt;%= event.id %&gt;"&gt;</div><div class="line">+     &lt;%= render :partial =&gt; "favorite", :locals =&gt; &#123;:event =&gt; event &#125;%&gt;</div><div class="line">+   &lt;/div&gt;</div><div class="line"></div><div class="line">.......</div></pre></td></tr></table></figure>
</li>
<li><p>新建<code>app/views/events/_favorite.html.erb</code>， 添加如下代码到<code>_favorite.html.erb</code>中：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&lt;% if current_user &amp;&amp; current_user.is_favorite_of?(event) %&gt;</div><div class="line">    &lt;%= link_to favorite_event_path(event,type: "unfavorite"), method: :put, :remote =&gt; true do %&gt;</div><div class="line">    &lt;i class="fa fa-star"&gt; 已收藏 (&lt;span id="favorite-counts-&lt;%= event.id %&gt;"&gt;&lt;%= event.favorites.count%&gt;&lt;/span&gt;)&lt;/i&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line">&lt;% else %&gt;</div><div class="line">    &lt;%= link_to favorite_event_path(event,type: "favorite"), method: :put, :remote =&gt; true do %&gt;</div><div class="line">    &lt;i class="fa fa-star-o"&gt; 收藏 (&lt;span id="favorite-counts-&lt;%= event.id %&gt;"&gt;&lt;%= event.favorites.count%&gt;&lt;/span&gt;)&lt;/i&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line">&lt;% end %&gt;</div></pre></td></tr></table></figure>
<p>【这里默认已安装了<code>font-awesome-rails</code>这个gem】</p>
</li>
<li><p>编辑<code>app/controllers/events_controller.rb</code>, 去掉favorite中的redirect_to:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">.....</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">favorite</span></span></div><div class="line">    @event = Event.find(params[<span class="symbol">:id</span>])</div><div class="line">    type = params[<span class="symbol">:type</span>]</div><div class="line">    <span class="keyword">if</span> type == <span class="string">"favorite"</span></div><div class="line">      current_user.favorite!(@event)</div><div class="line">    <span class="keyword">else</span> type == <span class="string">"unfavorite"</span></div><div class="line">      current_user.unfavorite!(@event)</div><div class="line">    <span class="keyword">end</span></div><div class="line">  - redirect_to <span class="symbol">:back</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  ......</div></pre></td></tr></table></figure>
</li>
<li><p>新建<code>app/views/events/favorite.js.erb</code>，添加如下代码到<code>favorite.js.erb</code>中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">str = <span class="string">"&lt;%=j render :partial =&gt; "</span>favorite<span class="string">", :locals =&gt; &#123;:event =&gt; @event &#125; %&gt;"</span>;</div><div class="line">$(<span class="string">"#favorite-&lt;%= @event.id %&gt;"</span>).html(str);</div><div class="line">$(<span class="string">"#favorite-counts-&lt;%= @event.id %&gt;"</span>).html(<span class="string">"&lt;%= @event.favorites.count %&gt;"</span>);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>啦啦啦，大功告成！！</p>
<p>参考文章：<a href="https://forum.qzy.camp/t/topic/1432" target="_blank" rel="external">如何做出收藏工作的功能？</a></p>
<p><strong>稍稍加个餐：</strong></p>
<p>BTW，简单提一个在用 Ajax 优化时，遇到的bug。</p>
<p>在未登录的情况，用户进行点赞及收藏，应该跳出登录界面，但网站没有任何反应，而你的controller里面已经有了<code>before_action :authenticate_user!</code>， 貌似没起效果，怎么破？</p>
<p>上图：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fjw6juewvrg30zv0j7wji.gif" alt=""></p>
<p>附上服务器报错信息：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcly1fjw73e80pgj30mv05pt9u.jpg" alt=""></p>
<p>Google后，会发现一堆相关的，包括在<code>config/initializers/devise</code>设置<code>config.http_authenticatable_on_xhr = false</code>， 修改<code>routes.rb</code>的，设置CSRF token的……试了好些个，没能解决。比较好笑的是，最后找到的解决办法，有些过于简单，哈哈。<br>附上:</p>
<p>在<code>app/controllers/events_controller.rb</code>中，添加如下代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventsController</span> &lt; ApplicationController</span></div><div class="line">  before_action <span class="symbol">:check_user</span>, <span class="symbol">only:</span> [<span class="symbol">:favorite</span>, <span class="symbol">:like</span>]</div><div class="line"></div><div class="line">  ......</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">check_user</span></span></div><div class="line">  <span class="keyword">return</span> <span class="keyword">if</span> user_signed_in?</div><div class="line">  redirect_to new_user_session_path, <span class="symbol">error:</span> <span class="string">'请先登录'</span></div><div class="line"> <span class="keyword">end</span></div><div class="line">......</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>现在点击收藏或点赞，会跳转到登录页面，OK!</p>
<p>参考：<a href="https://stackoverflow.com/questions/45168122/rails-4-401-unauthorized-error-handling" target="_blank" rel="external">rails 4- 401 Unauthorized error handling</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/09/27/web-together-build-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/27/web-together-build-1/" itemprop="url">
                  Together网站搭建之踩坑系列1
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-27T21:53:03+08:00">
                2017-09-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/27/web-together-build-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/27/web-together-build-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="引子"><a href="#引子" class="headerlink" title="引子"></a>引子</h4><p>听闻：光说不练都是扯淡。所以决定做一个类似线下meetup召集令的网站来练练手，起名暂时叫做together，做的过程中，难免踩坑不断，不过也对ROR越来越有感觉了。</p>
<p>不多说，上成品：</p>
<p><a href="https://togetherisbetter.cn/" target="_blank" rel="external">作品网站</a></p>
<p><a href="https://github.com/Lupeipei/Together" target="_blank" rel="external">作品源码</a></p>
<p>非常欢迎拍砖。</p>
<p>有种路，叫做一步一坑，所幸坑坑有解，越踩越稳健。</p>
<p>决定列出遇到的那些坑及相关解法，给踏上踩坑之旅的小伙伴做个参考。</p>
<p>先来一波小坑。</p>
<h4 id="如何给rails项目重命名？"><a href="#如何给rails项目重命名？" class="headerlink" title="如何给rails项目重命名？"></a>如何给rails项目重命名？</h4><p>Google下，以下方法针对：rails4.0+</p>
<p>两步走：</p>
<p>1、装gem，在<code>gemfile</code>中添加：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem &apos;rename`</div></pre></td></tr></table></figure>
<p>终端执行：<code>bundle install</code></p>
<p>2、终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g rename:app_to new_name</div></pre></td></tr></table></figure>
<p>搞定。</p>
<p>stackoverflow上有不少方法，详见<a href="https://stackoverflow.com/questions/20988813/how-to-rename-rails-4-app" target="_blank" rel="external">how to rename rails4 app</a>, 不过个人觉得这个最简单易用，亲测有效。</p>
<h4 id="设置时间格式"><a href="#设置时间格式" class="headerlink" title="设置时间格式"></a>设置时间格式</h4><p>基于DRY原则，这里直接跳过strftime, 使用to_s统一进行设置：</p>
<p>1、在<code>config/application.rb</code>中，添加时区和显示格式设置，这里设置成北京时间：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">config.time_zone = <span class="string">"Beijing"</span></div><div class="line">Time::DATE_FORMATS.merge!(<span class="symbol">:default</span> =&gt; <span class="string">'%Y/%m/%d %I:%M %p'</span>, <span class="symbol">:ymd</span> =&gt; <span class="string">'%Y/%m/%d'</span>)</div></pre></td></tr></table></figure>
<p>说明：</p>
<blockquote>
<p>default是指默认的时间显示格式，根据你的需要进行设置即可，后面时间的显示就会自动采用这个默认格式了。</p>
<p>此外，这里新建了一个ymd, 只显示日期年月日，如果要用ymd, 如何引用呢？以event的created_at为例，</p>
<p>写成<code>&lt;%= event.created_at.to_s(:ymd) %&gt;</code>即可。</p>
</blockquote>
<p>2、 重启rails s服务器，大功告成。</p>
<h4 id="footer置底"><a href="#footer置底" class="headerlink" title="footer置底"></a>footer置底</h4><p>被footer置底也是折腾了不少时间的，找到了最简单的一个，附上：</p>
<p>比如说，你的<code>_footer.html.erb</code>长这样：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;div class="footer"&gt;</div><div class="line">  &lt;p class="text-center"&gt;@2017 Together All rights reserved</div><div class="line">  &lt;/p&gt;</div><div class="line">&lt;/div&gt;</div></pre></td></tr></table></figure>
<p>如何设置成置底形式？</p>
<p>在<code>application.scss</code>中，添加如下代码：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">html &#123;</div><div class="line">    min-height: 100%;</div><div class="line">    position: relative;</div><div class="line">&#125;</div><div class="line"></div><div class="line">body &#123;</div><div class="line">  margin-bottom: 80px;</div><div class="line">&#125;</div><div class="line">// footer</div><div class="line">.footer &#123;</div><div class="line">  position: absolute;</div><div class="line">  bottom: 0;</div><div class="line">  width: 100%;</div><div class="line">  height: 80px; //这里，height要 &lt;= body中的margin-bottom</div><div class="line">  text-align: center;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ok.</p>
<h4 id="部署到heroku-登录heroku，重命名了app，那么在本地如何修改？"><a href="#部署到heroku-登录heroku，重命名了app，那么在本地如何修改？" class="headerlink" title="部署到heroku,登录heroku，重命名了app，那么在本地如何修改？"></a>部署到heroku,登录heroku，重命名了app，那么在本地如何修改？</h4><p>终端输入以下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">heroku login #登录heroku</div><div class="line">git remote -v</div><div class="line">git remote rm heroku</div><div class="line">git remote -v</div><div class="line">git remote add heroku https://git.heroku.com/new-name.git #new-name指的是你app的新名字</div><div class="line">git push heroku  #最新分支:master</div></pre></td></tr></table></figure>
<p>还有多个方案可解决，参考资料：</p>
<p><a href="http://xyy601-blog.logdown.com/posts/1387963-the-basics-how-to-rename-your-heroku-app-name" target="_blank" rel="external">怎样重新命名你的heroku app的名称</a></p>
<h4 id="heroku-qiniu报错"><a href="#heroku-qiniu报错" class="headerlink" title="heroku + qiniu报错"></a>heroku + qiniu报错</h4><p>如果你的seeds文档中，有图片URL，且你的项目中使用了七牛云来存储图片，那么在部署到heroku后，</p>
<p>运行seeds文档时，终端可能会出现这样的问题：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fjp9k7eibjj30qf02fdgk.jpg" alt=""></p>
<p>这时，莫慌，莫急，不是你的问题，heroku服务器的问题，建议再次运行2～3次，如果还是报错，，第二天起个早，运行2～3次，基本就OK了。</p>
<h4 id="格式在本地显示正常，但是部署到heroku后，显示不正常，怎么破？"><a href="#格式在本地显示正常，但是部署到heroku后，显示不正常，怎么破？" class="headerlink" title="格式在本地显示正常，但是部署到heroku后，显示不正常，怎么破？"></a>格式在本地显示正常，但是部署到heroku后，显示不正常，怎么破？</h4><p>比如你安装了 ckeditor, 本地和heroku显示不一致。</p>
<p>上图：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fjp9fxghmrj30vs0id762.jpg" alt=""></p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fjp9g0moh3j30u30ev0ug.jpg" alt=""></p>
<p>先是Google，没找到相关的，然后在GitHub上，找到ckeditor的repos，看完README ,有提到deploy部分，如下：</p>
<blockquote>
<p>For Rails 4 and 5, add the following to <code>config/initializers/assets.rb</code>:</p>
</blockquote>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Rails.application.config.assets.precompile += <span class="string">%w( ckeditor/* )</span></div></pre></td></tr></table></figure>
<p>这一步我已经做了，可是并没有解决问题，不是我要找的答案，在slack上发出求助，找到了解答：</p>
<p>终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">bundle exec rake assets:precompile</div><div class="line">git add .</div><div class="line">git commit -m &quot;XXXX&quot;</div><div class="line">git push heroku master #这里你的最新分支在master</div><div class="line">heroku run rake db:migrate</div></pre></td></tr></table></figure>
<p>Ok ！</p>
<p>后续在添加<code>bootstrap-datepicker-rails</code>这个gem的时候，也遇到了一样的问题，再一次运行了一次<code>bundle exec rake assets:precompile</code>, so easy！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/09/20/living-by-changjiang-river/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/20/living-by-changjiang-river/" itemprop="url">
                  家住长江边
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-20T21:58:53+08:00">
                2017-09-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/碎语成篇/" itemprop="url" rel="index">
                    <span itemprop="name">碎语成篇</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这里是长江边的一个小镇。</p>
<p>跟所有的小镇一样，平淡而宁静。</p>
<p>小镇的夜晚，一抬头，满天星，一闪一闪，干干净净，真好看。</p>
<p>傍晚的时候，夕阳很美，你若有兴致，塞上耳机，出门，上大坝，大坝两边是青草地，风一吹，阵阵青草味扑来，真真是好闻。</p>
<p>大坝下面有家电影院，应该是这附近唯一的一家影院，环境不错，看的人也多，记得提前买票。</p>
<p>如果想要扔扔篮球，可以去附近的中学，那里有个篮球场，操场挺大，还可以跑跑步。</p>
<p>楼下有家饼店，一对夫妻开的，见人总是笑呵呵的，他们家的雪菜饼卖得很好。</p>
<p>偷懒不想做早饭的时候，可以下楼买两个解解馋，很近，骑单车过去不到5分钟，不过要起早，7点以后估计饼就卖完了。</p>
<p>离那家饼店不远，有一家蛋糕店，很传统，各式各样的糕点排在门店前面，没什么装饰，像小作坊，可是生意很好。</p>
<p>有一次踩单车路过，瞥见店长穿了件23号球衣，上面写着James，瞬间对这家蛋糕店很有好感。</p>
<p>还是那条街，有家面馆叫友达，老板忒实在，很大碗面，加一些鱼豆腐，味道很好，不过因为分量特别足，从来没有吃完过。</p>
<p>旁边也有一些快餐店，卖汉堡可乐，不过不推荐，你会失望的。</p>
<p>如果你的单车出了问题，去街角的那家，修车的是个白发爷爷，人很亲切，技术很赞，服务很贴心。</p>
<p>早上醒来的时候，你除了听到鸟鸣声，偶尔还会伴有篮球入筐的声音，那是楼下的消防队开始练球了，不要气他们扰了你的好梦，原谅他们，相信我，他们打的很铁。</p>
<p>放晴的日子，天很蓝，有云，抬头，尼玛，这天真好看。</p>
<p>我的废话说完了，去敲代码。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/09/15/add-backgroup-music/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/15/add-backgroup-music/" itemprop="url">
                  让网站声色俱佳—添加背景音乐
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-15T19:55:01+08:00">
                2017-09-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/09/15/add-backgroup-music/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/09/15/add-backgroup-music/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>之前搭建网站时，做过一个landingpage, 加入了背景音乐，觉得还挺有意思的，记录下操作步骤，以备不时之需。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>效果图：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fksf8misk7g30zi0j40yp.gif" alt=""></p>
<p>通过点击按钮来控制音乐的播放。</p>
<p>怎么做？</p>
<p><strong>三部曲，html,css, js.</strong></p>
<p>以首页为welcome的<code>index.html.erb</code>为例，简单说明。</p>
<ul>
<li>step1、在首页<code>index.html.erb</code>中，添加如下代码：</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">id</span>=<span class="string">"btn-music"</span> <span class="attr">class</span>=<span class="string">"btn-music"</span>&gt;</span><span class="tag">&lt;/<span class="name">a</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">audio</span> <span class="attr">class</span>=<span class="string">"music"</span> <span class="attr">src</span>=<span class="string">"XXX.mp3"</span> <span class="attr">autoplay</span> <span class="attr">controls</span> <span class="attr">loop</span> <span class="attr">hidden</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">audio</span>&gt;</span></div></pre></td></tr></table></figure>
<p>其中，<code>src</code>部分根据个人情况进行修改，如果音乐文件存在本地的public下，直接引用文件名，如果是网路上，直接引用网址，类似这样：<br><code>src=&quot;https://res.cloudinary.com/dfbew47j6/video/upload/v1496754060/lighthouse_s31qoc.m4a&quot;</code></p>
<ul>
<li>step2、在你的<code>welcome.scss</code>或者<code>application.scss</code>中添加以下代码：</li>
</ul>
<figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.btn-music</span> &#123;</div><div class="line">  <span class="attribute">position</span>: absolute;</div><div class="line">  <span class="attribute">top</span>: <span class="number">1rem</span>;</div><div class="line">  <span class="attribute">left</span>: <span class="number">1rem</span>;</div><div class="line">  <span class="attribute">width</span>: <span class="number">3rem</span>;</div><div class="line">  <span class="attribute">height</span>: <span class="number">3rem</span>;</div><div class="line">  <span class="attribute">margin-left</span>: <span class="number">20px</span>;</div><div class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'https://res.cloudinary.com/elliepooh/image/upload/v1491889929/music_s7aiet.svg'</span>) center center / <span class="number">100%</span> no-repeat;</div><div class="line">  <span class="attribute">cursor</span>: pointer;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.music-off</span> &#123;</div><div class="line">  <span class="attribute">background</span>: <span class="built_in">url</span>(<span class="string">'https://res.cloudinary.com/elliepooh/image/upload/v1491890054/music-off_nrnsni.svg'</span>) center center / <span class="number">90%</span> no-repeat;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>step3、在首页<code>index.html.erb</code>最下方，加入如下代码：<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line">let playMusic = true;</div><div class="line">document.getElementById("btn-music").addEventListener("click", function() &#123;</div><div class="line">  playMusic = !playMusic;</div><div class="line">  document.getElementById("btn-music").classList.toggle('music-off');</div><div class="line">  playMusic ? document.querySelector('.music').play() : document.querySelector('.music').pause();</div><div class="line">  &#125;);</div><div class="line">  worldMusic.volume = 0.8;//预设音量</div><div class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>搞定，可以愉快地听歌啦！！</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>参考资料：</p>
<p><a href="https://codepen.io/elliepooh/pen/dRPOqM/" target="_blank" rel="external">lighthouse</a><br><a href="http://web.ruby001.cn/css/64065747447400107852.html" target="_blank" rel="external">CSS中id与class共存</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/09/08/one-thursday-afternoon-without-coding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/08/one-thursday-afternoon-without-coding/" itemprop="url">
                  没有coding的周四下午
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-09-08T14:28:31+08:00">
                2017-09-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/碎语成篇/" itemprop="url" rel="index">
                    <span itemprop="name">碎语成篇</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>你清楚应该在某时做某事，但你心里满满的排斥，就是不想去做，你会怎么处理这种情况？</p>
<p>一个平淡的周四下午，一个不想coding的人，做了什么？</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>打开电脑后，看了会代码，开始神游，看到页面上一线飘红，满满的bug味，不想继续。</p>
<p>我知道我在逃避，然后我做了什么呢？找纪录片看，看电影，重新刷了一次《手机》。</p>
<p>很佩服冯小刚，拍的挺好，现在来看也是部很有意思的电影。</p>
<p>看完的整个感受是，当一个人不能真诚地对待他人时，其实反向地，他在跟自己撒谎。诱惑很多，随口一说，再巧妙的掩饰终究有不得不破的一天，我曾经感觉手机让我很分心，一度想要远离它，后来明白，让我分心的不是工具本身，而是渴望得到他人关注，不愿错过信息的心态，或者在寻找kill time的方式？擦，我竟然还有时间来kill？或者更多的是想体验及时反馈的快感。其实，当你真的专注于培养自己的技能，反而内心是愉悦的，踏实的，因为你知道你没有辜负这时光。做完一天的工作，再回头看手机，你会发现，其实并没有什么人会找你，即使有人找，那也不是什么紧要的事。而你却为了这些无谓的事而白白浪费了大量宝贵的注意力，这不是愚蠢是什么？</p>
<p>回到电影本身，出书的费老有了外遇，名嘴严守一有个长期情人，后来自己的职位反而被情人所取代了。看的过程中，我的感觉是当一个人谎话成章的时候，其实他已经养成了相应的行为模式，这个模式在他之后遇到相似情境的时候，会反复调用，然后这个模式也就会不断加强，如果这个行为模式本身就是错误的，相当于不断犯错，那么这些一个个小小的错误，慢慢积累，其效益最终必然让当事人陷入困境。而如果最开始便是以诚相待，那反而是最舒心的相处方式，当然在有些场合，我们为了照顾别人的感受，不得不说一些慌，我也觉得可以理解。《the road less travelled》里也提到这个话题，真诚，也是需要智慧的。</p>
<p>人生贵适意啊！</p>
<p>另一个很搞笑的细节是，当李燕发现费老有了外遇后，哭着说：”上网聊个天你说我堕落，说什么生命短暂，白驹过隙，你呢，你是只争朝夕。“ 有够搞笑的。我们大部分都会犯这个错误吧，对他人高要求，对自己却是低标准。嗯，我们对自己还真是非一般的宠啊！</p>
<p>不知道为什么，敲完这些字的我，反而有了要做事的冲动了。</p>
<p>也许有的时候，人在遇到不想去做的事情时总想着逃避，但逃避并不能解决任何问题，只有直面，而这个过程的转变，有些时候需要一些外力？其实道理都懂，但没能及时去制止自己，任情绪牵引，那时候的感觉就是什么也不想做，歌也不想听，代码也不想敲，连电影也不想看，可又觉得必须做点什么，结果看完一部电影，反而静下来了，也是奇怪了。</p>
<p>下次遇到同样的情境，怎么破？码字吧，写下来，就静下来了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/08/23/git-commands-summary/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/23/git-commands-summary/" itemprop="url">
                  git常用命令及报错记录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-23T22:13:22+08:00">
                2017-08-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Git/" itemprop="url" rel="index">
                    <span itemprop="name">Git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/23/git-commands-summary/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/23/git-commands-summary/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="全局设置"><a href="#全局设置" class="headerlink" title="全局设置:"></a>全局设置:</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git config —global user.name “your name”</div><div class="line">git config —global user.email your.emailaddress@example.com</div></pre></td></tr></table></figure>
<p>初始化：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git init</div></pre></td></tr></table></figure>
<p>将档案加入git 中（track files）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git add &lt;filename&gt;</div></pre></td></tr></table></figure>
<p>当前目录全部track：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m “信息”</div></pre></td></tr></table></figure>
<h4 id="分支部分："><a href="#分支部分：" class="headerlink" title="分支部分："></a>分支部分：</h4><p>新建：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git checkout -b &lt;branch_name&gt;</div></pre></td></tr></table></figure>
<p>合并：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git checkout master</div><div class="line">git merge &lt;branch_name&gt;</div></pre></td></tr></table></figure>
<p>重命名：</p>
<ul>
<li><p>非当前分支:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -m &lt;oldname&gt; &lt;newname&gt;</div></pre></td></tr></table></figure>
</li>
<li><p>当前分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -m &lt;newname&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>删除：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch -D &lt;branch_name&gt;</div></pre></td></tr></table></figure>
<p>查看所有分支：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git branch</div></pre></td></tr></table></figure>
<h4 id="Origin更换："><a href="#Origin更换：" class="headerlink" title="Origin更换："></a>Origin更换：</h4><p>本地项目新建后，去除旧链接，建立新链接，在终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git remote -v</div><div class="line">git remote rm origin</div><div class="line">git remote -v</div><div class="line">git remote add origin git@github.com:你的github用户名/your-project</div><div class="line">git push -u origin master</div></pre></td></tr></table></figure>
<h4 id="其他："><a href="#其他：" class="headerlink" title="其他："></a>其他：</h4><p>取消stage：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git reset HEAD &lt;file&gt;</div></pre></td></tr></table></figure>
<p>撤销commits :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git revert HEAD</div></pre></td></tr></table></figure>
<p>修改commits：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git commit --amend</div></pre></td></tr></table></figure>
<p>对于需要删除的commit，遵循向前的原则，继续修改，然后commit，而不是删除之前的commit</p>
<p>取消git init:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm -rf .git</div></pre></td></tr></table></figure>
<h4 id="报错记录："><a href="#报错记录：" class="headerlink" title="报错记录："></a>报错记录：</h4><h5 id="Updates-were-rejected"><a href="#Updates-were-rejected" class="headerlink" title="Updates were rejected"></a>Updates were rejected</h5><p>将本地的repos push到GitHub上时，使用<code>git push origin master</code>，报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">error: failed to push some refs to &apos;https://github.com/XXX/YYY.git&apos;</div><div class="line">hint: Updates were rejected because the remote contains work that you do</div><div class="line">hint: not have locally. This is usually caused by another repository pushing</div><div class="line">hint: to the same ref. You may want to first integrate the remote changes</div><div class="line">hint: (e.g., &apos;git pull ...&apos;) before pushing again.</div><div class="line">hint: See the &apos;Note about fast-forwards&apos; in &apos;git push --help&apos; for details.</div></pre></td></tr></table></figure>
<p>这时，在终端执行如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git push -f origin master</div></pre></td></tr></table></figure>
<h5 id="error-src-refspec-master-does-not-match-any"><a href="#error-src-refspec-master-does-not-match-any" class="headerlink" title="error: src refspec master does not match any."></a>error: src refspec master does not match any.</h5><p>新建了new project后，与GitHub上的origin相关联，运行如下代码后，报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">git remote add origin https://github.com/XXX/YYY.git</div><div class="line">git push -u origin master</div><div class="line"></div><div class="line">error: src refspec master does not match any.</div><div class="line">error: failed to push some refs to &apos;https://github.com/XXX/YYY.git</div></pre></td></tr></table></figure>
<p>这是由于目前的project中，并没有git add任何文件，也没有任何commit，类似git版本控制中没有任何东西，是空的，所以会报错，解决方法也很简单，终端运行如下代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git add .</div><div class="line">git commit -m &quot;new project created&quot;</div><div class="line">git push -u origin master</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/08/10/Build-fake-data-for-Rail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/10/Build-fake-data-for-Rail/" itemprop="url">
                  ROR技能树：批量生成测试数据
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-10T20:37:02+08:00">
                2017-08-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/10/Build-fake-data-for-Rail/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/10/Build-fake-data-for-Rail/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>使用ROR进行网站开发时，不可避免地需要生成测试数据，常用的方法有两种：</p>
<ul>
<li>使用seed.rb</li>
<li>使用rake task</li>
</ul>
<p>下面以 Job这个model为例，看看如何用seed，rake task来批量生成测试数据，并对比两者之间的优劣。</p>
<p>Job所含字段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">string   &quot;title&quot;</div><div class="line">text     &quot;description&quot;</div><div class="line">datetime &quot;created_at&quot;,                    </div><div class="line">datetime &quot;updated_at&quot;,                    </div><div class="line">integer  &quot;wage_upper_bound&quot;</div><div class="line">integer  &quot;wage_lower_bound&quot;</div><div class="line">string   &quot;contact_email&quot;</div><div class="line">boolean  &quot;is_hidden</div></pre></td></tr></table></figure>
<hr>
<h3 id="测试数据生成"><a href="#测试数据生成" class="headerlink" title="测试数据生成"></a>测试数据生成</h3><h4 id="Seeds-rb"><a href="#Seeds-rb" class="headerlink" title="Seeds.rb"></a>Seeds.rb</h4><p>在seeds.rb中，将不同的字段放在Array中，然后循环调用这些Array，生成测试数据。</p>
<p>比如下面这种， 将Job的<code>title</code>， <code>description</code> 放在数组jobs_info中，然后循环赋值，具体步骤如下：</p>
<p>1、将如下代码贴到<code>seed.rb</code>文档中（为增加可读性，此处jobs_info仅放了3个种子）：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">jobs_info = [[<span class="string">"Web Application Developer"</span>,<span class="string">"Creates, maintains and implements web-based application systems. Resolves issues and recommends enhancements, when necessary. Has knowledge of HTML, Java and related concepts. Relies on knowledge and professional discretion to plan and accomplish goals. Usually reports to a department head. Significant ingenuity and flexibility is expected. May require a bachelor’s degree in a related area and at least 2-4 years of relevant experience."</span></div><div class="line">],[ <span class="string">"Android Developer"</span>,<span class="string">"Designs and builds applications for the Android platform. Works with outside data sources and API’s. Fixes bugs and improves application performance. Collaborates with cross-functional teams to determine and launch new features. Should have knowledge of core web technologies (HTML5, CSS3, JavaScript). Requires a bachelor’s degree in area of specialty and 2 years of relevant experience."</span></div><div class="line">],[<span class="string">"iOS Developer"</span>,<span class="string">"Designs and builds applications for the iOS platform. Works with outside data sources and API’s. Fixes bugs and improves application performance. Collaborates with cross-functional teams to determine and launch new features. Should have knowledge of core web technologies (HTML5, CSS3, JavaScript). Requires a bachelor’s degree in area of specialty and 2 years of relevant experience."</span></div><div class="line">]]</div><div class="line"></div><div class="line">create_jobs = <span class="number">10</span>.times to <span class="params">|i|</span></div><div class="line">	job_test=jobs_info[rand(<span class="number">0</span>..<span class="number">2</span>)]</div><div class="line">	Job.create!([<span class="symbol">title:</span> job_test[<span class="number">0</span>],<span class="symbol">description:</span> job_test[<span class="number">1</span>], <span class="symbol">wage_upper_bound:</span> rand(<span class="number">50</span>..<span class="number">99</span>)*<span class="number">100</span>,<span class="symbol">wage_lower_bound:</span> rand(<span class="number">10</span>..<span class="number">49</span>)*<span class="number">100</span>, <span class="symbol">is_hidden:</span><span class="string">"false"</span>)</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"></div><div class="line">create_jobs = <span class="number">10</span>.times to <span class="params">|i|</span></div><div class="line">	job_test=jobs_info[rand(<span class="number">0</span>..<span class="number">2</span>)]</div><div class="line">	Job.create!([<span class="symbol">title:</span> job_test[<span class="number">0</span>],<span class="symbol">description:</span> job_test[<span class="number">1</span>], <span class="symbol">wage_upper_bound:</span> rand(<span class="number">50</span>..<span class="number">99</span>)*<span class="number">100</span>,<span class="symbol">wage_lower_bound:</span> rand(<span class="number">10</span>..<span class="number">49</span>)*<span class="number">100</span>, <span class="symbol">is_hidden:</span><span class="string">"true"</span>)</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>2、终端运行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rake db:migrate</div><div class="line">rake db:seed</div></pre></td></tr></table></figure>
<p>3、重启服务器<code>rails s</code></p>
<p>大功告成！</p>
<h4 id="rake-task"><a href="#rake-task" class="headerlink" title="rake task"></a>rake task</h4><p>这里我们需要用到强大的faker。点击，看<a href="https://github.com/stympy/faker" target="_blank" rel="external">faker</a>文档的具体说明。</p>
<p>此外，类似的gem还有<a href="https://github.com/sevenwire/forgery/tree/master" target="_blank" rel="external">forgery</a> , <a href="https://github.com/tomharris/random_data" target="_blank" rel="external">random_data</a>。</p>
<p>1、在gemfile中添加faker</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem &apos;faker&apos;</div></pre></td></tr></table></figure>
<p>终端<code>bundle install</code></p>
<p>2、建立一个rake task，这里我们建立一个faker_jobs的任务，终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g task dev fake_jobs</div></pre></td></tr></table></figure>
<p>生成lib/tasks/dev.rake文件，内容如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">namespace <span class="symbol">:dev</span> <span class="keyword">do</span></div><div class="line">  desc <span class="string">"TODO"</span></div><div class="line">  task <span class="symbol">fake_jobs:</span> <span class="symbol">:environment</span> <span class="keyword">do</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"> <span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>3、根据Job的字段，添加相应的Faker数据。比如下面这样：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">namespace <span class="symbol">:dev</span> <span class="keyword">do</span></div><div class="line">  desc <span class="string">"TODO"</span></div><div class="line">  task <span class="symbol">fake_jobs:</span> <span class="symbol">:environment</span> <span class="keyword">do</span></div><div class="line">    Job.delete_all</div><div class="line"></div><div class="line">    Jobs = []</div><div class="line"></div><div class="line">    <span class="number">100</span>.times <span class="keyword">do</span> <span class="params">|i|</span></div><div class="line">      Jobs &lt;&lt; Job.create!(<span class="symbol">:title</span> =&gt; Faker::Job.title,</div><div class="line">                          <span class="symbol">:description</span> =&gt; Faker::Job.key_skill,</div><div class="line">                          <span class="symbol">:wage_upper_bound</span> =&gt; Faker::Number.between(<span class="number">10000</span>,<span class="number">30000</span>),</div><div class="line">                          <span class="symbol">:wage_lower_bound</span> =&gt; Faker::Number.between(<span class="number">1000</span>,<span class="number">10000</span>),</div><div class="line">                          <span class="symbol">:contact_email</span> =&gt; Faker::Internet.email,</div><div class="line">                          <span class="symbol">:is_hidden</span> =&gt; [<span class="literal">true</span>, <span class="literal">false</span>].sample,</div><div class="line">                          <span class="symbol">:created_at</span> =&gt; Time.now - rand(<span class="number">10</span>).days - rand(<span class="number">24</span>).hours)</div><div class="line">  <span class="keyword">end</span></div><div class="line"> <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>4、终端运行：<code>rake dev:fake_orders</code></p>
<p>5、重启服务器<code>rails s</code> , 搞定！</p>
<h3 id="优劣对比"><a href="#优劣对比" class="headerlink" title="优劣对比"></a>优劣对比</h3><p>两者有何不同？哪个更优？</p>
<p>【以下纯属个人理解，有不正确之处，非常欢迎指正】</p>
<p>从个人的使用来看，根据不同的需要去使用相应的方式来生成。</p>
<ul>
<li>seeds：种子方式的好处是，你已经将model的一个或多个字段的取值固定，这样每次生成的都是固定范围的，特别当model中含有一一对应的变量时，比如你做一个商店网站，商品和商品图片是对应的，用faker来随机生成，那简直就是灾难，只能通过seeds。但seeds不好的地方也很明显，你得先把这些字段的取值放进去，不管是通过copy的方式还是手敲（应该没人手敲吧？：P），如果仅仅是用来做测试，这样就有点废了。</li>
<li>rake task：优点是代码清爽，简单直接；缺点在于Faker/random_data／forgery的随机生成，会无视各个字段之间的关系。如果字段之间存在一定的关联，那你用这些gem的后果不是清爽，而是很酸爽。</li>
</ul>
<p>相比seeds，个人其实更喜欢用rake task，毕竟这些数据只是用来测试，而且大部分字段之间并没有很直接的逻辑关系，当然也因为<code>less code less bug</code> （捂脸）。<br>Â</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/08/08/User-Story/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/08/User-Story/" itemprop="url">
                  开发工具之User Story
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-08-08T12:08:48+08:00">
                2017-08-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/08/08/User-Story/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/08/08/User-Story/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>结合自己的理解，整理出的User Story笔记。</p>
<h4 id="定义："><a href="#定义：" class="headerlink" title="定义："></a>定义：</h4><p>软件开发中常用的一个基本工具，用户故事，又称User Story。</p>
<p>wikipedia上是这样定义的：</p>
<blockquote>
<p>In software development and product management, a user story is an informal, natural language description of one or more features of a software system.</p>
</blockquote>
<p>软件开发中，用来描述一个软件系统单个或多个特性的非正式自然语言。</p>
<p>我的理解是，定下角色，然后从角色的角度出发，理清会做什么事，最后实现了什么样的价值。</p>
<h5 id="Why-User-Story："><a href="#Why-User-Story：" class="headerlink" title="Why User Story："></a>Why User Story：</h5><p>开发中常常遇到如下情况：</p>
<ul>
<li>不知道如何整理项目需求</li>
<li>不知道如何拆分需要成实际的任务</li>
<li>大概知道要去拆分，但是不知道要描述到多详细</li>
<li>如何才能让大家都能很快读懂，参与协作。</li>
</ul>
<p>User Story是解决上述情况的一大利器。</p>
<h4 id="格式："><a href="#格式：" class="headerlink" title="格式："></a>格式：</h4><p>User Story的格式如下：</p>
<blockquote>
<p>As a role of user, I want some feature, so that some business value.</p>
<p>身为「某角色」， 会做「某事」， 以完成「某商业价值」</p>
</blockquote>
<p>例如：</p>
<ul>
<li>管理者可以新增职缺</li>
<li>用户可以申请职缺</li>
<li>用户可以浏览详细的工作内容</li>
<li>……</li>
</ul>
<p>这里，<strong>角色正是系统复杂度的关键</strong>。</p>
<h4 id="撰写的秘诀："><a href="#撰写的秘诀：" class="headerlink" title="撰写的秘诀："></a>撰写的秘诀：</h4><p>既然工具有用，那么要如何写好User Story？</p>
<ul>
<li><p><strong>注意粒度大小，粒度大小很重要</strong></p>
<ul>
<li>针对不同的受众，颗粒度是不一样的，例如：</li>
</ul>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fic5g3pmdmj30le0ardlk.jpg" alt=""></p>
<p>对于投资人／生意人来说，颗粒度就要很大，而针对用户或者客户，则是相对小的size，而针对开发人员，则需要更为小的颗粒。</p>
<ul>
<li>拆分User Story，就好比切蛋糕，直着切，不是横着切。<ul>
<li>不要用技术去切分，而是具体而微，让用户可以体验到一个相对完整，有价值的功能。好比不能单作controller，单作model，或者view，而是结合成一个MVC</li>
<li>要具体切多小呢？有什么标准？<ul>
<li>不需要写太多，比如写20条User Stories，就过多了</li>
<li>一条story不是描述中间一个步骤，而是完成一件事情</li>
<li>一个user story大约是半天～数天的实作长度</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>比如下图：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fic5qwcr0yj30i00bh42k.jpg" alt=""></p>
</li>
</ul>
<ul>
<li><p><strong>可彻底完成的小故事</strong></p>
<blockquote>
<p>是要完成一个小目标，让用户可以彻底完成一个任务，而不是发散，模糊，持续进行的故事。</p>
<p>例如：管理员可以管理商品，就不是一个好的user story，比较发散，模糊。</p>
<p>而拆分成：</p>
<ul>
<li>管理员可以上架商品，字段包括商品名称，价格，说明等</li>
<li>管理员可以编辑上架时间，过期商品自动下架</li>
<li>管理员可以上传多张产品图片</li>
</ul>
<p>这才是好的stories</p>
</blockquote>
</li>
<li><p>描述功能需求，而不是解决方案</p>
<blockquote>
<p>不要描述技术细节，包括UI规格，技术规格</p>
<p>只描述对用户有价值的功能</p>
</blockquote>
</li>
<li><p>辨识用户角色</p>
<blockquote>
<ul>
<li>包含用户角色，并讲清楚用户可以做的事情</li>
<li>身为「某角色」， 会做「某事」， 以完成「某商业价值」</li>
<li>撰写User Story用主动语态</li>
<li>角色越多，项目整体复杂度会快速上升</li>
</ul>
</blockquote>
</li>
</ul>
<h4 id="收集和排序："><a href="#收集和排序：" class="headerlink" title="收集和排序："></a>收集和排序：</h4><p>以购物网站示范,将想到的User Story都写在便利贴上，贴在白板上</p>
<ul>
<li><p>Top-down方式：有明确目标导向</p>
<blockquote>
<p>先列出3～5个主要活动，然后将主要活动拆分成至少3个以上的可执行story</p>
</blockquote>
</li>
<li><p>Bottom-up方式：创意导向，适合头脑风暴</p>
<blockquote>
<p>将所有user story贴出来，然后按照时间顺序分类，将类似功能的user story放在一组，如下：</p>
<p>​</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fic6ag9lj7j30ci0avwlv.jpg" alt=""></p>
<p>将分组后的活动进行小结，整理成3～5个主要活动。</p>
</blockquote>
<p><strong>排序：</strong></p>
<p>根据优先级，分出Must have ，Should have , Could have, Nice have，先做must，然后should，could，最后再考虑Nice</p>
</li>
</ul>
<h4 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h4><p><a href="https://ihower.tw/blog/archives/2090" target="_blank" rel="external">Ihower: 什么是User Story</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Lucia" />
          <p class="site-author-name" itemprop="name">Lucia</p>
           
              <p class="site-description motion-element" itemprop="description">曲肱而枕</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">75</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">25</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Lupeipei" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/Luciapeipei" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lucia</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://https-lupeipei-github-io.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  





  

  

  

  

</body>
</html>
