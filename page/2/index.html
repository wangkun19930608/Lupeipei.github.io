<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Learning is doing">
<meta property="og:type" content="website">
<meta property="og:title" content="Lucia">
<meta property="og:url" content="http://lupeipei.github.io/page/2/index.html">
<meta property="og:site_name" content="Lucia">
<meta property="og:description" content="Learning is doing">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lucia">
<meta name="twitter:description" content="Learning is doing">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lupeipei.github.io/page/2/"/>





  <title> Lucia </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lucia</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/10/24/test-concepts-about-stub/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avtar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/24/test-concepts-about-stub/" itemprop="url">
                  测试概念之stub篇
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-24T21:47:23+08:00">
                2017-10-24
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/24/test-concepts-about-stub/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/24/test-concepts-about-stub/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>学习测试的时候，一直不大懂stub，后来刷多了课程，感觉好像不那么懵逼了。</p>
<p>决定结合自己的学习与思考，说说stub到底是个啥。</p>
<p>BTW，if  you want to be a rocking unit tester, you must know stub and mock.：P</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>先来看一个问题：</p>
<p>你准备测试method A，method A 依赖于method B，比如method A要调用远端的API，而你只想测试method A有没有被正确调用，method B 存在与否，是不是返回了预期的结果，你并不care， 那么要怎么做才能保证测试的独立性？</p>
<p>这样的测试，就要用到stub。</p>
<p>下面以一个movie model来说明一下如何使用stub。</p>
<p>设想一个简单的movie影片查询情景：</p>
<p>用户在TMDb页面中输入影片名称，点击查询按钮，这时MoviesController 中对应的 search_tmdb method会去调用movie model里面真正执行search行为的method，这个method在数据库中进行搜索匹配，最后返回搜索结果，随后controller的 search_tmdb会render到搜索结果的页面，用户看到搜索结果，这样整个的搜索动作才算完成。</p>
<p>现在的情况是，movie model里面没有定义任何执行search 行为的method，而我们只想要验证controller的search_tmdb 调用了model里面执行search的method，不管这个method的存不存在，有没有返回预期结果，我们不care, 我们只想确定controller的search_tmdb做了正确的事，怎么破？</p>
<p>用stub来打破依赖。用一个伪造的method去替代，确保这个伪造的method被调用即可。</p>
<p>你的<code>movies_controller.rb</code>中定义了一个search_tmdb,但是里面啥也没有：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">def search_tmdb</div><div class="line">end</div></pre></td></tr></table></figure>
<p>你的test文件长这样：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNbRwgy1fktni1u9gaj30df05o3z5.jpg" alt=""></p>
<p>这时运行测试文件，会报错，因为你的search_tmdb并没有说让Movie去调用这个find_in_tmdb，如何让测试通过？</p>
<p>在<code>movies_controller.rb</code>中修改search_tmdb method，使它长这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def search_tmdb</div><div class="line">+ Movie.find_in_tmdb(params[:search_terms])</div><div class="line">end</div></pre></td></tr></table></figure>
<p>再次运行测试文件，通过！！</p>
<p>这里值得注意的是，你的movie model中，<strong>根本就没有find_in_tmdb这个method</strong>，很神奇是不是？</p>
<p>事实上，为了打破method之间的依赖，保证测试的独立性，这里伪造了一个针对find_in_tmdb的调用，<strong>即使这个find_in_tmdb本身存在model中，也会被忽视，overriding it</strong>。</p>
<p>这就是Stub了，很特别是不是？我第一次接触的时候，觉得很special。</p>
<p>看第二个测试： <strong>selects the Search Results template for rendering</strong></p>
<p>这里我们要确认controller的search_tmdb在调用find_in_tmdb后，是否render到了特定的template，即<code>search_tmdb.html.erb</code>。由于find_in_tmdb并没有定义，故这里也要用stub。怎么写呢？</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNbRwgy1fkuj2c03kjj30h606qgmv.jpg" alt=""></p>
<p>[这里用了matchers: render_template, response.]</p>
<p><code>Movie.stub(:find_in_tmbd)</code>： 假定执行了find_in_tmdb</p>
<p><code>expect(response).to render_template</code>:  验证最后的结果，是否render到了search_tmbd.html.erb这个template</p>
<p>运行测试文件，pass。</p>
<p>这里要注意，如果测试失败了，请检查一下你的app/views/movies/下是否存在search_tmbd.html.erb，如果不存在，新建，不然这个测试是无法通过的。</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>记住一句话，有助于理解stub： The code you wish you had。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/10/23/passenger-deploy-rails/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avtar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/23/passenger-deploy-rails/" itemprop="url">
                  Rails部署报错记录Passenger + Nginx
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-23T19:16:24+08:00">
                2017-10-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/passenger/" itemprop="url" rel="index">
                    <span itemprop="name">passenger</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/23/passenger-deploy-rails/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/23/passenger-deploy-rails/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>在部署网站后遇到的一个大坑，长这样：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fks5pqyvghj30no09u0ti.jpg" alt=""></p>
<p>看到这一行熟悉的we’re sorry, but something went wrong，默默跟这位老朋友打个招呼【捂脸】。</p>
<p>Google后，发现其他用passenger来部署Rails的，也遇到过这种页面无法显示的问题，但是没看到有人提供解决方法或者思路的，决定记录下我的整个解决步骤，给同样入坑的伙伴们作个参考。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>Google，看了stack overflow上的一些相关内容后，猜测是passenger的问题，于是终端输入<code>sudo passenger-status</code>, 发现passenger根本就没有开这个Rails的进程。</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fks5pqt1ywj30l108xt9z.jpg" alt=""></p>
<p>没开那就手动来开，在app的current目录下，运行<code>bundle exec passenger start</code>, 报错：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fks5pqia5ej30tc0ka46y.jpg" alt=""></p>
<p>怎么办？按照指示去tmp下找文件，看error log。</p>
<p>以root身份登录，去tmp目录下，查看出错的log,这里是passenger-error-pxhJuZ.html。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd /tmp</div><div class="line">nano passenger-error-pxhJuZ.html</div></pre></td></tr></table></figure>
<p>打开显示如下：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fksdg0z54rj30wv0dftdo.jpg" alt=""></p>
<p>OK，那就动动listen 这个gem, google 后，参考stackoverflow上的解答<a href="https://stackoverflow.com/questions/38663706/loaderror-could-not-load-the-listen-gem-rails-5" target="_blank" rel="external">LoadError: Could not load the ‘listen’ gem (Rails 5)</a>， 把listen从development中移除，放在了global中</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fksdhtg52aj30et0azdhc.jpg" alt=""></p>
<p>本地运行<code>bundle</code>，git commit 和 git push 后，进行部署 <code>cap production deploy</code>,  刷新页面，发现还是老样子。怎么回事？突然想到stack overflow上提到可以登录rails console看看，好，试试。</p>
<p>用deploy身份登录远端后，执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cd ~/Together/current #Together 是你的APP名称</div><div class="line">RAILS_ENV=production bundle exec rake db:seed</div></pre></td></tr></table></figure>
<p>果然，报错，显示网站有bug，立马回去修bug……</p>
<p>在本地修复好，git commit 和 git push 后，进行部署 <code>cap production deploy</code>,  刷新页面， OK！！</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>这段爬坑的日子，遇到了不少Google了也不一定能解决的坑，甚至会让你在懵逼的情况下，被别人的解答带得越来越远。只想说解决问题的思路真的太重要了，同时多点耐心，相信坑坑皆有解。</p>
<p>Be more patient.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/10/23/TDD-with-RSpec-integration-test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avtar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/23/TDD-with-RSpec-integration-test/" itemprop="url">
                  TDD with RSpec出错集之Integration测试篇
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-23T09:51:06+08:00">
                2017-10-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/23/TDD-with-RSpec-integration-test/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/23/TDD-with-RSpec-integration-test/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>本场测试的star是 Capybara。</p>
<p>考虑到自己写的method还是挺多的，就没有一一integration test了。</p>
<p>实作了简单的首页测试，用户注册，用户登录，用户退出。</p>
<p>记录下遇到的问题，顺带加入了debug的部分。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><strong>Capybara::ElementNotFound: Unable to find visible link or button “ 登出”</strong></li>
</ul>
<p>做登录，登出的测试时，终端报出如下错误：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fkrwabt60oj30mn0783z9.jpg" alt=""></p>
<p>报错显示页面找不到“ 登出”这个link 或者button，对应的测试文件长这样：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fkrwac5bn8j30en0f440o.jpg" alt=""></p>
<p><strong>怎么破？</strong></p>
<p>第一想法就是查看一下用户登录后，点击”Hi!, #{user.username}”，页面这时候是长啥样，是不是真的没有“ 登出”这个link 或者button。</p>
<p>怎么做呢？好办，加入<code>save_and_open_page</code>, 注释掉报错的代码，像这样👇：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fkrwhk5kaqj30ds0g176e.jpg" alt=""></p>
<p>终端再次运行案例，得到这样的一串网址：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fkrwkc51ljj30ny05z758.jpg" alt=""></p>
<p>终端输入：<code>open tmp/capybara/capybara-201710230848216776109515.html</code>, 浏览器便会打开这个网址了。</p>
<p>我的是这样子：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fkrwltsrhcj30oe0hi40b.jpg" alt=""></p>
<p><strong>有登出呢！</strong>为什么显示Unable to find visible link or button ？那只能说明这不是一个link or button？Google后，发现在stackoverflow上有个非常相似的案例：<a href="https://stackoverflow.com/questions/11269724/how-to-use-capybara-in-rspec-to-click-on-a-dropdown-option" target="_blank" rel="external">How to use capybara in rspec to click on a dropdown option</a></p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fkrx3y3ul4j30kl06lgms.jpg" alt=""></p>
<p>试试把<code>click_on&quot; 登出&quot;</code>换成<code>page.find(:xpath, &quot;//a[@href=&#39;/users/sign_out&#39;]&quot;).click</code>, 终端再次运行案例，Pass！！</p>
<p>but ,xpath是啥？XPath 是一门在 XML 文档中查找信息的语言，用于在 XML 文档中通过元素和属性进行导航。</p>
<p>了解更多可以看看W3school的教程<a href="http://www.w3school.com.cn/xpath/index.asp" target="_blank" rel="external">xpath</a>。</p>
<p>在capybara中为什么要这么用？戳这里<a href="https://github.com/teamcapybara/capybara#xpath-css-and-selectors" target="_blank" rel="external">capybara XPath, CSS and selectors</a> .</p>
<h4 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h4><p><strong>capybara</strong> 中，操作页面的方法除了visit，click外，还有很多比如fill_in， check，choose等等，很强大。</p>
<p>详见：<a href="https://github.com/teamcapybara/capybara" target="_blank" rel="external">capybara</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/10/22/TDD-with-RSpec-errors-recording/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avtar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/22/TDD-with-RSpec-errors-recording/" itemprop="url">
                  TDD with RSpec出错集之单元测试篇
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-22T15:52:04+08:00">
                2017-10-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/22/TDD-with-RSpec-errors-recording/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/22/TDD-with-RSpec-errors-recording/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>刷完了Edx上关于TDD，BDD的课程，也看了《Everyday rails testing with RSpec》, 于是迫不及待想给自己的网站<a href="https://www.togetherisbetter.cn" target="_blank" rel="external">Together</a>也加上RSpec部分，好比刚从师傅那学了几招的小徒弟，立马想找个人试试身手，这中间自然也是免不了各种坑的，一一记录， 避免二次入坑。</p>
<p>PS ： FactoryGirl官方GitHub库已经改名为FactoryBot，实作的时候，请小心敲键盘……</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p><strong>ArgumentError: Factory not registered</strong></p>
<p>运行测试文件时，终端报出这样的错误：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fkq88je5s0j30sd04xmyd.jpg" alt=""></p>
<p><strong>怎么破？</strong></p>
<p>在<code>spec/spec_helper.rb</code>文件中，加入如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">RSpec.configure do |config|</div><div class="line">  config.include FactoryBot::Syntax::Methods</div><div class="line">  .....</div><div class="line">+  config.before do</div><div class="line">+    FactoryBot.find_definitions</div><div class="line">+  end</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p><strong>FactoryBot::DuplicateDefinitionError: Factory already registered: event</strong></p>
<p>运行测试文件时，终端报出这样的错误：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fkq8u4t8xfj30qg07wdh6.jpg" alt=""></p>
<p><strong>怎么破？</strong></p>
<p>在<code>spec/spec_helper.rb</code>文件中，加入如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">RSpec.configure do |config|</div><div class="line">  config.include FactoryBot::Syntax::Methods</div><div class="line">  .....</div><div class="line">  config.before do</div><div class="line">+   FactoryBot.factories.clear</div><div class="line">    FactoryBot.find_definitions</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p><strong>Please set Qiniu’s access_key and secret_key before authorize any tokens</strong></p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fkqrce6o1ij30pc052wfp.jpg" alt=""></p>
<p>终端运行<code>rspec spec/controllers/events_controller_spec.rb</code>, 为了测试events controller部分，用FactoryBot创建了event，这里有必要说一下，我的event model中有logo部分，而用户上传的logo图片我是用七牛来存储的。抛出异常，查看七牛官方<a href="https://github.com/qiniu/ruby-sdk/blob/master/spec/qiniu/auth_spec.rb" target="_blank" rel="external">GitHub spec部分</a>，找到了这个：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fkqrjx0s05j30px0jcq67.jpg" alt=""></p>
<p>我擦，看完了<code>spec/qiniu/tokens/auth_spec.rb</code>，除了懵逼外，我不知道怎么走下一步，转念想想我这里并不要测试七牛这块啊，我只想测试controller中的method是不是调用了，so what should I do? bypass it。</p>
<p>修改<code>app/uploads/</code>下所有的uploader文档，比如avatar_uploader.rb,  修改storage设置：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fkqsdym52jj30c302hq2y.jpg" alt=""><br><strong>除了生产环境，开发和测试请一律使用file存储！</strong></p>
<p>再次测试， 一线飘绿，OK！</p>
</li>
<li><p><strong>NoMethodError: Undefined method ‘sign_in’</strong></p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fkqtb87yhqj30p903saah.jpg" alt=""></p>
<p><strong>怎么破？</strong></p>
<p>google后，在stack overflow上找到了解答。</p>
<p>修改<code>spec/support/rails_helper.rb</code>文件，在<code>RSpec.configure do |config|</code>部分添加<code>config.include Devise::TestHelpers, type: :controller</code> :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">RSpec.configure do |config|</div><div class="line">  ......</div><div class="line">+ config.include Devise::TestHelpers, type: :controller</div><div class="line">  ......</div><div class="line">end</div></pre></td></tr></table></figure>
<p>再次测试, pass!  </p>
</li>
<li><p>如果你的model中有图片部分，比如event model中有个event logo，而你用factoryBot生成数据时，是这样的：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fkr1glxjegj30ki065q3s.jpg" alt=""></p>
<p>同时，你在测试案例中要用到build(:event)，那么，先要恭喜你，新坑正在等在你。</p>
<p>我在做controller的create method测试时，一直报错：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fkr1lop75jj30o704bgm8.jpg" alt=""></p>
<p>设置断点后，找到了是eventlogo没有赋值成功：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fkr1p9w8bgj30u207egna.jpg" alt=""></p>
<p>Google后，你会发现stack overflow上已经有人问过类似的了，但是各执一词，让人有些摸不着头脑，有说用fixture_file_upload的，呃，fixture VS FactoryBot， 我们更爱后者。那<strong>怎么破</strong>？</p>
<p>看<strong>carrierwave</strong>的GitHub文档找到<a href="https://github.com/carrierwaveuploader/carrierwave/wiki/How-to:-Use-test-factories" target="_blank" rel="external">Use test factories</a>部分:</p>
<p>重点来了：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fkr233qjewj30k90g6di4.jpg" alt=""></p>
<p>原来我用的那种格式，是用于create的，如果用build，只存在内存中，则需要换成<code>Rack::Test::UploadedFile.new</code>的样式。</p>
<p>修改<code>spec/factories/events.rb</code>文件，将原eventlogo注释掉：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fkr2j2fr38j30ky06kgmq.jpg" alt=""></p>
</li>
</ul>
<p>   终端再次运行：<code>rspec spec/controllers/events_controller_spec.rb</code>, OK !</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><pre><code>按照TDD「Test driven development」的理论，应该测试先行, 像下图酱样子：
</code></pre><p>  <img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fkr2b72qhfj30s60djt92.jpg" alt=""></p>
<p>  无奈我已经做好了整个网站，决定不按套路出牌，后期加入TDD，来测测前期代码的稳定性 , 在测了一部分功能后，深有感触，测试果然是很有必要的：P。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/10/20/how-to-debug-with-RSpec/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avtar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/20/how-to-debug-with-RSpec/" itemprop="url">
                  如何在测试中debug?
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-20T14:38:45+08:00">
                2017-10-20
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/20/how-to-debug-with-RSpec/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/20/how-to-debug-with-RSpec/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>做测试的时候，案例未通过，满屏飘红是常有的事，所以在测试中debug就显得很有必要，为便于阐述，以我自己做的一个events_controller 的测试为例，看看如何debug。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>一个测试报错了，而提示又不足以让你立马get到点，比如在做controller的单位测试时，验证create这个method，出错：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fkqyujzh4nj30o704bgm8.jpg" alt=""></p>
<p>很显然，event没有成功写入数据库，如何debug？</p>
<p>首先，你可能想单独跑这一个案例，其他的注释掉。</p>
<p>比较粗暴的方法是注解掉其他的测试案例，只留下你要纠正的那个，另一个方法是用<code>:focus =&gt; true</code>。</p>
<p>两步走：</p>
<ul>
<li><p>编辑<code>spec/rails_helper.rb</code>， 加入两行设定：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">  RSpec.configure do |config|</div><div class="line">  ......</div><div class="line"></div><div class="line">+  config.filter_run :focus =&gt; true</div><div class="line">+  config.run_all_when_everything_filtered = true</div></pre></td></tr></table></figure>
</li>
<li><p>修改你的test文件，比如针对上面的报错，我的文件是<code>spec/controllers/events_controller_spec.rb</code>, 在未通过的案例中，加入了<code>:focus =&gt; true</code></p>
<p>​</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fkqz77tr3uj30eh076jsg.jpg" alt=""></p>
</li>
</ul>
<p>终端运行<code>rspec spec/controllers/events_controller_spec.rb</code>, 将会只运行这一个实例。</p>
<p>「需要注意的是，测试通过后，记得把<code>:focus =&gt; true</code> 移除。」</p>
<p>确认只有这个案例运行后，接下来，我们用byebug下断点，检查下为什么event没有存入数据库。</p>
<p>在<code>app/controllers/events_controller.rb</code>中，create部分，加入byebug：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fkqzl4lewgj30i505p0tc.jpg" alt=""></p>
<p>终端再次运行<code>rspec spec/controllers/events_controller_spec.rb</code>， 会发现程序停在那里了:</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fkqzmdxoxdj30u6093q4v.jpg" alt=""></p>
<p>这时就可以检查变量了。比如我输入@event查看各个字段的赋值情况，发现eventlogo没有赋值成功，fix it。</p>
<p>最后输入<code>continue</code>, 程序就会继续执行下去。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fkr0525em2j30u60ab0uv.jpg" alt=""></p>
<h4 id="the-End"><a href="#the-End" class="headerlink" title="the End"></a>the End</h4><p>Happy debugging! ：P</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/10/18/website-padlock-green-issue/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avtar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/18/website-padlock-green-issue/" itemprop="url">
                  网站加密后，没有挂上小绿锁?
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-18T18:25:04+08:00">
                2017-10-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/18/website-padlock-green-issue/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/18/website-padlock-green-issue/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>在给自己的网站加密后，网址从http变成https了，可是我却发现网站成了这样：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fks9mass87j30ey03x0u2.jpg" alt=""></p>
<p>预期中的它应该是长这样子👇：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fks9njubhqj303g00vjr7.jpg" alt=""></p>
<p>仔细检查了Nginx中的配置文档，没有发现问题，推测不是配置的问题，那么为什么会这样？</p>
<p>【BTW, 阿里云有免费的SSL证书，可以让网站从HTTP换成HTTPS，戳这里直达<a href="https://common-buy.aliyun.com/?spm=5176.2020520163.cas.1.2arDtO&amp;commodityCode=cas#/buy" target="_blank" rel="external">阿里云</a>。】</p>
<p>请确保你的Nginx配置是正确的，下面的解决思路是以配置无误为前提的。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>google后找到了这篇文章：【Google，大神】</p>
<p><a href="https://support.comodo.com/index.php?/Knowledgebase/Article/View/1057/0/why-isnt-my-sites-padlock-green-or-doesnt-have-green-address-bar" target="_blank" rel="external">Why isn’t my Site’s padlock green or doesn’t have green address bar ?</a></p>
<p>按照文章的提示，解决了问题，以chrome为例，具体步骤如下：</p>
<p>打开网站，右击，选择检查（inspect），</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fks9wu7e2lj30q90ixhcb.jpg" alt=""></p>
<p>然后选择security安全，可以看到这样的页面：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fks9sjsqjbj30uc0kz1bn.jpg" alt=""></p>
<p>在mixed content中，提示让你重新加载页面，OK，我们reload一下。</p>
<p>这时，可以发现mixed content中出现这样的链接：<br><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fksa0let1rj30so0i7aoa.jpg" alt=""></p>
<p>点击，查看：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fksa0kw4csj30pr0h0dj6.jpg" alt=""></p>
<p>OK，问题找到了，是图片链接用了http导致的。</p>
<p>原来因为网站用了七牛云存储，图片的链接为http，解决的办法是去七牛买个加速域名，换成https……</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>每个人遇到的情况不一样，这里我只是贴出我是如何找到解决方法的，希望对遇到了同样问题的小伙伴有所帮助。<br>Happy coding!</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/10/15/deploy-with-qiniu/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avtar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/15/deploy-with-qiniu/" itemprop="url">
                  七牛云端部署，想说爱你不容易
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-15T20:03:17+08:00">
                2017-10-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/15/deploy-with-qiniu/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/15/deploy-with-qiniu/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>  前段时间，租了阿里云，买了域名，最近折腾了下，终于把之前做的网站部署上去了。</p>
<p>  整个部署过程中，感觉最虐的就是七牛云那块了，对于半路出家的新手来说，真是个不小的坑。记录下这段虐心的旅程。</p>
<hr>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>  我用的是Capistrano来部署Rails项目，这里只记录一下我在远端服务器运行seed时，会出现的问题。<br>  好，我们开始吧！<br>  当你在终端<code>~/yourproject_name/current</code>执行<code>RAILS_ENV=production bundle exec rake db:seed</code>, 可能会出现如下报错：</p>
<ul>
<li><p><strong>NoMethodError： undefined method qiniu_up_host</strong></p>
<p>这个报错出现的有些奇怪，我在本地运行<code>rake db:seed</code>时，也报错，而我之前部署到heroku时并没有出现过这种情况，不解。</p>
<p>虽然不理解它为什么会出现，但是有问题咱就得想着解决，看看怎么破了它。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fkj51hciw8j30qn069di8.jpg" alt=""></p>
<p><strong>解决办法：</strong></p>
<p>方法很粗暴。<br>在本地的<code>config/initializers/carrierwave.rb</code>文件中，将host那一行直接注释，然后运行<code>rake db:seed</code>， 发现OK啦。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fkj56rr9y4j30cl06ndgc.jpg" alt=""></p>
<p>为什么我会想到直接注释？Google了下，发现如果你的服务器在国内，qiniu_up_host是可以不用设置的。</p>
<p>另外，还有一种情况是config.qiniu_up_host的值写错了，不同的存储区域是不一样的，具体可以参见<a href="https://developer.qiniu.com/kodo/manual/1671/region-endpoint" target="_blank" rel="external">七牛开发者中心-存储区域</a>。</p>
</li>
<li><p><strong>TypeError: no implicit conversion of nil to String</strong></p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fkj032q8itj30l70bctbx.jpg" alt=""></p>
<p>出现这个情况，是因为我使用了<a href="https://github.com/laserlemon/figaro" target="_blank" rel="external">Figaro</a> 管理密码，之前部署到heroku时，终端运行<code>figaro heroku:set -e production</code>就可以了，但是这里，我们怎么把七牛对应的AccessKey，SecretKey等信息放入remote server呢？</p>
<p>其实，<a href="https://github.com/laserlemon/figaro" target="_blank" rel="external">Figaro</a> 的README文档中已经提到了，咱们这么来：</p>
<p>Step1、在远端的<code>~/yourproject_name/shared/config</code>中，添加<code>application.yml</code>, 内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">production:</div><div class="line">   qiniu_access_key: xxxx  # 你的 qiniu AccessKey</div><div class="line"></div><div class="line">   qiniu_secret_key: xxxx  # 你的 qiniu SecretKey</div><div class="line"></div><div class="line">   qiniu_bucket: xxxx  # 你的 qiniu bucket</div><div class="line"></div><div class="line">   qiniu_bucket_domain: xxxx  # 你的 qiniu bucket domain</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"> development:</div><div class="line">   qiniu_access_key: xxxx  # 你的 qiniu AccessKey</div><div class="line"></div><div class="line">   qiniu_secret_key: xxxx  # 你的 qiniu SecretKey</div><div class="line"></div><div class="line">   qiniu_bucket: xxxx  # 你的 qiniu bucket</div><div class="line"></div><div class="line">   qiniu_bucket_domain: xxxx  # 你的 qiniu bucket domain</div></pre></td></tr></table></figure>
<p>这里，虽然我们添加了这个文件，但是由于你的<code>config/deploy.rb</code>中没有设置，所以部署的时候并不会去连接这个文件。</p>
<p>Step2、在本机上编辑<code>config/deploy.rb</code>，将<code>application.yml</code>添加进去：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">-  append :linked_files, &quot;config/database.yml&quot;, &quot;config/secrets.yml&quot;</div><div class="line">+  append :linked_files, &quot;config/database.yml&quot;, &quot;config/secrets.yml&quot;, &quot;config/application.yml&quot;</div></pre></td></tr></table></figure>
<p>OK啦！记得commit 和 push，再运行 <code>cap production deploy</code>，最后在远端服务器运行seed。</p>
</li>
<li><p><strong>TypeError: class or module required for rescue clause</strong></p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79ly1fkj0j8b12pj30oa0bujuv.jpg" alt=""></p>
<p>看到报错，第一反应就是google，在<a href="https://github.com/huobazi/carrierwave-qiniu/issues/17" target="_blank" rel="external">carrierwave-qiniu configuration error #17</a> 中, 提到<code>qiniu-rs</code>这个gem已经没有人在维护了，要安装最新版的<code>carrierwave-qiniu</code>。好，那就重新安装，又不是第一次被版本坑了: P。</p>
<p>在gemfile中做如下修改：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+ gem &apos;carrierwave-qiniu&apos;, &apos;~&gt; 1.1.5&apos;</div><div class="line"></div><div class="line">- gem &apos;qiniu-rs&apos;</div></pre></td></tr></table></figure>
<p>终端运行<code>bundle install</code>, 报错显示：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79ly1fkj1s2ugzfj30me0bq76f.jpg" alt=""></p>
<p>显示没有mime-types，按照提示，运行<code>bundle update</code>， OK！</p>
<hr>
</li>
</ul>
<h4 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h4><p><strong>Attention：</strong></p>
<p>  请在每次修改后，进行git commit 和 git push ，然后在本地运行 <code>cap production deploy</code>部署，Capistranno会从GitHub上拉下最新的进度，最后在远端服务器的<code>~/yourproject_name/current</code>目录下，运行<code>RAILS_ENV=production bundle exec rake db:seed</code>。</p>
<p>  哦，附上我的成品<a href="https://www.togetherisbetter.cn/" target="_blank" rel="external">Together is better</a> : P.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/10/10/login-server-without-password/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avtar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/10/login-server-without-password/" itemprop="url">
                  SSH免密码登录远端服务器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-10T08:24:21+08:00">
                2017-10-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/10/login-server-without-password/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/10/login-server-without-password/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="吐个糟先"><a href="#吐个糟先" class="headerlink" title="吐个糟先"></a>吐个糟先</h4><p>前段时间开始学习Linux云服务器部署运维，在免密码登录那块卡了很久，一直没找到原因，删除实例，重新生成SSH key，折腾了几次，每次都以为这次没问题了，结果登录的时候，擦，还是要求输入密码，你说糟心不？索性先搁浅了起来，前几天又来找虐，试了两次，竟然成功登录了，小激动啊！</p>
<p>记录下免密码登录的整个操作流程，庆祝下，也给没踩坑的参考下。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>远端登入如果每次都要输入密码，还是挺麻烦的，不过，别担心，聪明的前辈们早就想到解决办法啦！用非对称加密的方式来实现免密码登录。那，具体怎么玩？</p>
<p><strong>步骤：</strong></p>
<p>机器A： 本地的Mac</p>
<p>机器B： 远端Linux服务器</p>
<p>Step1、在<strong>本地机器A</strong>检查是否已经生成id_rsa.pub</p>
<ul>
<li><p>终端运行<code>cat ~/.ssh/id_rsa.pub</code></p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fk9qp21kn2j30lt021gmk.jpg" alt=""></p>
<ul>
<li><p>如果存在该文件，终端运行：<code>ssh-keygen -p</code>, 将passphrase重新设置为空，直接按Enter即可，这一步很重要，不然的话，即使你设置了免密码登录，还是要每次都输入passphrase才可以登录到远端服务器。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fk9qp2mmr8j30gz02t3yy.jpg" alt=""></p>
</li>
<li><p>如果不存在该文件，需要先生成，终端运行：<code>ssh-keygen -t rsa</code>,  就会生成公钥 <code>~/.ssh/id_rsa.pub</code> 以及密钥 <code>~/.ssh/id_rsa</code>啦。同样的，一直按Enter，不要设置passphrase。</p>
</li>
</ul>
</li>
</ul>
<p>Step2、在<strong>机器B</strong>添上本地的公钥</p>
<ul>
<li><p>登录远端服务器后，新建authorized_keys</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">mkdir ~/.ssh</div><div class="line">touch ~/.ssh/authorized_keys</div></pre></td></tr></table></figure>
</li>
<li><p>将公钥贴进远端服务器的authorized_keys中</p>
<p>在A上运行：<code>cat ~/.ssh/id_rsa.pub</code>， 复制本机的公钥</p>
<p>回到B上，运行：<code>nano ~/.ssh/authorized_keys</code>, 把公钥贴进去</p>
</li>
<li><p>设置机器B上的文件权限</p>
<p>运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chmod 700 ~/.ssh</div><div class="line">chmod 644 ~/.ssh/authorized_keys</div></pre></td></tr></table></figure>
<p>有的参考文档要求设置成600，试了下，644，600，保证owner是可读写可执行，而其他用户和群组的最大权限是可读即可。</p>
</li>
</ul>
<p>可以了！很简单是不是？试试看，退出重新登录下，不用敲密码啦！</p>
<h4 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h4><p> BTW，我之前的问题是passphrase没有设置为空，另外SSH文件复制时也出错，后面重新生成才解决的。</p>
<p>看了一些有关SSH免登录的操作说明，有一篇挺干货的。推荐：</p>
<p><a href="https://my.oschina.net/magicalSam/blog/1466144" target="_blank" rel="external">Mac、Linux 上实现SSH免密码登陆到Linux服务器</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/10/09/introduction-to-jquery-module3-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avtar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/09/introduction-to-jquery-module3-2/" itemprop="url">
                  Introduction to jQuery_5
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-09T12:16:09+08:00">
                2017-10-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/09/introduction-to-jquery-module3-2/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/09/introduction-to-jquery-module3-2/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Before-Start"><a href="#Before-Start" class="headerlink" title="Before Start"></a>Before Start</h4><p>The following contents are the notes I took when learning  jQuery on Edx.</p>
<p>Mainly for  front-End Web developers, check <a href="https://courses.edx.org/courses/course-v1:Microsoft+DEV208x+4T2017/course/" target="_blank" rel="external">here</a> to get more details.</p>
<h4 id="CONTENTS"><a href="#CONTENTS" class="headerlink" title="CONTENTS"></a>CONTENTS</h4><p>Three parts:</p>
<ul>
<li><a href="https://lupeipei.github.io/2017/10/05/introduction-to-jQuery-module1/">Adding jQuery to web pages</a></li>
<li><a href="https://lupeipei.github.io/2017/10/06/introduction-to-jquery-module2-1/">Managing content, events and effects</a></li>
<li>Asynchronous operations and Ajax calls</li>
</ul>
<h4 id="Module3-Asynchronous-programming-and-Ajax"><a href="#Module3-Asynchronous-programming-and-Ajax" class="headerlink" title="Module3 : Asynchronous programming and Ajax"></a>Module3 : Asynchronous programming and Ajax</h4><p>Module3 includes five parts:</p>
<ul>
<li>Using promises</li>
<li>Web workers</li>
<li>Using deferred</li>
<li>JavaScript Object Notation</li>
<li>Calling the server</li>
</ul>
<p>Let’s get to know something about JSON and Ajax.</p>
<ul>
<li><p>JavaScript Object Notation</p>
<ul>
<li><p>JSON syntax</p>
<p>A JSON object uses a notation that’s similar to that of a JavaScript object.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//create a JavaScript object</div><div class="line">var person = &#123;</div><div class="line">    firstName: &apos;Christopher&apos;,</div><div class="line">    lastName: &apos;Harrison&apos;</div><div class="line">&#125;</div><div class="line"></div><div class="line">//create a JSON object</div><div class="line">var person = &#123;</div><div class="line">    &apos;firstName&apos;: &apos;Christopher&apos;,</div><div class="line">    &apos;lastName&apos;: &apos;Harrison&apos;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Create a more complex object:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var person = &#123;</div><div class="line">    &apos;firstName&apos;: &apos;Christopher&apos;,</div><div class="line">    &apos;lastName&apos;: &apos;Harrison&apos;,</div><div class="line">    &apos;email&apos;: &#123;</div><div class="line">        &apos;address&apos;: &apos;charrison@adventure-works.com&apos;,</div><div class="line">        &apos;type&apos;: &apos;business&apos;</div><div class="line">    &#125;    </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Create a object with array:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">var person = &#123;</div><div class="line">    &apos;firstName&apos;: &apos;Christopher&apos;,</div><div class="line">    &apos;lastName&apos;: &apos;Harrison&apos;,</div><div class="line">    &apos;emailAddresses&apos;: [</div><div class="line">        &#123;</div><div class="line">            &apos;address&apos;: &apos;charrison@adventure-works.com&apos;,</div><div class="line">            &apos;type&apos;: &apos;business&apos;</div><div class="line">        &#125;,</div><div class="line">        &#123;</div><div class="line">            &apos;address&apos;: &apos;charrison@fineartschool.net&apos;,</div><div class="line">            &apos;type&apos;: &apos;home&apos;</div><div class="line">        &#125;</div><div class="line">    ]</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>Serializing objects</p>
<p>JavaScript provides a native utility for <strong>converting objects to JSON</strong> (serializing), and <strong>converting JSON strings to objects</strong> (deserializing).</p>
<ul>
<li><p>Serializing an object:<code>JSON.stringify</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">// Create an instance of Object, a basic JavaScript object</div><div class="line">var person = new Object();</div><div class="line"></div><div class="line">// add properties</div><div class="line">person.firstName = &apos;Christopher&apos;;</div><div class="line">person.lastName = &apos;Harrison&apos;;</div><div class="line"></div><div class="line">// serialize</div><div class="line">var jsonString = JSON.stringify(person);</div></pre></td></tr></table></figure>
</li>
<li><p>Deserializing JSON: <code>JSON.parse</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// Deserialize a JSON string</div><div class="line">var newPerson = JSON.parse(jsonString);</div><div class="line"></div><div class="line">// access properties as normal</div><div class="line">$(&apos;#first-name-display&apos;).text(newPerson.firstName);</div><div class="line">$(&apos;#last-name-display&apos;).text(newPerson.lastName);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Calling the server</p>
<ul>
<li><p>Introducing Ajax</p>
<p>Typically, when we make a call to the server, we need to refresh the entire page.</p>
<p>as developers, we’d like to be able to incorporate server-side resources into our pages, allowing us to <strong>update individual portions of the page with new data, rather than updating the entire page</strong>.</p>
<ul>
<li><p>Asynchronous JavaScript and XML (Ajax)</p>
<p>Ajax is a set of technologies that act together to make it easier for developers to make calls to server resources from JavaScript.</p>
</li>
<li><p>Basic data retrieval</p>
<p><code>get</code> : The most basic Ajax operation we can perform using jQuery.</p>
<p> <code>get</code> contacts the <strong>URL</strong> we provide, and passes the string the server returns into the parameter we’ll use for our event handler.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$.get(</div><div class="line">    &apos;some-url&apos;, // The URL to call</div><div class="line">    function(data) &#123; // Success event handler</div><div class="line">        // The data parameter contains the string</div><div class="line">        $(&apos;#output&apos;).text(data);</div><div class="line">    &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
</li>
<li><p>jQuery Ajax and promises</p>
<p>All jQuery Ajax calls return a jQuery <strong>promise</strong>.</p>
<p> So, you can use <code>done</code> for your success event handler, and <code>fail</code> to catch any errors. The two code samples perform the same operations.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">// Option one (pass the success function as a parameter)</div><div class="line">$.get(&apos;some-url&apos;, function(data) &#123; $(&apos;#output&apos;).text(data); &#125;);</div><div class="line"></div><div class="line">// Option two (use the done function of the promise)</div><div class="line">$.get(&apos;some-url&apos;).done(function(data) &#123; $(&apos;#output&apos;).text(data); &#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Retrieving JSON objects</p>
<ul>
<li><p><code>getJSON</code></p>
<p>To retrieve a JSON object, you can use <code>getJSON</code>.</p>
<p><code>getJSON</code> accepts several parameters, but the most common two that you’ll provide are the URL you need to call, and an event handler for success.</p>
<p>Because getJSON is expecting JSON data, it automatically deserializes the object, meaning you do not need to call JSON.parse.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$.getJSON(&apos;/api/Demo&apos;, function (person) &#123;</div><div class="line">	$(&apos;#first-name&apos;).val(person.firstName);</div><div class="line">	$(&apos;#last-name&apos;).val(person.lastName);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Making server calls</p>
<p>If you’re new to making server calls through JavaScript or other technologies, you might have a few questions about <strong>how you’re supposed to know where the data is, what URLs you should use</strong>, etc.</p>
<ul>
<li><p>Finding the right URL</p>
<p>Most commonly you’ll be calling your own server and accessing your own organization’s data.</p>
<p>Then the answer becomes even easier:</p>
<p>talk to the developer who created the server side code that you need to call. They can provide all of the information you need.</p>
</li>
<li><p>Verbs</p>
<p>HTTP offers several “verbs”, with the two most common being GET and POST.</p>
<p>GET and POST in HTTP terms are about how to <strong>send data</strong> to the server, not a determination of the server sending you data.</p>
<p>GET limits us to <strong>sending data in the URL only</strong>.</p>
<p>POST on the other hand allows us to <strong>send data</strong> <strong>both in the URL, but also in what’s known as the header</strong>.The header is information that’s sent behind the scenes from the client to the server, and can be used to send almost any type of data, including binary data.</p>
</li>
<li><p>HTTP and REST APIs</p>
<p> HTTP provides several verbs, including GET, POST, PUT and DELETE.</p>
<p>GET will retrieve objects,</p>
<p>POST will create a new object,</p>
<p>PUT will update an existing object,</p>
<p>DELETE will delete an object.</p>
<p>Building upon those common operations, the W3C has established a specification called <a href="https://en.wikipedia.org/wiki/Representational_state_transfer" target="_blank" rel="external">REST</a>. REST provides for various standards to provide even more consistency when making server calls.</p>
</li>
</ul>
</li>
<li><p>Posting data</p>
<p>If the service you’re using follows standard REST practices, you’ll notice that you can create a new object by calling POST.</p>
<p>Or, if you’re trying to upload a binary object, such as an image, you’re forced to use POST, as GET won’t allow that type of data to be uploaded.</p>
<ul>
<li><p><code>post</code></p>
<p>Like getJSON, it also passes the JSON object returned by the server into the parameter for the event handler. And, just like all of the Ajax calls we’ve seen, <code>post</code> also returns a promise.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">// get the data we need to send</div><div class="line">var person = &#123; firstName: &apos;Christopher&apos;, lastName: &apos;Harrison&apos; &#125;;</div><div class="line"></div><div class="line">// Call POST</div><div class="line"></div><div class="line">$.post(&apos;URL&apos;, // Pass in the URL you need to access</div><div class="line">    person, // Pass in the data to send via POST</div><div class="line">    function(data) &#123;</div><div class="line">        // success event handler</div><div class="line">        // parameter contains value returned by server</div><div class="line">    &#125;</div><div class="line">);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Ajax events</p>
<ul>
<li><p>Start events</p>
<p>The two starting events are <code>ajaxStart</code> and <code>ajaxSend</code>.</p>
<p><code>ajaxStart</code> is raised when the <strong>first</strong> Ajax call is being made.</p>
<p><code>ajaxSend</code> is raised <strong>each time</strong> an Ajax call is made.</p>
</li>
<li><p>Completion events</p>
<p>jQuery Ajax offers two main events when each Ajax call is finished, <code>ajaxSuccess</code>, which is raised when a call succeeds,</p>
<p><code>ajaxError</code>, which is raised when a call fails.</p>
<p><code>ajaxComplete</code> is raised when <strong>each</strong> Ajax call completes, regardless of success or failure.</p>
<p> <code>ajaxStop</code> is raised when <strong>all</strong> calls are completed.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">$(document).ajaxSend(function () &#123;</div><div class="line">	// raised when a call starts</div><div class="line">	$(&apos;#status&apos;).append(&apos;&lt;div&gt;Call started&lt;/div&gt;&apos;);</div><div class="line">&#125;).ajaxComplete(function () &#123;</div><div class="line">	// raised when a call completes</div><div class="line">	$(&apos;#status&apos;).append(&apos;&lt;div&gt;Call completed&lt;/div&gt;&apos;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Dynamically loading data</p>
<ul>
<li><p>Loading HTML</p>
<p><code>load</code> will call the URL provided, obtain the HTML, and place it in the targeted item.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(&apos;#target&apos;).load(&apos;some-url.html&apos;);</div></pre></td></tr></table></figure>
</li>
<li><p>Loading and executing JavaScript</p>
<p><code>getScript</code>  downloads <strong>and executes</strong> the script when it’s called.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$.getScript(&apos;some-url.js&apos;);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>This is  Module3 all about. More <a href="https://courses.edx.org/courses/course-v1:Microsoft+DEV208x+4T2017/course/" target="_blank" rel="external">details</a>.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/10/08/introduction-to-jquery-module3-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/source/images/avtar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/08/introduction-to-jquery-module3-1/" itemprop="url">
                  Introduction to jQuery_4
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-08T17:48:50+08:00">
                2017-10-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/10/08/introduction-to-jquery-module3-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/10/08/introduction-to-jquery-module3-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="Before-Start"><a href="#Before-Start" class="headerlink" title="Before Start"></a>Before Start</h4><p>The following contents are the notes I took when learning  jQuery on Edx.</p>
<p>Mainly for  front-End Web developers, check <a href="https://courses.edx.org/courses/course-v1:Microsoft+DEV208x+4T2017/course/" target="_blank" rel="external">here</a> to get more details.</p>
<h4 id="CONTENTS"><a href="#CONTENTS" class="headerlink" title="CONTENTS"></a>CONTENTS</h4><p>Three parts:</p>
<ul>
<li><a href="https://lupeipei.github.io/2017/10/05/introduction-to-jQuery-module1/">Adding jQuery to web pages</a></li>
<li><a href="https://lupeipei.github.io/2017/10/06/introduction-to-jquery-module2-1/">Managing content, events and effects</a></li>
<li>Asynchronous operations and Ajax calls</li>
</ul>
<h4 id="Module3-Asynchronous-programming-and-Ajax"><a href="#Module3-Asynchronous-programming-and-Ajax" class="headerlink" title="Module3 : Asynchronous programming and Ajax"></a>Module3 : Asynchronous programming and Ajax</h4><p>Module3 includes five parts:</p>
<ul>
<li>Using promises</li>
<li>Web workers</li>
<li>Using deferred</li>
<li>JavaScript Object Notation</li>
<li>Calling the server</li>
</ul>
<p>Uh, When I first learned it , I felt it was a little difficult for me to get the point, and now, I still have the feeling.</p>
<p>Let’s get to know something about the first three parts.</p>
<p><strong>A promise</strong> is an object returned by functions in jQuery that take a long or variable amount of time. By using a promise, you can ensure your code executes whenever the operation completes, be notified of its success or failure, or potentially receive updates about an operation’s progress.</p>
<p><strong>A deferred object</strong> allows you to create your own long running operations, allowing developers to use the same patterns provided by the promise object, and be updated when your operation completes.</p>
<p> <strong>web worker</strong>, an HTML5 feature allowing web developers to simulate threads in a web browser.</p>
<ul>
<li><p>promises</p>
<ul>
<li><p>Long running operations</p>
<p>Any jQuery function that runs over a long period of time, such as an animation, or communicates with a remote server, such as Ajax calls, returns a <strong>promise</strong>.</p>
</li>
<li><p>promises events</p>
<ul>
<li><p><code>done</code></p>
<p>raised when the operation completes successfully.</p>
<p>accepts one or more event handler functions.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// code to obtain promise object</div><div class="line">promise.done(function(data) &#123;</div><div class="line">	// data will contain the data returned by the operation</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p><code>fail</code></p>
<p>raised when the operation has completed with an error.</p>
<p>accepts one or more event handler functions.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// code to obtain promise object</div><div class="line">promise.fail(function(data) &#123;</div><div class="line">	// data will contain the data returned by the operation</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p><code>progress</code></p>
<p>raised when the operation raises an alert about its current state.</p>
<p>Not all operations raise <code>progress</code> events.</p>
<p>accepts one or more event handler functions.</p>
<p>Example:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// code to obtain promise object</div><div class="line">promise.progress(function(data) &#123;</div><div class="line">	// data will contain the data returned by the operation</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p>Chaining</p>
<p>add <code>done</code> and <code>fail</code> (and potentially <code>progress</code>) event handlers by chaining the method calls as demonstrated below :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// code to obtain promise object</div><div class="line">promise.done(function(data) &#123;</div><div class="line">	// success</div><div class="line">&#125;).fail(function(data) &#123;</div><div class="line">	// failure</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
<li><p><code>then</code></p>
<p>a single function allowing you to register <code>done</code>, <code>fail</code>, and <code>progress</code> event handlers in one call.</p>
<p>The sample below is identical to the chaining demonstration above.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// code to obtain promise object</div><div class="line">promise.then(function(data) &#123;</div><div class="line">    // success</div><div class="line">&#125;, function(data) &#123;</div><div class="line">    // failure</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Web workers</p>
<ul>
<li><p>Creating a web worker</p>
<p>made up of two components:</p>
<blockquote>
<p> the parent or calling script, and the worker or executing script.</p>
</blockquote>
<p><strong>does not</strong> have direct access to the calling environment or the UI.</p>
<p>use a messaging system to pass information to and from the worker.</p>
<ul>
<li><p>Creating the worker script</p>
<p>To create a web worker, you create a separate JavaScript file.</p>
<p>The code in the file <strong>will execute immediately</strong> when the worker object is created from the calling script.</p>
<p><code>self</code> : represents the worker. <code>self</code> , has one function named  <code>postMessage</code> and one event <code>message</code>.</p>
<p><code>postMessage</code>  is used to send data to the calling environment.</p>
<p><code>message</code> is raised when the calling script has sent a message to the worker.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">// send a signal back to the calling script</div><div class="line">self.postMessage(&apos;hello from the worker!&apos;);</div><div class="line"></div><div class="line">// Receive a message from the calling environment</div><div class="line">self.addEventListener(&apos;message&apos;, function(e) &#123;</div><div class="line">    // the data property will contain the data passed from the calling script</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>calling a web worker</p>
<ul>
<li><p>calling a web worker</p>
<p>to check to see if the brower supports web workers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">// Test if the browser supports web workers</div><div class="line">if(Worker == null) &#123;</div><div class="line">	alert(&apos;You need to upgrade your browser!&apos;);</div><div class="line">&#125; else &#123;</div><div class="line">	// do your work here</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>creating an instance of the Worker object</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">var worker = new Worker(&apos;script-location.js&apos;);</div><div class="line"></div><div class="line">// Register event handler</div><div class="line">worker.addEventListener(&apos;message&apos;, function(e) &#123;</div><div class="line">    $(&apos;#output&apos;).append(&apos;&lt;li&gt;&apos; + e.data + &apos;&lt;/li&gt;&apos;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">worker.postMessage(&apos;Started!&apos;);</div></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
</li>
<li><p>Designing your web workers</p>
<ul>
<li><p>creating a web worker that accepts status messages</p>
<p>Code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">// worker.js</div><div class="line"></div><div class="line">self.addEventListener(&apos;message&apos;, function(e) &#123;</div><div class="line">	if(e.data === &apos;START&apos;) &#123;</div><div class="line">		// Start message received.</div><div class="line">		// Begin work</div><div class="line">		startWork();</div><div class="line">	&#125; else if (e.data === &apos;STOP&apos;) &#123;</div><div class="line">		// Stop message received.</div><div class="line">		// Perform cleanup and terminate</div><div class="line">		stopWork();</div><div class="line">	&#125; else &#123;</div><div class="line">		// A different message has been received</div><div class="line">		// This is data that needs to be acted upon</div><div class="line">		processData(e.data);</div><div class="line">	&#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">function startWork() &#123;</div><div class="line">	// code to start performing work here</div><div class="line">	// send a message to the calling page</div><div class="line">	// worker has started</div><div class="line">	self.postMessage(&apos;STARTED&apos;);</div><div class="line">&#125;</div><div class="line"></div><div class="line">function stopWork() &#123;</div><div class="line">	// cleanupp code here</div><div class="line">	// stop the worker</div><div class="line">	self.postMessage(&apos;STOPPED&apos;);</div><div class="line">	self.close();</div><div class="line">&#125;</div><div class="line"></div><div class="line">function processData(data) &#123;</div><div class="line">	// perform the work on the data</div><div class="line">	self.postMessage(&apos;Processed &apos; + data);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
<li><p>calling a web worker that accepts messages</p>
<p>If you were using the worker that’s been designed above, you would use it by following a couple of basic steps.</p>
<ol>
<li>Create an instance of <code>Worker</code>, passing in the script.</li>
<li>Add the event handler for the <code>message</code> event. Ensure the event handler can respond to the status messages and normal data.</li>
<li>When you’re ready to start the worker’s work, call <code>postMessage(&#39;START&#39;);</code></li>
<li>When you’re done, send the stop message by calling <code>postMessage(&#39;STOP&#39;);</code></li>
</ol>
<p>Code:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">// inside of HTML file</div><div class="line"></div><div class="line">var worker = new Worker(&apos;worker.js&apos;);</div><div class="line"></div><div class="line">worker.addEventListener(&apos;message&apos;, function(e) &#123;</div><div class="line">    if(e.data === &apos;STARTED&apos;) &#123;</div><div class="line">        // worker has been started</div><div class="line">        // sample: update the screen to display worker started</div><div class="line">        $(&apos;#output&apos;).append(&apos;&lt;div&gt;Worker started&lt;/div&gt;&apos;);</div><div class="line">    &#125; else if(e.data === &apos;STOPPED&apos;) &#123;</div><div class="line">        // worker has been stopped</div><div class="line">        // cleanup work (if needed)</div><div class="line">        // sample: update the screen to display worker stopped</div><div class="line">        $(&apos;#output&apos;).append(&apos;&lt;div&gt;Worker stopped&lt;/div&gt;&apos;);</div><div class="line">    &#125; else &#123;</div><div class="line">        // Normal message. Act upon data as needed</div><div class="line">        // Sample: display data on screen</div><div class="line">        $(&apos;#output&apos;).append(&apos;&lt;div&gt;&apos; + e.data + &apos;&lt;/div&gt;&apos;);</div><div class="line">    &#125;</div><div class="line">&#125;);</div><div class="line"></div><div class="line">// When you&apos;re ready, send the start message</div><div class="line">worker.postMessage(&apos;START&apos;);</div><div class="line"></div><div class="line">// Send data as needed</div><div class="line">worker.postMessage(&apos;sample data&apos;);</div><div class="line"></div><div class="line">// Stop worker when you&apos;re done</div><div class="line">worker.postMessage(&apos;STOP&apos;);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
<li><p>Using deferred</p>
<ul>
<li><p>Deferred</p>
<p><code>Deferred</code> and <code>promise</code> seem very similar.The difference between the two is who uses which.</p>
<p><code>Deferred</code> is used to create, and manage, a <code>promise</code> object.</p>
<p>A <code>promise</code> object is returned by a long running operation, and only allows you to register event handlers.</p>
<p><code>Deferred</code> is the <strong>server</strong> side.  When <strong>create</strong> a long running function that will be called by other developers, you’ll use <code>Deferred</code>to return a <code>promise</code>.</p>
<p><code>promise</code> is the <strong>client</strong> side. When you <strong>call</strong> a long running function, it will return a <code>promise</code>.</p>
</li>
<li><p>When to use Deferred</p>
<p>when you are creating a function that will <strong>take an unusual amount of time</strong>, say one that will be working with graphics, you will want to use <code>Deffered</code> to return a <code>promise</code> to the caller.</p>
</li>
<li><p>Breaking down using Deferred</p>
<p>The basic steps are as follows.</p>
<ol>
<li>Create an instance of deferred: var deferred = $.Deferred();</li>
<li>Start your asynchronous operation, typically using a worker</li>
<li>Add the appropriate code to detect success and send the success signal: deferred.resolve()</li>
<li>Add the appropriate code to detect failure and send the failure signal: deferred.reject()</li>
<li>Return the promise: return deferred.promise();</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">function beginProcessing() &#123;</div><div class="line">	// Create deferred object &amp; make sure it&apos;s going to be in scope</div><div class="line">	var deferred = new $.Deferred();</div><div class="line"></div><div class="line">	// Create our worker (just like before)</div><div class="line">	var worker = new Worker(&apos;./Scripts/deferred.js&apos;);</div><div class="line"></div><div class="line">	// Register the message event handler</div><div class="line">	worker.addEventListener(&apos;message&apos;, function (e) &#123;</div><div class="line">		// simple messaging - if the worker is ready it&apos;ll send a message with READY as the text</div><div class="line">		if (e.data === &apos;READY&apos;) &#123;</div><div class="line">			// No UI code</div><div class="line">			// Progress notification</div><div class="line">			deferred.notify(&apos;Worker started&apos;);</div><div class="line">		&#125; else if(e.data === &apos;COMPLETED&apos;) &#123;</div><div class="line">			// processing is done</div><div class="line">			// No UI code</div><div class="line">			// Completed notification</div><div class="line">			deferred.resolve(&apos;Worker completed&apos;);</div><div class="line"></div><div class="line">			worker.terminate();</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line"></div><div class="line">	return deferred.promise();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<hr>
<p>  学这一章的时候，作为一个前端小白，我的内心响起一个声音：尼玛这都是什么鬼？</p>
<p>  说人话,附上我对这三个概念的理解：</p>
<p>  欢迎拍砖，皮厚不怕疼：P</p>
<p>  promise是一个需要运行很长时间的jQuery函数会返回的东东，告诉caller，函数的运行状态，caller可以根据状态来执行相应代码。</p>
<p>  Worker是用来在进程中插一脚的东东，通过message来传递状态，什么时候开始运行worker script，什么时候结束。</p>
<p>  Deferred呢？用来生成，管理promise。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/source/images/avtar.jpg"
               alt="Lucia" />
          <p class="site-author-name" itemprop="name">Lucia</p>
           
              <p class="site-description motion-element" itemprop="description">Learning is doing</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">42</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">10</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">13</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="Link" target="_blank" title="LinkLabel">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  LinkLabel
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://github.com/Lupeipei" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/Luciapeipei" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lucia</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://https-lupeipei-github-io.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  





  

  

  

  

</body>
</html>
