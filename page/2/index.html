<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="Learning is doing">
<meta property="og:type" content="website">
<meta property="og:title" content="Lucia">
<meta property="og:url" content="http://lupeipei.github.io/page/2/index.html">
<meta property="og:site_name" content="Lucia">
<meta property="og:description" content="Learning is doing">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lucia">
<meta name="twitter:description" content="Learning is doing">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lupeipei.github.io/page/2/"/>





  <title> Lucia </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lucia</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/26/git-clone-repos-with-submodules/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/26/git-clone-repos-with-submodules/" itemprop="url">
                  clone git repos with submodules
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-26T20:01:49+08:00">
                2017-12-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Git/" itemprop="url" rel="index">
                    <span itemprop="name">Git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/26/git-clone-repos-with-submodules/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/26/git-clone-repos-with-submodules/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>当你需要clone的repos中，含有submodules时，我们会用到<code>git clone —recursive</code>这个命令，我今个也遇到了，然后很不幸地掉坑了，一直无法成功clone，Google后，搞定！现附上解答细节。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>先来认识下git中的子模块submodule。</p>
<p>A <strong>submodule</strong> in a git repository is like a sub-directory which is really a separate git repository in its own right. This is a useful feature when you have a project in git which depends on a particular versions of other projects。</p>
<p>我的理解是当你的repos需要依赖于第三方的repos时，可以用submodule的方式，把这些repos作为你的子模块引入进来使用，而这些repos本身仍是独立的。</p>
<p>「添加submodule可以使用命令：<code>git submodule add</code> 后面加上URL即可。」</p>
<p>以clone<a href="https://github.com/strongqa/howitzer_example_cucumber" target="_blank" rel="external">howitzer_example_cucumber</a>为例。可以看到有四个文件长得不大一样，这些其实就是submodule。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fmue1wst1nj306i0dat95.jpg" alt=""></p>
<p>如果你直接clone, 使用命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone git@github.com:strongqa/howitzer_example_cucumber.git</div></pre></td></tr></table></figure>
<p>你会发现clone到本地后，那些submodule的文件存在，但里面没有任何文件。</p>
<p>这时就需要添加<code>`--recursive</code> `这个选项，<a href="https://github.com/strongqa/howitzer_example_cucumber" target="_blank" rel="external">howitzer_example_cucumber</a>文档下也列出了命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone --recursive git@github.com:strongqa/howitzer_example_cucumber.git</div></pre></td></tr></table></figure>
<p>终端输入后，报错：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fmuf22enbcj30s303s74w.jpg" alt=""></p>
<p>没有clone成功，显示<code>Permission denied (publickey)</code></p>
<p>google了一下，大部分人都是说修改你的ssh, 可我发现clone其他的repos没问题啊，说明我的ssh没毛病，clone带有submodule的却出问题，被拒绝，肯定跟submodule有关， 应该有其他方法。在stack overflow: <a href="https://stackoverflow.com/questions/39286354/git-clone-recursive-fails/47977557#47977557" target="_blank" rel="external">git clone –recursive fails</a>上找到了最方便的解答。</p>
<p><strong>非常直接：使用https格式</strong></p>
<p>终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone --recursive https://github.com/strongqa/howitzer_example_cucumber</div></pre></td></tr></table></figure>
<p>搞定！</p>
<p>PS. 看了其他文档，发现<strong>还有个方法</strong>，使用<code>git submodule init</code> , <code>git submodule update</code>.</p>
<p> 亲测有效，一并附上：</p>
<p>还是clone上面的repos，终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/strongqa/howitzer_example_cucumber</div><div class="line">cd howitzer_example_cucumber</div><div class="line">git submodule init</div><div class="line">git submodule update</div></pre></td></tr></table></figure>
<p>OK  !!</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97" target="_blank" rel="external">Git 工具 - 子模块</a></p>
<p><a href="https://stackoverflow.com/questions/39286354/git-clone-recursive-fails/47977557#47977557" target="_blank" rel="external">git clone –recursive fails</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/25/concepts-in-howitzer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/25/concepts-in-howitzer/" itemprop="url">
                  有关Howitzer中的几个概念
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-25T20:03:42+08:00">
                2017-12-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Howitzer/" itemprop="url" rel="index">
                    <span itemprop="name">Howitzer</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/25/concepts-in-howitzer/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/25/concepts-in-howitzer/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p><a href="http://howitzer-framework.io/" target="_blank" rel="external">howitzer</a>是一个基于ruby脚本的web验收测试框架， 初学时，对这个新伙伴是不甚了解，按照老规矩，看doc，看API。看完后，结合自己的理解，简单过一下里面几个重要的概念。</p>
<p>基本思路：</p>
<blockquote>
<ul>
<li>是什么？</li>
<li>怎么用？</li>
<li>用的时候要注意什么？</li>
</ul>
</blockquote>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>Driver</p>
<blockquote>
<p>是一个针对多个浏览器进行测试的通用界面，所有的Driver可以分成两类：</p>
<ul>
<li>Headless testing: 没有用户操作界面的模拟浏览器</li>
<li>real browser testing: 通过扩展程序或者插件来与真实的浏览器进行集成</li>
</ul>
</blockquote>
<p>Howitzer使用Capybara来对driver进行管理和设置，可以在<code>config/default.yml</code>中进行设置</p>
</li>
<li><p>Pages</p>
<p>介绍pages之前，介绍一下Page Object Model。</p>
<p>Page Object Model是一个自动化测试模版，创建用于测试的用户界面的抽象实体。可以将网站的每个page看作是一个类，然后通过调用这些类的实例来进行测试，而每个页面的元素可以看作是一个page的method，通过调用这些method来对该页面的元素进行调用。</p>
<p>这样，page就很好理解了。</p>
<p>Page是用于描述真实页面的类，比如在<code>web/pages</code>目录下，建立主页的文件，可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class Homepage &lt; Howitzer::Web::Page</div><div class="line">path &apos;/&apos;</div><div class="line">end</div><div class="line">HomePage.open #打开主页</div></pre></td></tr></table></figure>
<p>当然，这里的前提是你在<code>config/default.yml</code>中已经设置好了app_host</p>
<p>再比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class ProductPage &lt; Howitzer::Web::Page</div><div class="line">  path &apos;/products&#123;/id&#125;&apos;</div><div class="line">end</div><div class="line">ProductPage.open(id: 1) #=&gt; 访问 /products/1</div></pre></td></tr></table></figure>
<p>如果要指定特定的host，可以这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class AuthPage &lt; Howitzer::Web::Page</div><div class="line">	site &apos;https://example.com&apos;</div><div class="line">	path &apos;/auth&apos;</div><div class="line">end</div></pre></td></tr></table></figure>
<p><strong>Pages的验证：</strong></p>
<p>其实就是用于区分每个page的anchor，有三种不同的类型：</p>
<p><strong>URL，title，element</strong></p>
<p>比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  path &apos;/&apos;</div><div class="line">  validate :url, /\A(?:.*?:\/\/)?[^\/]*\/?\z/</div><div class="line">end</div></pre></td></tr></table></figure>
<p>使用<code>.displayed?</code>可以去判断一个页面的所有验证是否都通过。</p>
<p>用这个可以检查特定的页面成功打开，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">class AccountPage &lt; Howitzer::Web::Page</div><div class="line">  path &apos;/accounts/&#123;id&#125;&apos;</div><div class="line"> end</div><div class="line"> AccountPage.open(id: 22)</div><div class="line"> expect(AccountPage).to be_displayed</div></pre></td></tr></table></figure>
</li>
<li><p>Elements</p>
<p>页面的元素，可以是单个元素，比如搜索栏，也可以是元素集合，比如菜单中的选项集。</p>
<p>比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  element :test_name1, &apos;.foo&apos;                         #css locator, default</div><div class="line">  element :test_name2, :css, &apos;.foo&apos;                   #css locator</div><div class="line">  element :test_name3, :xpath, &apos;//div[@value=&quot;bar&quot;]&apos;  #xpath locator</div><div class="line"></div><div class="line">  element :test_link1, :link, &apos;Foo&apos;                   #link locator by &apos;Foo&apos; text</div><div class="line">  element :test_link2, :link, &apos;bar&apos;                   #link locator by &apos;bar&apos; id</div><div class="line"></div><div class="line">  element :test_field1, :fillable_field, &apos;Foo&apos;        #field locator by &apos;Foo&apos; text</div><div class="line">  element :test_field2, :fillable_field, &apos;bar&apos;        #field locator by &apos;bar&apos; id</div><div class="line">  element :test_field3, :fillable_field, &apos;baz&apos;        #field locator by &apos;baz&apos; name</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这里要注意，不能通过page类直接调用element，需要在page类中定义一个method来调用element。</p>
<p>比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  element :new_button, :xpath, &quot;.//*[@name=&apos;New&apos;]&quot;</div><div class="line"></div><div class="line">  def start_new_project</div><div class="line">    new_button_element.click</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">HomePage.on &#123; new_button_element.click &#125; # 不正确的用法</div><div class="line">HomePage.on &#123; start_new_project &#125; # 正确的打开方式</div></pre></td></tr></table></figure>
</li>
<li><p>Sections</p>
<p>在howitzer中，有一个Howitzer::Web::Section类。</p>
<p>section的使用场景：当多个页面中出现相同的部分时，或者某部分在一个页面中频繁出现，类似rails中的公用表单。</p>
<p>使用<code>&lt;section_name&gt;_section</code>来生成一个section的实例,  这里使用一个特别的me方法，通过参数指定section，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">class MenuSection &lt; Howitzer::Web::Section</div><div class="line">  me &quot;#gbx3&quot; #section的父元素</div><div class="line">end</div></pre></td></tr></table></figure>
<p>使用的时候，这么用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># 定义section:</div><div class="line"></div><div class="line">class MenuSection &lt; Howitzer::Web::Section</div><div class="line">  me &quot;#gbx3&quot;</div><div class="line">end</div><div class="line"></div><div class="line"># 包含menusection的页面:</div><div class="line"></div><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  section :menu</div><div class="line">end</div><div class="line"></div><div class="line"># 页面调用section:</div><div class="line"></div><div class="line">HomePage.on &#123; menu_section &#125;</div></pre></td></tr></table></figure>
<p>当两个页面有相同的section，但是跟节点不同时，可以这么用：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"># 定义section</div><div class="line"></div><div class="line">class MenuSection &lt; Howitzer::Web::Section</div><div class="line">  me &apos;#gbx3&apos;</div><div class="line">end</div><div class="line"></div><div class="line"># 定义两个page类，都包含有menu这个section</div><div class="line"></div><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  section :menu # 使用默认的selector</div><div class="line">end</div><div class="line"></div><div class="line">class SearchResultsPage &lt; Howitzer::Web::Page</div><div class="line">  section :menu, &quot;#gbx48&quot; # 覆盖了默认的selector</div><div class="line">end</div></pre></td></tr></table></figure>
<p>测试section是否存在某个页面：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class MenuSection &lt; Howitzer::Web::Section</div><div class="line">  me &apos;#gbx3&apos;</div><div class="line">  element :search, &quot;a.search&quot;</div><div class="line">end</div><div class="line"></div><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  section :menu</div><div class="line">end</div><div class="line"></div><div class="line">HomePage.on &#123; has_menu_section? &#125; #=&gt; returns true or false</div></pre></td></tr></table></figure>
<p>多层级section的使用，看一个登陆的例子，结合了cucumber 的step定义：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"># define a page that contains an area that contains a section for both logging in and registration, then modeling each of the sub sections separately</div><div class="line"></div><div class="line">class LoginSection &lt; Howitzer::Web::Section</div><div class="line">  me &quot;div.login-area&quot;</div><div class="line">  element :username, &quot;#username&quot;</div><div class="line">  element :password, &quot;#password&quot;</div><div class="line">  element :sign_in, &quot;button&quot;</div><div class="line"></div><div class="line">  def login(username, password)</div><div class="line">    username_element.set username</div><div class="line">    password_element.set password</div><div class="line">    sign_in_element.click</div><div class="line">  end  </div><div class="line">end</div><div class="line"></div><div class="line">class RegistrationSection &lt; Howitzer::Web::Section</div><div class="line">  me &quot;div.reg-area&quot;</div><div class="line">  element :first_name, &quot;#first_name&quot;</div><div class="line">  element :last_name, &quot;#last_name&quot;</div><div class="line">  element :next_step, &quot;button.next-reg-step&quot;</div><div class="line"></div><div class="line">  def sign_up(first_name, last_name)</div><div class="line">    first_name_element.set first_name</div><div class="line">    first_name_element.set last_name</div><div class="line">    next_step_element.click</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">class LoginRegistrationFormSection &lt; Howitzer::Web::Section</div><div class="line">  me &quot;div.login-registration&quot;</div><div class="line">  section :login</div><div class="line">  section :registration  </div><div class="line">end</div><div class="line"></div><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  section :login_and_registration</div><div class="line">end</div><div class="line"></div><div class="line"># how to login (fatuous, but demonstrates the point):</div><div class="line">Then /^I sign in$/ do</div><div class="line">  HomePage.open</div><div class="line">  HomePage.on do</div><div class="line">    is_expected.to have_login_and_registration_section</div><div class="line">    login_and_registration_section.login_section.login(&apos;bob&apos;, &apos;p4ssw0rd&apos;)</div><div class="line">  end  </div><div class="line">end</div><div class="line"></div><div class="line"># how to sign up:</div><div class="line"></div><div class="line">When /^I enter my name into the home page&apos;s registration form$/ do</div><div class="line">  HomePage.open</div><div class="line">  HomePage.on do</div><div class="line">    expect(login_and_registration_section.registration_section).to have_first_name</div><div class="line">    expect(login_and_registration_section.registration_section).to have_last_name</div><div class="line">    login_and_registration_section.registration_section.signup(&apos;Bob&apos;, &apos;Arum&apos;)</div><div class="line">  end  </div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>IFrames</p>
<p>IFrames 在howitzer中被声明为一个 <code>Howitzer::Web::Page</code>类，通过包含该frame 的section或者page来引用，比如：</p>
<p>创建一个frame实例，在DashboardPage中引用它，测试该frame是否在DashboardPage中存在。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">class FbPage &lt; Howitzer::Web::Page</div><div class="line">  element :some_text_field, &quot;input.username&quot;</div><div class="line">end</div><div class="line"></div><div class="line">class DashboardPage &lt; Howitzer::Web::Page</div><div class="line">  iframe :fb, &quot;#fb&quot;</div><div class="line">end</div><div class="line"></div><div class="line">DashboardPage.open</div><div class="line">DashboardPage.on &#123; is_expected.to have_fb_iframe &#125;</div></pre></td></tr></table></figure>
<p>与iframe中的元素进行交互, 这里用了cucumber login的step definition来说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"># Howitzer::Web::Page representing the iframe</div><div class="line">class LoginPage &lt; Howitzer::Web::Page</div><div class="line">  element :username, &quot;input.username&quot;</div><div class="line">  element :password, &quot;input.password&quot;</div><div class="line"></div><div class="line">  def login(username, password)</div><div class="line">    username_element.set username</div><div class="line">    password_element.set password</div><div class="line">  end  </div><div class="line">end</div><div class="line"></div><div class="line"># Howitzer::Web::Page representing the page that contains the iframe</div><div class="line">class HomePage &lt; Howitzer::Web::Page</div><div class="line">  iframe :login, &quot;#login_and_registration&quot;</div><div class="line">end</div><div class="line"></div><div class="line"># cucumber step that performs login</div><div class="line">When /^I log in$/ do</div><div class="line">  HomePage.open</div><div class="line">  HomePage.on do</div><div class="line">    login_iframe do |frame|</div><div class="line">      #`frame` is an instance of the `LoginPage` class</div><div class="line">      frame.login(&apos;admin&apos;, &apos;p4ssword&apos;)</div><div class="line">    end</div><div class="line">  end  </div><div class="line">end</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>参考：</p>
<p><a href="http://docs.howitzer-framework.io/" target="_blank" rel="external">howitzer doc</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/17/use-simple-navigation-in-rails/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/17/use-simple-navigation-in-rails/" itemprop="url">
                  在rails中使用simple navigation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-17T17:31:24+08:00">
                2017-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/17/use-simple-navigation-in-rails/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/17/use-simple-navigation-in-rails/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p><a href="https://github.com/codeplant/simple-navigation" target="_blank" rel="external">simple navigation</a>是一个ruby库，用来生成navigation的，它的优势是可以定制自己的导航菜单，特别是当你有多个菜单或者你的菜单相对比较复杂的时候。</p>
<p>可是官方只是给出了一个<a href="http://simple-navigation-demo.codeplant.ch/" target="_blank" rel="external">online demo</a>，并没有给到具体的install  和 usage，这让初次接触simple navigation的小白有些被动，Google了一些文章，实做了一下，知道怎么玩啦，记录下以备用。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>安装gem</p>
<p>在gemfile文件中，添加如下：【建议把bootstrap也安装了】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gem &apos;bootstrap-sass&apos;</div><div class="line">gem &apos;simple-navigation&apos;</div><div class="line">gem &apos;simple-navigation-bootstrap&apos;</div></pre></td></tr></table></figure>
<p>终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bundle install</div></pre></td></tr></table></figure>
<p>重启服务器：<code>rails s</code></p>
<p>将<code>application.css</code>文件更名为<code>application.scss</code>，终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv app/assets/stylesheets/application.css app/assets/stylesheets/application.scss</div></pre></td></tr></table></figure>
<p>在<code>application.scss</code>文件中，添加如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@import &quot;bootstrap-sprockets&quot;;</div><div class="line">@import &quot;bootstrap&quot;;</div></pre></td></tr></table></figure>
<p>生成menu 的configuration文件<code>navigation.rb</code>， 终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bundle exec rails g navigation_config</div></pre></td></tr></table></figure>
<p>此时，config文件下会生成一个<code>navigation.rb</code>文件，长这样：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fmjtnki6lbj30o007tmyr.jpg" alt=""></p>
<p>在文件的下方，已经列出了一些用法，包括如何添加有sub navigation的item，添加指定条件的item，比如登陆，是否为管理员等等。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fmjtwnw2dzj30nv0gb42w.jpg" alt=""></p>
</li>
</ul>
<ul>
<li><p>设置menu</p>
<p>我们来改改，定制一下，比如下面这样：【当然，请确保你写的path是有效的……】</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fmjvdavg84j30le04n74t.jpg" alt=""></p>
</li>
<li><p>展示menu</p>
<p>在需要展示的页面中，添加:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= render_navigation(:expand_all =&gt; true)%&gt;</div></pre></td></tr></table></figure>
<p>这里，expand_all 为true是指全部铺开，即子菜单未被激活也是展开的，效果类似这样：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fmjve7qr4oj305z04it8l.jpg" alt=""></p>
<p>这里可以用参数level来控制层级的显示，上面菜单 + 子菜单，只有两级，所以用</p>
<p><code>render_navigation(:level =&gt; 2)</code>也是可以的。如果改成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= render_navigation(:level =&gt; 1)%&gt;</div></pre></td></tr></table></figure>
<p>则显示一级菜单，像这样：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fmjvz5s8kej3063027q2r.jpg" alt=""></p>
<p>另：</p>
<p>看到GitHub 中提到使用<code>&lt;%= render_navigation(:expand_all =&gt; false)%&gt;</code> 来让未被激活的子菜单隐藏，没有设置的情况下，:expand_all是默认为false的, 我试了一下，没有成功，所有菜单还是全部铺开，有些奇怪。</p>
</li>
</ul>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://github.com/codeplant/simple-navigation" target="_blank" rel="external">simple-navigation</a></p>
<p><a href="https://github.com/pdf/simple-navigation-bootstrap" target="_blank" rel="external">simple-navigation-bootstrap</a></p>
<p><a href="http://www.xoen.org/2012/05/bootstrap-menus-in-rails/" target="_blank" rel="external">bootstrap menu in rails</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/13/methods-of-Array-in-Ruby/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/13/methods-of-Array-in-Ruby/" itemprop="url">
                  Ruby中Array 的一些常用方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-13T17:11:08+08:00">
                2017-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ruby/" itemprop="url" rel="index">
                    <span itemprop="name">Ruby</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/13/methods-of-Array-in-Ruby/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/13/methods-of-Array-in-Ruby/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>工作中常常要处理Array，索性把ruby 中Array的一些常用方法小结一下，加深印象。</p>
<p>先来看看Array中除去继承自Object之外的，有多少public methods</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(Array.instance_methods - Object.instance_methods).count</div><div class="line"># 输出:</div><div class="line">120</div><div class="line"># ruby版本为 2.3.1</div></pre></td></tr></table></figure>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>建立空数组：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[]</div><div class="line">Array.new</div></pre></td></tr></table></figure>
</li>
<li><p>使用%w, %i 创建非空数组</p>
<p><strong>创建不包含空白的字符串数组，可用%w</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">%w(Ruby Python Scheme)</div><div class="line"># 输出:</div><div class="line">[&quot;Ruby&quot;, &quot;Python&quot;, &quot;Scheme&quot;]</div></pre></td></tr></table></figure>
<p><strong>创建元素为符号的数组，可用%i</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">%i(Ruby Python Scheme)</div><div class="line"># 输出:</div><div class="line">[:Ruby, :Python, :Scheme]</div></pre></td></tr></table></figure>
</li>
<li><p>数组的大小</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[4, 8, 15, 16, 23, 42].count</div><div class="line">[4, 8, 15, 16, 23, 42].size</div><div class="line">[4, 8, 15, 16, 23, 42].length</div><div class="line"># 输出:</div><div class="line">6</div><div class="line">6</div><div class="line">6</div></pre></td></tr></table></figure>
</li>
<li><p>将string转化为array</p>
<p> split</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&quot;a, b, c, d&quot;.split(&quot;, &quot;)</div><div class="line"># 输出:</div><div class="line">[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;]</div></pre></td></tr></table></figure>
</li>
<li><p>将array转化为string</p>
<p>join</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;].join(&quot;, &quot;)</div><div class="line"># 输出:</div><div class="line">&quot;a, b, c, d&quot;</div></pre></td></tr></table></figure>
</li>
<li><p>将hash 转化为array</p>
<p>to_a</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">table = &#123;:&quot;color1&quot; =&gt; &quot;blue&quot;, :&quot;color2&quot; =&gt; &quot;red&quot;&#125;</div><div class="line">table.to_a</div><div class="line"># 输出:</div><div class="line">[[:color1, &quot;blue&quot;], [:color2, &quot;red&quot;]]</div><div class="line"></div><div class="line">table.to_a.flatten</div><div class="line"># 输出:</div><div class="line">[:color1, &quot;blue&quot;, :color2, &quot;red&quot;]</div></pre></td></tr></table></figure>
</li>
<li><p>在数组中提取元素</p>
<p>index从0开始，index为正时，从array的第一个元素开始，index为负时，从最后一个元素开始</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[1, 2, 3, 4, 5][2]</div><div class="line"># 输出:</div><div class="line">3</div><div class="line"></div><div class="line">[1, 2, 3, 4, 5][-1]</div><div class="line"># 输出:</div><div class="line">5</div></pre></td></tr></table></figure>
</li>
<li><p>给数组添加元素</p>
<p>在尾部添加&lt;&lt;  or push</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[1, 2, 3, 4, 5] &lt;&lt; &quot;woot&quot;</div><div class="line"># 输出: [1, 2, 3, 4, 5, &quot;woot&quot;]</div><div class="line"></div><div class="line">[1, 2, 3, 4, 5].push(&quot;woot&quot;)</div><div class="line"># 输出: [1, 2, 3, 4, 5, &quot;woot&quot;]</div></pre></td></tr></table></figure>
<p>在开头添加 unshift</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[1, 2, 3, 4, 5].unshift(0)</div><div class="line"># 输出:</div><div class="line">[0, 1, 2, 3, 4, 5]</div></pre></td></tr></table></figure>
</li>
<li><p>连接数组concat ／ +</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[1, 2, 3, 4, 5].concat([6, 7])</div><div class="line"># 输出:</div><div class="line">[1, 2, 3, 4, 5, 6, 7]</div><div class="line"></div><div class="line">[1, 2, 3, 4, 5] + [6, 7]</div><div class="line"># 输出:</div><div class="line">[1, 2, 3, 4, 5, 6, 7]</div></pre></td></tr></table></figure>
</li>
<li><p>数组转换map, collect</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[1, 2, 3, 4, 5].map &#123;|x| x * 3&#125;</div><div class="line"># 输出:</div><div class="line">[3, 6, 9, 12, 15]</div><div class="line"></div><div class="line">[1, 2, 3, 4, 5].collect &#123;|x| x + 2 &#125;</div><div class="line"># 输出:</div><div class="line">[3, 4, 5, 6, 7]</div></pre></td></tr></table></figure>
</li>
<li><p>获取分散的数组values_at</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[1,2,3,4,5,6].values_at(1,2,4)</div><div class="line"># 输出:</div><div class="line">[2, 3, 5]</div></pre></td></tr></table></figure>
</li>
<li><p>筛选特定的元素 select</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[1,2,3,4,5,6].select &#123;|number| number % 2 == 0&#125;</div><div class="line"># 输出:</div><div class="line">[2, 4, 6]</div></pre></td></tr></table></figure>
</li>
<li><p>删除元素 delete</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [1,3,5,4,6,7]</div><div class="line">a.delete(5) # 注意这里delete的参数是元素，不是index</div><div class="line"># 输出:</div><div class="line">5</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1, 3, 4, 6, 7]</div></pre></td></tr></table></figure>
<p>删除指定index的元素delete_at 【破坏性修改】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [1,3,5,4,6,7]</div><div class="line">a.delete_at(5)</div><div class="line"># 输出:</div><div class="line">7</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1,3,5,4,6]</div></pre></td></tr></table></figure>
<p>删除符合要求的delete_if【破坏性修改】, reject</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[1,2,3,4,5,6,7,8,9].delete_if&#123;|x| x % 2 == 0&#125;</div><div class="line"># 输出:</div><div class="line">[1, 3, 5, 7, 9]</div><div class="line"></div><div class="line">[1,2,3,4,5,6,7,8,9].reject&#123;|x| x % 2 == 0&#125;</div><div class="line"># 输出:</div><div class="line">[1, 3, 5, 7, 9]</div></pre></td></tr></table></figure>
<p>删除所有nil元素compact</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [nil, 4, nil, 8, 15, 16, nil, 23, 42, nil]</div><div class="line">a.compact</div><div class="line"># 输出:</div><div class="line">[4, 8, 15, 16, 23, 42]</div></pre></td></tr></table></figure>
<p>删除指定部分slice</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">a = [1,3,5,4,6,7]</div><div class="line">a.slice(1,2)</div><div class="line"># 输出:</div><div class="line">[3, 5]</div><div class="line"></div><div class="line">a.slice!(1,2)</div><div class="line"># 输出:</div><div class="line">[3, 5]</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1, 4, 6, 7]</div></pre></td></tr></table></figure>
<p>删除第X个元素shift, 默认是第一个【破坏性修改】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">a = [1,2,3,4,5,6,7,8,9]</div><div class="line">a.shift</div><div class="line"># 输出:</div><div class="line">1</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[2, 3, 4, 5, 6, 7, 8, 9]</div><div class="line"></div><div class="line">a.shift(2)</div><div class="line"># 输出:</div><div class="line">[2, 3]</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[ 4, 5, 6, 7, 8, 9]</div></pre></td></tr></table></figure>
<p>删除最后X个元素pop ，默认是最后一个【破坏性修改】</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">a = [1,2,3,4,5,6,7,8,9]</div><div class="line">a.pop</div><div class="line"># 输出:</div><div class="line">9</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1,2,3,4,5,6,7,8]</div><div class="line"></div><div class="line">a.pop(3)</div><div class="line"># 输出:</div><div class="line">[6,7,8]</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1,2,3,4,5]</div></pre></td></tr></table></figure>
<p>ruby中method后面带有！符号的都是具有破坏性的修改, 但是那些没有带！尾巴的也不是那么友好，比如上面的shift， pop。 那么可有办法保护我们的array？有滴，上freeze</p>
<p>freeze可以禁止具有破坏性的方法来修改对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">a = [1,2,3,4,5,6,7,8,9]</div><div class="line">a.freeze</div><div class="line">a.pop</div><div class="line"># 输出:</div><div class="line">can&apos;t modify frozen Array</div><div class="line"></div><div class="line">a</div><div class="line"># 输出:</div><div class="line">[1,2,3,4,5,6,7,8,9]</div></pre></td></tr></table></figure>
</li>
<li><p>去除重复元素uniq</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [1,3,5,4,6,7,1,3,7]</div><div class="line">a.uniq</div><div class="line"># 输出:</div><div class="line">[1, 3, 5, 4, 6, 7]</div></pre></td></tr></table></figure>
</li>
<li><p>平坦化数组flatten</p>
<p>前面出现过，再多看些例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[4, [8], [15], [16, [23, 42]]].flatten</div><div class="line"># 输出:</div><div class="line">[4, 8, 15, 16, 23, 42]</div></pre></td></tr></table></figure>
<p>不传递参数时，默认是完全平坦化，传递参数，则平坦化层级X，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[4, [8], [15], [16, [23, [42, 43]]]].flatten(1)</div><div class="line"># 输出:</div><div class="line">[4, 8, 15, 16, [23, [42, 43]]]</div><div class="line"></div><div class="line">[4, [8], [15], [16, [23, [42, 43]]]].flatten(2)</div><div class="line"># 输出:</div><div class="line">[4, 8, 15, 16, 23, [42, 43]]</div><div class="line"></div><div class="line">[4, [8], [15], [16, [23, [42, 43]]]].flatten(3)</div><div class="line"># 输出:</div><div class="line"> [4, 8, 15, 16, 23, 42, 43]</div></pre></td></tr></table></figure>
</li>
<li><p>获取某个元素的出现次数count</p>
<p>count前面已经出现过，用于计算数组的长度，不带参数，如果传递参数给到count，则返回该元素在数组中出现的次数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[42, 8, 15, 16, 23, 42].count(42)</div><div class="line"># 输出:</div><div class="line">2</div></pre></td></tr></table></figure>
</li>
<li><p>排序sort</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [1, 3, 5, 4, 6, 7]</div><div class="line">a.sort</div><div class="line"># 输出:</div><div class="line"> [1, 3, 4, 5, 6, 7]</div></pre></td></tr></table></figure>
<p>使用块来指定排序规则：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [&quot;ruby&quot;, &quot;python&quot;, &quot;C&quot;, &quot;C++&quot;, &quot;java&quot;]</div><div class="line">a.sort</div><div class="line"># 输出:</div><div class="line">[&quot;C&quot;, &quot;C++&quot;, &quot;java&quot;, &quot;python&quot;, &quot;ruby&quot;]    # 默认按照首字母排序</div><div class="line"></div><div class="line">a.sort &#123;|a, b| a.length &lt;=&gt; b.length&#125;</div><div class="line"># 输出:</div><div class="line">[&quot;C&quot;, &quot;C++&quot;, &quot;ruby&quot;, &quot;java&quot;, &quot;python&quot;]   # 按照字符长度来排序</div></pre></td></tr></table></figure>
<p>同样的，sort！方法具有破坏性。</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>先整这么多，用到新的再补上，嘿哈</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/06/about-music/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/06/about-music/" itemprop="url">
                  关于听歌这件事
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-06T19:55:29+08:00">
                2017-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/碎语成篇/" itemprop="url" rel="index">
                    <span itemprop="name">碎语成篇</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>送君一掬温柔</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=28921691&auto=1&height=66"></iframe>

<p>一直觉得音乐是个特别神奇的东西。</p>
<p>无形无色，却能有着撩拨人心的力量。</p>
<p>开心了，听歌助兴，不开心了，听歌释怀。</p>
<p>疲惫时，一首歌，仿佛能治愈，能满血复活。</p>
<p>晴朗的日子里，踩着单车，塞上耳机，哼歌吹哨，真真是享受。</p>
<p>记得《偷影子的人》中，男主有个嗜好，每天早上都要来一段大提琴曲，而他最终找到了那个有着大提琴音色般笑声的克蕾尔，彼时她已经是一名大提琴家。</p>
<p>也许耳朵才是抵达心灵的窗口。</p>
<p>嗯，深情不过陪伴，温柔最是得人心。</p>
<p>愿你在音符中寻觅到那份温暖与温柔。</p>
<p>好了，不矫情了，听歌吧。</p>
<p>PS：</p>
<p>为什么要写这么一篇小短文？</p>
<p>其实，我只是想试试如何在hexo里面添加音乐文件……</p>
<p>事实证明，可以边看文章边听歌了……</p>
<p>嗯，其实，还是一心一意听歌的好，好音乐值得去专注。</p>
<hr>
<p>参考：</p>
<p><a href="http://www.jianshu.com/p/a52b68794a6b" target="_blank" rel="external">hexo创建个人博客（附加插入音乐、分享、评论、标签页、搜索）</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/01/deal-with-special-character-when-using-restclient-url/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/01/deal-with-special-character-when-using-restclient-url/" itemprop="url">
                  RestClient：URL中特殊字符的处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-01T19:49:13+08:00">
                2017-12-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/01/deal-with-special-character-when-using-restclient-url/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/01/deal-with-special-character-when-using-restclient-url/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>URL中通常会遇到特殊字符的处理，比如某一个参数中含有中文 或者”#$ ^ &amp; * + =”等特殊符号。</p>
<p>如何处理才能正确传递参数？</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p><strong>处理之前，先来点小知识。</strong></p>
<p>URL中一些特殊字符及对应的Url编码如下：</p>
<table>
<thead>
<tr>
<th>Character</th>
<th>From UTF-8</th>
</tr>
</thead>
<tbody>
<tr>
<td>space</td>
<td>%20</td>
</tr>
<tr>
<td>!</td>
<td>%21</td>
</tr>
<tr>
<td>“</td>
<td>%22</td>
</tr>
<tr>
<td>#</td>
<td>%23</td>
</tr>
<tr>
<td>$</td>
<td>%24</td>
</tr>
<tr>
<td>%</td>
<td>%25</td>
</tr>
<tr>
<td>&amp;</td>
<td>%26</td>
</tr>
<tr>
<td>‘</td>
<td>%27</td>
</tr>
<tr>
<td>(</td>
<td>%28</td>
</tr>
<tr>
<td>)</td>
<td>%29</td>
</tr>
<tr>
<td>*</td>
<td>%2A</td>
</tr>
<tr>
<td>+</td>
<td>%2B</td>
</tr>
<tr>
<td>,</td>
<td>%2C</td>
</tr>
<tr>
<td>-</td>
<td>%2D</td>
</tr>
<tr>
<td>.</td>
<td>%2E</td>
</tr>
<tr>
<td>/</td>
<td>%2F</td>
</tr>
</tbody>
</table>
<p><strong>小案例：从一个中文字符的处理开始</strong></p>
<p>restclient中，如果URL含有中文等非英文的特殊字符， 只需要使用<strong>URI::encode</strong>即可。比如下面这个例子：</p>
<p>网址是 <a href="http://example.com，" target="_blank" rel="external">http://example.com，</a> 用户输入关键字“伊丽莎白好乖滴 ”查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">url = &apos;http://example.com/search?keyword=伊丽莎白好乖滴&apos;</div><div class="line">RestClient.get(url)</div></pre></td></tr></table></figure>
<p>这里，使用restclient发出get请求，会出现URI::InvalidURIError 的错误.</p>
<p>正确的打开方式可以像这样：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">require &apos;addressable/uri&apos;</div><div class="line">url = &apos;http://example.com/search?keyword=伊丽莎白好乖滴&apos;</div><div class="line">RestClient.get(URI::encode(url))</div></pre></td></tr></table></figure>
<p>这样，url中的中文字符会转化为下面这样的ascii码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://example.com/search?keyword=%E4%BC%8A%E4%B8%BD%E8%8E%8E%E7%99%BD%E5%A5%BD%E4%B9%96%E6%BB%B4</div></pre></td></tr></table></figure>
<p><strong>特别加餐：传递给参数的值中，含有&amp;等特殊字符</strong></p>
<p>需要特别提一句的是，如果你的URL是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url = &apos;http://example.com/search?keyword=XXX&amp;city=shanghai&amp;type=food&apos;</div></pre></td></tr></table></figure>
<p>而你希望将<code>&amp;s</code>传递给keyword， 使用URI::encode时，会是这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://example.com/search?keyword=&amp;s&amp;city=shanghai&amp;type=food</div></pre></td></tr></table></figure>
<p>这里，因为URL中传递参数时，是用”&amp;”符号隔开的，所以rest client识别的时候，会认为keyword这个参数并没有赋值， 而<code>&amp;s</code>中，s表示另一个参数, 且没有赋值，这样，发出请求后会报错，这种情况如何解决？做这样的处理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">URI::encode(url).sub(&quot;&amp;&quot;, &quot;%26&quot;)</div></pre></td></tr></table></figure>
<p>encode后，将第一个&amp;, 也就是<code>&amp;s</code>转变为”%26s”, 再传递给RestClient。</p>
<p>这里你可能想要问，为什么不直接传递”%26s”？</p>
<p>问得好！如果直接将”%26s”传递给keyword，经过URI::encode之后，keyword接收到的就会是：“%2526s”， why？Cause it will encode “%” to “%25”。</p>
<p>当然，不只是rest client，其他需要针对URL进行encoding的，也可以进行类似的处理。</p>
<h4 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h4><p><a href="https://github.com/rest-client/rest-client/issues/476" target="_blank" rel="external">URL with square brackets: URI::InvalidURIError</a></p>
<p><a href="https://www.w3schools.com/tags/ref_urlencode.asp" target="_blank" rel="external">HTML URL Encoding Reference</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/22/custom-exceptions-in-ruby/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/22/custom-exceptions-in-ruby/" itemprop="url">
                  如何在ruby中的定制你的exception？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-22T20:31:02+08:00">
                2017-11-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ruby/" itemprop="url" rel="index">
                    <span itemprop="name">Ruby</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/22/custom-exceptions-in-ruby/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/22/custom-exceptions-in-ruby/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>在ruby中抛出异常时，除了输出程序本身的exception之外，你可能还希望它输出一些其他信息，例如指出是哪个文件，对应的id是什么等，以便后期查找。</p>
<p>这时，可以通过定制ruby的exception来解决。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p><strong>看个场景：</strong></p>
<p>以接口测试的一个情况为例，说明一下怎么玩。</p>
<p>用户A在做接口测试时，使用restclient的get, put, post, delete发出请求，出错，这时，用户A除了希望获取到rest client本身的Exception外，还希望可以输出reponse.headers中的traceid， 类似这样：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1flr4wg5vwhj30pp015gll.jpg" alt=""></p>
<p>那么如何将traceid加入到exception的message内容中去呢？</p>
<p><strong>重新定义一个class，继承自ruby的StandardError， 将需要输出的信息作为变量传递给该class即可。</strong></p>
<p>具体这么来：</p>
<p>新建一个class ： MyError</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1flr4v3whjkj30kp0423yq.jpg" alt=""></p>
<p>在使用restclient时，raise 异常即可。具体代码类似这样👇：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1flr4ju0i95j30k305f0tb.jpg" alt=""></p>
<p>简单说明一下：</p>
<p>我们去获取网站example.com首页的内容，用rescue来捕捉异常，并将restclient的异常信息<code>e. message</code> 和<code>e.response.headers[:traceid]</code>合并起来作为参数传递，生成MyError的一个实例 <code>my_error</code> ，并针对response的code做判断，如果code不在200～206， 则抛出<code>my_error</code>.</p>
<p>这里，其实是将标准的出错信息加了个定制的尾巴，父对象StandardError接受到新的message，在出错时抛出。</p>
<p>OK啦。</p>
<p>很简单是不是？得空可以试试定制化你的exceptions：P</p>
<h4 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h4><p>参考：</p>
<p><a href="http://blog.honeybadger.io/ruby-custom-exceptions/" target="_blank" rel="external">Custom exceptions in Ruby</a></p>
<p><a href="http://blog.honeybadger.io/ruby-exception-vs-standarderror-whats-the-difference/" target="_blank" rel="external">Ruby’s Exception vs StandardError: What’s the difference?</a>Â</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/21/read-the-body-of-400-response-with-ruby-exception-handling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/21/read-the-body-of-400-response-with-ruby-exception-handling/" itemprop="url">
                  使用ruby的异常处理来读取rest client中的bad request
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-21T20:35:58+08:00">
                2017-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BDD/" itemprop="url" rel="index">
                    <span itemprop="name">BDD</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/21/read-the-body-of-400-response-with-ruby-exception-handling/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/21/read-the-body-of-400-response-with-ruby-exception-handling/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>我们在使用rest-client去发出请求时，result code是200 固然很好，但有时候我们也希望能读取到Exceptions， 例如读取result code是400bad request的response内容，怎么做？</p>
<p>看个例子。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>场景：用户A想要通过接口获取到个人信息，代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">respoonse = RestClient.get &apos;http://example.com/myprofile?access_token=#&#123;access_token&#125;&apos;</div><div class="line">profile_response = JSON.parse(respoonse.body)</div></pre></td></tr></table></figure>
<p>其中，如果<code>access_token</code>过期或者无效，用户希望得到这样的结果：</p>
<ul>
<li>返回 400 Bad Request</li>
<li>返回一个JSON格式的reponse body ，内容像这样：</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;	      </div><div class="line">   &quot;code&quot;: 400,</div><div class="line">   &quot;error&quot;: &#123;</div><div class="line">      &quot;message&quot;: &quot;The access token could not be decrypted&quot;,</div><div class="line">      &quot;type&quot;: &quot;OAuthException&quot;</div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这时，如果你的<code>access_token</code>是过期或者无效的，终端运行的时候，会报错400 Bad Request ，但是却没有返回对应的response。</p>
<p>如何解决？</p>
<p>其实，如果你熟悉ruby的异常处理，就会发现很简单，把上述的代码改成如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">body = begin</div><div class="line">  respoonse = RestClient.get &apos;http://example.com/myprofile?access_token=#&#123;access_token&#125;&apos;</div><div class="line">  response.body</div><div class="line">rescue RestClient::ExceptionWithResponse  =&gt; e</div><div class="line">  e.response.body</div><div class="line">end</div><div class="line"></div><div class="line">profile_response = JSON.parse(body)</div></pre></td></tr></table></figure>
<p>这里，使用了<code>rescue RestClient::ExceptionWithResponse  =&gt; e</code> 获取异常对象，并赋给了变量e，通过<code>e.response.body</code>来回传需要的error信息。</p>
<p>大功告成。</p>
<p>其实，看到这里，你就明白，不仅仅是 400bad request的response内容可以读取，其他如403 Forbidden，404 not found 等的response内容也是可以依葫芦画瓢来做的。：P</p>
<h4 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h4><p>参考：</p>
<ul>
<li><a href="https://stackoverflow.com/questions/23623330/reading-the-body-of-a-400-response" target="_blank" rel="external">Reading the body of a 400 response?</a></li>
<li><a href="https://stackoverflow.com/questions/23623330/reading-the-body-of-a-400-response" target="_blank" rel="external">Response callbacks, error handing</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/15/how-to-pass-array-in-examples/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/15/how-to-pass-array-in-examples/" itemprop="url">
                  如何在cucumber 的example中传递Array
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-15T22:22:52+08:00">
                2017-11-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cucumber/" itemprop="url" rel="index">
                    <span itemprop="name">Cucumber</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/15/how-to-pass-array-in-examples/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/15/how-to-pass-array-in-examples/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>实际上，还是传递字符……</p>
<p>看下面的例子👇</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>当你想要在examples中传递一个Array时，要怎么做？直接传递？我们试试。</p>
<p>背景如下：</p>
<p>在文件<code>search.feature</code>中，search_terms的数据是一个数组[ ‘chocolate’ , ‘Nigella Lawson’]：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt; Scenario Outline:</div><div class="line">&gt;&gt; When I search for &quot;&lt;search_terms&gt;&quot;</div><div class="line">&gt;&gt; Then I should get a list of &quot;&lt;recipe_title&gt;&quot;</div><div class="line">&gt;&gt;</div><div class="line">&gt;&gt; Examples:</div><div class="line">&gt;&gt;         | search_terms | recipe_title |</div><div class="line">&gt;&gt;         | [ &apos;chocolate&apos; , &apos;Nigella Lawson&apos;] | White chocolate and mintmousse |</div></pre></td></tr></table></figure>
<p>对应的step文件，如<code>search_step.rb</code>，内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">When(/^I search for &quot;([^&quot;]*)&quot;$/) do |terms|</div><div class="line">  search_terms = terms</div><div class="line">  ......</div><div class="line">end</div><div class="line"></div><div class="line">Then(/^I should get a list of &quot;([^&quot;]*)&quot;$/) do |recipe_title|</div><div class="line">  ......</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这时如果直接在终端运行cucumber会报错，因为你的search_terms传递的是一个array。</p>
<p>在 <a href="http://thread.gmane.org/gmane.comp.programming.tools.cucumber/9315" target="_blank" rel="external">Cucumber:10316 -  Passing arrays in tables</a>中有位mswinson提到了这个问题，然后有位叫Andy的回复了他。【蛮好玩的，有兴趣的可以看看。】</p>
<p>解决方法就是<strong>避开Array，传递String，用“，”来区分各个element，然后在step definitions中用<code>split(/, /)</code>将其转换为Array</strong>。</p>
<p>比如上面的这个例子，可以这么来：</p>
<p>修改文件<code>search.feature</code>内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt; Scenario Outline:</div><div class="line">&gt;&gt; When I search for &quot;&lt;search_terms&gt;&quot;</div><div class="line">&gt;&gt; Then I should get a list of &quot;&lt;recipe_title&gt;&quot;</div><div class="line">&gt;&gt;</div><div class="line">&gt;&gt; Examples:</div><div class="line">&gt;&gt;         | search_terms | recipe_title |</div><div class="line">&gt;&gt;         | chocolate , Nigella Lawson| White chocolate and mintmousse |</div></pre></td></tr></table></figure>
<p>在对应的step文件中， 使用<code>search_terms = terms.split(/, /)</code>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">When(/^I search for &quot;([^&quot;]*)&quot;$/) do |terms|</div><div class="line">  search_terms = terms.split(/, /) ## 这时search_terms就是一个array了</div><div class="line">  ......</div><div class="line">end</div><div class="line"></div><div class="line">Then(/^I should get a list of &quot;([^&quot;]*)&quot;$/) do |recipe_title|</div><div class="line">  ......</div><div class="line">end</div></pre></td></tr></table></figure>
<p>OK，完成。</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>嗯，就这么简单，可我还是想把它写出来，硬生生整出了一篇文章来……</p>
<p>参考： <a href="http://thread.gmane.org/gmane.comp.programming.tools.cucumber/9315" target="_blank" rel="external">Cucumber:10316 -  Passing arrays in tables</a></p>
<p>enjoy ：D</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/09/usage-of-restclient/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/09/usage-of-restclient/" itemprop="url">
                  RestClient的用法及封装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-09T07:40:00+08:00">
                2017-11-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ruby/" itemprop="url" rel="index">
                    <span itemprop="name">Ruby</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/09/usage-of-restclient/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/09/usage-of-restclient/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p><a href="https://github.com/rest-client/rest-client" target="_blank" rel="external">Rest-client</a>， 顾名思义，遵守RESTful规则的客户端，可以对服务器发出请求。</p>
<p>每次使用时以<code>RestClient.get／post/put/delete</code>起头，更高级的用法是以<code>RestClient::Request.execute()</code>为固定结构。</p>
<p>如果你的专案中多处需要用到rest-client，你一定希望可以封装起来，易于调用，让代码更优雅。</p>
<p>我们开始吧。</p>
<h4 id="用法简介"><a href="#用法简介" class="headerlink" title="用法简介"></a>用法简介</h4><p><a href="https://github.com/rest-client/rest-client" target="_blank" rel="external">Rest-client</a>的<a href="http://www.rubydoc.info/github/rest-client/rest-client/RestClient#post-class_method" target="_blank" rel="external">官方文档</a>中， 详细地列出了各个method的参数情况，我们挑出最重要的那四个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">.get(url, headers = &#123;&#125;, &amp;block)</div><div class="line">.post(url, payload, headers = &#123;&#125;, &amp;block)</div><div class="line">.put(url, payload, headers = &#123;&#125;, &amp;block)</div><div class="line">.delete(url, headers = &#123;&#125;, &amp;block)</div></pre></td></tr></table></figure>
<p>会发现四个verb请求都带有headers，block，但是这两个参数都不是必填的。比如<code>get</code>， 只给一个URL就满足了。</p>
<p>在<a href="https://github.com/rest-client/rest-client" target="_blank" rel="external">GitHub</a>库上有相关的实例，长这样：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1flbgi7h7mgj30oh07r407.jpg" alt=""></p>
<p>用起来很简单，那么在ruby中如何封装呢？比如有个图书model，我想要对某个书进行修改，使用put时，就要传递至少三个参数，冗长的URL表明是哪本书，你的登录信息，比如sessionId, 要更新的内容。类似这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RestClient.post &apos;http://book.com/books/bookid&apos;, &#123;:sessionId =&gt; &apos;XXXXXXXX&apos;, :token =&gt; &quot;xxxx&quot;&#125;,&#123;&quot;name&quot;: &quot;XXX&quot;, &quot;description:&quot; &quot;XXXXX&quot; .......&#125;</div></pre></td></tr></table></figure>
<p>代码看着很不整洁，如何改进？</p>
<p>别急，先来看看在ruby中如何实现全局调用一个method。</p>
<h4 id="call-method-from-the-global-scope"><a href="#call-method-from-the-global-scope" class="headerlink" title="call method from the global scope"></a>call method from the global scope</h4><p>比如你定义了method C</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def C(name)</div><div class="line">	puts &quot;hello, #&#123;name&#125;&quot;</div><div class="line">end</div></pre></td></tr></table></figure>
<p>你想要在专案的多个文件中均可以调用这个method C，怎么实现？</p>
<p>使用module，这么来，在文件A.rb中，放入如下内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">module A</div><div class="line">	module B</div><div class="line">		def C(name)</div><div class="line">			puts &quot;hello, #&#123;name&#125;&quot;</div><div class="line">		end</div><div class="line">	end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这时候，你引用C，需要写成A::B.C， 呃，这不是我们想要的结果，继续优化。</p>
<p>在Ruby中，任何一个method都绑定了一个对象。当我们调用比较常见的method，比如<code>puts</code>， <code>require</code>时，其实我们是在调用<code>main.puts</code>, <code>main.require</code>, 也就是它们有一个默认的object，叫做main。</p>
<p>那我们也想给C挂上这样的object，让它也可以像puts一样被直接调用，怎么做？</p>
<p>让Object这个class中，包含我们的A::B即可，修改文件A.rb：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">module A</div><div class="line">	module B</div><div class="line">		def C(name)</div><div class="line">			puts &quot;hello, #&#123;name&#125;&quot;</div><div class="line">		end</div><div class="line">	end</div><div class="line">end</div><div class="line"></div><div class="line">class Object</div><div class="line">	include A::B</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这样当你在其他文件中，比如app.rb中调用C时，只要加上如下代码即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">require &apos;A&apos; #C定义的文件名</div><div class="line">extend A::B</div></pre></td></tr></table></figure>
<p>好，回到我们的restclient, 现在就很好做了。</p>
<h4 id="简化restclient的调用"><a href="#简化restclient的调用" class="headerlink" title="简化restclient的调用"></a>简化restclient的调用</h4><p>知道如何对method进行global 调用，我们可以这么玩。</p>
<p>新建<code>myclient.rb</code>文件，内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">require &apos;rest-client&apos;</div><div class="line"></div><div class="line">module MyClient</div><div class="line">  module Client</div><div class="line">  end</div><div class="line">end</div></pre></td></tr></table></figure>
<p>里面没有任何method，我们加上get。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">require &apos;rest-client&apos;</div><div class="line">$apiurl = http://example.com/api. #这是你API的URL，请自行修改</div><div class="line">module MyClient</div><div class="line">  module Client</div><div class="line">    def get(url, headers = nil)</div><div class="line">      response = RestClient.get(</div><div class="line">          $apiurl + url,</div><div class="line">          headers</div><div class="line">      )</div><div class="line">    end</div><div class="line">   end</div><div class="line"> end</div><div class="line"></div><div class="line">class Object</div><div class="line">  include MyClient::Client</div><div class="line">end</div></pre></td></tr></table></figure>
<p>这时，如果要在其他文件调用，比如app.rb文件中，使用get,就可以这么用了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">require_relative &apos;my_client&apos;</div><div class="line">extend MyClient::Client</div><div class="line"></div><div class="line">......</div><div class="line">headers =  &#123;:&apos;session&apos; =&gt; &apos;XXXX&apos;&#125;</div><div class="line">get(&quot;/books&quot;, headers)</div><div class="line">.....</div></pre></td></tr></table></figure>
<p>同样的，将post，put， delete 加入，补全代码，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">require &apos;rest-client&apos;</div><div class="line">$apiurl = http://example.com/api. #这是你API的URL，请自行修改</div><div class="line">module MyClient</div><div class="line">  module Client</div><div class="line">    def get(url, headers = nil)</div><div class="line">      response = RestClient.get(</div><div class="line">          $apiurl + url,</div><div class="line">          headers</div><div class="line">      )</div><div class="line">    end</div><div class="line"></div><div class="line">    def post(url, payload, headers = nil )</div><div class="line">      response = RestClient.post(</div><div class="line">          $apiurl + url,</div><div class="line">          payload,</div><div class="line">          headers</div><div class="line">      )</div><div class="line">    end</div><div class="line"></div><div class="line">    def put(url, payload, headers = nil )</div><div class="line">      response = RestClient.put(</div><div class="line">          $apiurl + url,</div><div class="line">          payload,</div><div class="line">          headers</div><div class="line">      )</div><div class="line">    end</div><div class="line"></div><div class="line">    def delete(url, headers = nil )</div><div class="line">      response = RestClient.delete(</div><div class="line">          $apiurl + url,</div><div class="line">          headers</div><div class="line">      )</div><div class="line">    end</div><div class="line">  end</div><div class="line">end</div><div class="line"></div><div class="line">class Object</div><div class="line">  include MyClient::Client</div><div class="line">end</div></pre></td></tr></table></figure>
<p>搞定，可以欢快地调用啦！！</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://stackoverflow.com/questions/18964016/how-can-i-add-a-method-to-the-global-scope-in-ruby" target="_blank" rel="external">How can I add a method to the global scope in Ruby?</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Lucia" />
          <p class="site-author-name" itemprop="name">Lucia</p>
           
              <p class="site-description motion-element" itemprop="description">Learning is doing</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">56</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">21</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Lupeipei" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/Luciapeipei" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lucia</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://https-lupeipei-github-io.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  





  

  

  

  

</body>
</html>
