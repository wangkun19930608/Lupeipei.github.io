<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="曲肱而枕">
<meta property="og:type" content="website">
<meta property="og:title" content="Lucia">
<meta property="og:url" content="http://lupeipei.github.io/page/3/index.html">
<meta property="og:site_name" content="Lucia">
<meta property="og:description" content="曲肱而枕">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lucia">
<meta name="twitter:description" content="曲肱而枕">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lupeipei.github.io/page/3/"/>





  <title> Lucia </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lucia</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2018/01/02/upload-capybara-screenshot-to-aliyun-oss/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2018/01/02/upload-capybara-screenshot-to-aliyun-oss/" itemprop="url">
                  将Capybara的screenshot上传至阿里云的OSS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-02T21:43:27+08:00">
                2018-01-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/aliyun/" itemprop="url" rel="index">
                    <span itemprop="name">aliyun</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/01/02/upload-capybara-screenshot-to-aliyun-oss/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/01/02/upload-capybara-screenshot-to-aliyun-oss/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>网页测试中，有一个很棒的gem叫<a href="https://github.com/mattheworiordan/capybara-screenshot" target="_blank" rel="external">capybara-screenshot</a> ，当你的scenario失败时，会自动将网页进行截图。</p>
<p>当然，你也可以手动截图。比如我想看看在step A中，我停留的网页长什么样子，直接用<code>Capybara::Screenshot.screenshot_and_open_image</code>, 终端运行cucumber或者rspec时，就可以看到网页的模样。</p>
<p>截图下来的图片，如果保存在本地，随着scenario的增多，自然会吃不消的，使用云存储是个好选择，比如放在阿里云上，还能通过生成的URL来将截图呈现在网页上，非常棒。</p>
<p>【当然你也可以在capybara中设置<code>Capybara::Screenshot.prune_strategy</code>的值，只保存最后的XX个或者最后一次运行的截图，这样截图就不会很多，但这里不讨论这种情况】</p>
<p>下面，简单来走一走如何将截图上传至阿里云的OSS。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>以howitzer_cucumber的一个登陆测试为例，来看看如何将截图传至阿里云。</p>
<ul>
<li><p>开通阿里云的OSS服务【点击，按照指示下单购买即可】</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fn2kck0bc0j30sa06hwfl.jpg" alt=""></p>
</li>
<li><p>新建存储空间bucket，获取你的aliyun_access_key， aliyun_secret_key，host【存储空间概览下面的endpoint】</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fn2kfi4tsvj30wa03ldgq.jpg" alt=""></p>
</li>
</ul>
<ul>
<li><p>在gemfile中添加<code>gem &#39;aliyun-oss-sdk&#39;</code>, 终端运行<code>bundle install</code></p>
</li>
<li><p>在 <code>features/support</code>中新建文件<code>aliyun.rb</code>，试试上传一张图片：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'aliyun/oss'</span></div><div class="line">aliyun_access_key = <span class="string">"你的access_key"</span></div><div class="line">aliyun_secret_key = <span class="string">"你的secret_key"</span></div><div class="line">host = <span class="string">'你的host'</span></div><div class="line">bucket = <span class="string">'你的bucket'</span></div><div class="line">client = Aliyun::Oss::Client.new(aliyun_access_key, aliyun_secret_key, <span class="symbol">host:</span> host, <span class="symbol">bucket:</span> bucket)</div><div class="line">client.bucket_create_object(<span class="string">'images/image.png'</span>, File.new(<span class="regexp">/Users/xxx</span><span class="regexp">/xxx/image</span>.png), &#123;<span class="string">'Content-Type'</span> =&gt; <span class="string">'image/png'</span> &#125;)</div></pre></td></tr></table></figure>
<p>这里File.new中的参数，是你想要上传的本地图片的文件路径。</p>
<p>终端运行该脚本，在你刚刚新建的bucket中，查看“文件管理”，你会发现已经上传成功，很赞有没有？</p>
</li>
<li><p>接着我们上传截图，比如登陆测试的scenario长这样：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">Scenario:</span> 用户输入正确的邮箱和密码完成登录</div><div class="line">  Given 我是已经注册的用户<span class="string">"管理员张三"</span></div><div class="line">  And  我在登录页面</div><div class="line">  When 我在登录页面的表格中输入邮箱<span class="symbol">:<span class="string">"admin@123.com"</span></span>和密码<span class="symbol">:<span class="string">"Password123456"</span></span></div><div class="line">  And 我点击登录按钮，提交表单</div><div class="line">  Then 我可以看到我已经进入了个人的主页</div></pre></td></tr></table></figure>
<p>现在我要截图一下登陆页面，可以这么来， 在对应的step的定义中，添加代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">And(<span class="regexp">/^我在登录页面$/</span>) <span class="keyword">do</span></div><div class="line">  LoginPage.open</div><div class="line"> + LoginPage.on <span class="keyword">do</span></div><div class="line"> +   file = Capybara::Screenshot.screen_shot_and_save_page</div><div class="line"> + <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>到这里你自然会想到，需要将上传这一步进行封装调用，我们先封装一下图片上传。</p>
<p>考虑到<code>Capybara::Screenshot.screen_shot_and_save_page</code>得到的是一个hash，而我们想要的其实是截图的文件路径，所以用<code>Dir.pwd + file[:image].sub(&#39;.&#39;,&#39;&#39;)</code> 来获取截图路径。</p>
<p>修改<code>aliyun.rb</code>文件：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'aliyun/oss'</span></div><div class="line"></div><div class="line">aliyun_access_key = <span class="string">"你的access_key"</span></div><div class="line">aliyun_secret_key = <span class="string">"你的secret_key"</span></div><div class="line">host = <span class="string">'你的host'</span></div><div class="line">bucket = <span class="string">'你的bucket'</span></div><div class="line">$client = Aliyun::Oss::Client.new(aliyun_access_key, aliyun_secret_key, <span class="symbol">host:</span> host, <span class="symbol">bucket:</span> bucket)</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">AliyunClient</span></span></div><div class="line">  <span class="class"><span class="keyword">module</span> <span class="title">Client</span></span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upload_image</span><span class="params">(filename, file)</span></span></div><div class="line">      image_file = Dir.pwd + file[<span class="symbol">:image</span>].sub(<span class="string">'.'</span>,<span class="string">''</span>)</div><div class="line">      $client.bucket_create_object(filename, File.new(image_file), &#123;<span class="string">'Content-Type'</span> =&gt; <span class="string">'image/png'</span> &#125;)</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Object</span></span></div><div class="line">  <span class="keyword">include</span> AliyunClient::Client</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>封装好了，直接调用我们的upload_image吧！</p>
<p>在刚刚的step的定义中，添加代码：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">And(<span class="regexp">/^我在登录页面$/</span>) <span class="keyword">do</span></div><div class="line">  LoginPage.open</div><div class="line">  LoginPage.on <span class="keyword">do</span></div><div class="line">    file = Capybara::Screenshot.screen_shot_and_save_page</div><div class="line"> +   upload(<span class="string">'images/image.png'</span>, file)</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>OK!!</p>
<p>这里，我是上传到images文件夹下，文件名为image.png 。当然具体上传的目标文件及文件夹都是可以自定义的，也是需要自定义的，特别是多次上传，你肯定不希望图片都被覆盖掉了，具体可以查看<a href="https://github.com/aliyun-beta/aliyun-oss-ruby-sdk" target="_blank" rel="external">aliyun-oss-ruby-sdk</a>。</p>
</li>
</ul>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://github.com/aliyun-beta/aliyun-oss-ruby-sdk" target="_blank" rel="external">aliyun-oss-ruby-sdk</a></p>
<p><a href="https://github.com/mattheworiordan/capybara-screenshot" target="_blank" rel="external">capybara-screenshot</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/31/web-api-practice/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/31/web-api-practice/" itemprop="url">
                  Rails：Web API接口实作
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-31T10:43:45+08:00">
                2017-12-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/31/web-api-practice/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/31/web-api-practice/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>话说，好记性不如烂笔头「当然，主要是自己笨」，趁着假期，实作了一个简单的API接口，主要是CRUD + auth 认证部分，以加强对API接口部分的理解。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>以用户对一个event活动进行CRUD操作的功能实现为例：</p>
<p>主要按如下步骤走：</p>
<ul>
<li><p>建model event，含字段title, description</p>
</li>
<li><p>设置路由，实作event的get, post, patch ,delete接口</p>
</li>
<li><p>添加认证API</p>
</li>
</ul>
<p><strong>最后的效果是：</strong></p>
<blockquote>
<p> 用户可以通过API接口来新建，修改，查看，删除event</p>
<p>用户在发出新建，修改，删除请求时，需要认证</p>
</blockquote>
<p>P.S：其实可以加个 rspec测试，不过这里我用postman直接测了，省去rspec部分，以免篇幅过长「主要还是因为，呃，你懂的，懒……」</p>
<p>好，开搞吧。</p>
<h5 id="一、新建一个project-event-api"><a href="#一、新建一个project-event-api" class="headerlink" title="一、新建一个project event_api"></a>一、新建一个project event_api</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rails new event_api</div><div class="line">cd event_api</div><div class="line">git init</div></pre></td></tr></table></figure>
<p>生成如下文件：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fmz03kpvxxj30970ba74o.jpg" alt=""></p>
<h5 id="二、建event-model，实作CRUD接口"><a href="#二、建event-model，实作CRUD接口" class="headerlink" title="二、建event model，实作CRUD接口"></a>二、建event model，实作CRUD接口</h5><ul>
<li><p>建event model,  终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git checkout -b event # 切换分支，做烂了可以再开个</div><div class="line">rails g model event title:string description:text uuid:string</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
<p>「为了安全性，给event加上一个uuid的字段」</p>
<p>在<code>app/models/event.rb</code>中，给title加上有效性验证，并在创建时自动生成uuid：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span> &lt; ApplicationRecord</span></div><div class="line">  validates_presence_of <span class="symbol">:title</span></div><div class="line">  before_validation <span class="symbol">:generate_uuid</span>, <span class="symbol">:only</span> =&gt; <span class="symbol">:create</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">to_param</span></span></div><div class="line">  	<span class="keyword">self</span>.uuid</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  protected</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">generate_uuid</span></span></div><div class="line">    <span class="keyword">self</span>.uuid = SecureRandom.uuid</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p>设置路由，在<code>config/routes.rb</code>中添加如下路由：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">namespace <span class="symbol">:api</span>, <span class="symbol">:defaults</span> =&gt; &#123;<span class="symbol">:format</span> =&gt; <span class="symbol">:json</span> &#125; <span class="keyword">do</span></div><div class="line">  namespace <span class="symbol">:v1</span> <span class="keyword">do</span></div><div class="line">    resources <span class="symbol">:events</span>, <span class="symbol">:only</span> =&gt; [<span class="symbol">:index</span>, <span class="symbol">:show</span>, <span class="symbol">:create</span>, <span class="symbol">:update</span>, <span class="symbol">:destroy</span>]</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p>产生API controller，终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g controller api --no-assets</div></pre></td></tr></table></figure>
<p>修改<code>app/controllers/api_controller.rb</code>:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- <span class="class"><span class="keyword">class</span> <span class="title">ApiController</span> &lt; ApplicationController</span></div><div class="line">+ <span class="class"><span class="keyword">class</span> <span class="title">ApiController</span> &lt; ActionController::Base</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>改成继承自ActionController::Base，因为API 不需要 <code>protect_from_forgery with: :exception</code> 这一行的 CSRF 浏览器安全检查。</p>
</li>
<li><p>实作event的get, post, patch, delete</p>
<p>终端执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g controller api::v1::events --no-assets</div></pre></td></tr></table></figure>
<p>在<code>app/controllers/api/v1/events_controller.rb</code>中，填入以下内容：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Api::V1::EventsController</span> &lt; ApiController</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">index</span></span></div><div class="line">    @events = Event.all</div><div class="line">    render <span class="symbol">:json</span> =&gt; &#123;</div><div class="line">        <span class="symbol">:data</span> =&gt; @events.map &#123;<span class="params">|event|</span></div><div class="line">        &#123;</div><div class="line">            <span class="symbol">:id</span> =&gt; event.id,</div><div class="line">            <span class="symbol">:uuid</span> =&gt; event.uuid,</div><div class="line">            <span class="symbol">:title</span> =&gt; event.title,</div><div class="line">            <span class="symbol">:event_url</span> =&gt; api_v1_event_url(event.id)</div><div class="line">        &#125;&#125;</div><div class="line">    &#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">create</span></span></div><div class="line">    @event = Event.new(</div><div class="line">                        <span class="symbol">:title</span> =&gt; params[<span class="symbol">:title</span>],</div><div class="line">                        <span class="symbol">:description</span> =&gt; params[<span class="symbol">:description</span>])</div><div class="line">    <span class="keyword">if</span> @event.save</div><div class="line">      render <span class="symbol">:json</span> =&gt; &#123;</div><div class="line">          <span class="symbol">:id</span> =&gt; @event.id,</div><div class="line">          <span class="symbol">:uuid</span> =&gt; @event.uuid,</div><div class="line">          <span class="symbol">:title</span> =&gt; @event.title,</div><div class="line">          <span class="symbol">:description</span> =&gt; @event.description</div><div class="line">      &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">      render <span class="symbol">:json</span> =&gt; &#123;</div><div class="line">          <span class="symbol">:message</span> =&gt; <span class="string">"创建event失败"</span>, <span class="symbol">:errors</span> =&gt; @event.errors</div><div class="line">      &#125;, <span class="symbol">:status</span> =&gt; <span class="number">400</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">show</span></span></div><div class="line">    @event = Event.find_by_uuid!(params[<span class="symbol">:id</span>])</div><div class="line">    render <span class="symbol">:json</span> =&gt; &#123;</div><div class="line">        <span class="symbol">:id</span> =&gt; @event.id,</div><div class="line">        <span class="symbol">:uuid</span> =&gt; @event.uuid,</div><div class="line">        <span class="symbol">:title</span> =&gt; @event.title,</div><div class="line">        <span class="symbol">:description</span> =&gt; @event.description</div><div class="line">    &#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">update</span></span></div><div class="line">    @event = Event.find_by_uuid!(params[<span class="symbol">:id</span>])</div><div class="line">    @event.update(<span class="symbol">:title</span> =&gt; params[<span class="symbol">:title</span>],</div><div class="line">                  <span class="symbol">:description</span> =&gt; params[<span class="symbol">:description</span>])</div><div class="line">    render <span class="symbol">:json</span> =&gt; &#123;<span class="symbol">:message</span> =&gt; <span class="string">"更新event成功"</span>&#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">destroy</span></span></div><div class="line">    @event = Event.find_by_uuid!(params[<span class="symbol">:id</span>])</div><div class="line">    @event.destroy</div><div class="line">    render <span class="symbol">:json</span> =&gt; &#123;<span class="symbol">:message</span> =&gt; <span class="string">"删除event成功"</span>&#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>注意，将EventsController 修改为继承自ApiController</p>
<p>启服务器，<code>rails s</code>, 用postman测试看看：</p>
<p>create</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fmz1uqgyb4j30ms0d2abh.jpg" alt=""></p>
<p>index</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fmz1vk7e8oj30mi0fmmyj.jpg" alt=""></p>
<p>show：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fmz1wfaul9j30ms0bs3zj.jpg" alt=""></p>
<p>Update:</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fmz1x60l41j30mn0c8jsm.jpg" alt=""></p>
<p>发出get请求，看到event的详情中已经修改了title：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fmz1yceghkj30mn0bsq41.jpg" alt=""></p>
<p>destroy：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fmz1yvtjybj30mt0a4t9l.jpg" alt=""></p>
<p>看event的list, 发现event2018_updated已经删除：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fmz213gb40j30mn0de3zp.jpg" alt=""></p>
<p>OK！！</p>
</li>
</ul>
<h5 id="三、添加认证API"><a href="#三、添加认证API" class="headerlink" title="三、添加认证API"></a>三、添加认证API</h5><p>这里做event的API时候，都不需要认证的，让我们加上认证部分。</p>
<ul>
<li><p>装上devise</p>
<p>编辑 <code>Gemfile</code> 加上 <code>gem &quot;devise&quot;</code></p>
<p>终端运行：<code>bundle</code>, 重启服务器，终端执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">rails g devise:install</div><div class="line">rails g devise user</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
</li>
<li><p>给event和user挂上关系</p>
<p>在<code>app/models/user.rb</code>加上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">has_many :events</div></pre></td></tr></table></figure>
<p>在<code>app/models/event.rb</code> 加上：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">belongs_to :user</div></pre></td></tr></table></figure>
<p> 将user_id添加到event中，终端执行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rails g migration add_user_id_to_events user_id:integer</div><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
<p>修改<code>app/controllers/api/v1/events_controller.rb</code>， 在create部分填上@event.user = current_user</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">create</span></span></div><div class="line">    @event = Event.new(</div><div class="line">                        <span class="symbol">:title</span> =&gt; params[<span class="symbol">:title</span>],</div><div class="line">                        <span class="symbol">:description</span> =&gt; params[<span class="symbol">:description</span>])</div><div class="line">    @event.user = current_user</div><div class="line">    <span class="keyword">if</span> @event.save</div><div class="line">      render <span class="symbol">:json</span> =&gt; &#123;</div><div class="line">          <span class="symbol">:id</span> =&gt; @event.id,</div><div class="line">          <span class="symbol">:uuid</span> =&gt; @event.uuid,</div><div class="line">          <span class="symbol">:title</span> =&gt; @event.title,</div><div class="line">          <span class="symbol">:description</span> =&gt; @event.description</div><div class="line">      &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">      render <span class="symbol">:json</span> =&gt; &#123;</div><div class="line">          <span class="symbol">:message</span> =&gt; <span class="string">"活动创建失败"</span>, <span class="symbol">:errors</span> =&gt; @event.errors</div><div class="line">      &#125;, <span class="symbol">:status</span> =&gt; <span class="number">400</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line">  ......</div></pre></td></tr></table></figure>
<p>这里也可以设置一下show，index部分，添加上creator的字段，显示是谁创建这个event的。「此处略去，不是重点」</p>
</li>
<li><p>给user加上token字段</p>
<p>终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g migration add_auth_token_to_users</div></pre></td></tr></table></figure>
<p>编辑文件<code>XXXX_add_auth_token_to_users.rb</code>文件:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AddAuthTokenToUsers</span> &lt; ActiveRecord::Migration[5.1]</span></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">change</span></span></div><div class="line">    + add_column <span class="symbol">:users</span>, <span class="symbol">:auth_token</span>, <span class="symbol">:string</span></div><div class="line">    + add_index <span class="symbol">:users</span>, <span class="symbol">:auth_token</span>, <span class="symbol">:unique</span> =&gt; <span class="literal">true</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rake db:migrate</div></pre></td></tr></table></figure>
<p>编辑<code>app/models/user.rb</code>， 给user加上token:</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> &lt; ApplicationRecord</span></div><div class="line">  <span class="comment"># Include default devise modules. Others available are:</span></div><div class="line">  <span class="comment"># :confirmable, :lockable, :timeoutable and :omniauthable</span></div><div class="line">  devise <span class="symbol">:database_authenticatable</span>, <span class="symbol">:registerable</span>,</div><div class="line">         <span class="symbol">:recoverable</span>, <span class="symbol">:rememberable</span>, <span class="symbol">:trackable</span>, <span class="symbol">:validatable</span></div><div class="line"></div><div class="line">  has_many <span class="symbol">:events</span></div><div class="line"></div><div class="line">  before_create <span class="symbol">:generate_authentication_token</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">generate_authentication_token</span></span></div><div class="line">    <span class="keyword">self</span>.auth_token = Devise.friendly_token</div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
<li><p>实作注册，登录，登出的API</p>
<p>在 <code>config/routes.rb</code> 加上路由：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line">  namespace <span class="symbol">:api</span>, <span class="symbol">:defaults</span> =&gt; &#123;<span class="symbol">:format</span> =&gt; <span class="symbol">:json</span> &#125; <span class="keyword">do</span></div><div class="line">    namespace <span class="symbol">:v1</span> <span class="keyword">do</span></div><div class="line">      resources <span class="symbol">:events</span>, <span class="symbol">:only</span> =&gt; [<span class="symbol">:index</span>, <span class="symbol">:show</span>, <span class="symbol">:create</span>, <span class="symbol">:update</span>, <span class="symbol">:destroy</span>]</div><div class="line">     + post <span class="string">"/signup"</span> =&gt; <span class="string">"auth#signup"</span></div><div class="line">     + post <span class="string">"/login"</span> =&gt; <span class="string">"auth#login"</span></div><div class="line">     + post <span class="string">"/logout"</span> =&gt; <span class="string">"auth#logout"</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line">......</div></pre></td></tr></table></figure>
<p>生成auth的controller：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rails g controller api::v1::auth --no-assets</div></pre></td></tr></table></figure>
<p>编辑它：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Api::V1::AuthController</span> &lt; ApiController</span></div><div class="line">  before_action <span class="symbol">:authenticate_user!</span>, <span class="symbol">:only</span> =&gt; [<span class="symbol">:logout</span>]</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">signup</span></span></div><div class="line">    user = User.new(<span class="symbol">:email</span> =&gt; params[<span class="symbol">:email</span>], <span class="symbol">:password</span> =&gt; params[<span class="symbol">:password</span>])</div><div class="line"></div><div class="line">    <span class="keyword">if</span> user.save</div><div class="line">      render <span class="symbol">:json</span> =&gt; &#123;<span class="symbol">:user_id</span> =&gt; user.id &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">      render <span class="symbol">:json</span> =&gt; &#123;<span class="symbol">:message</span> =&gt; <span class="string">"Failed"</span>, <span class="symbol">:errors</span> =&gt; user.errors&#125;, <span class="symbol">:status</span> =&gt; <span class="number">400</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">login</span></span></div><div class="line">    <span class="keyword">if</span> params[<span class="symbol">:email</span>] &amp;&amp; params[<span class="symbol">:password</span>]</div><div class="line">      user = User.find_by_email(params[<span class="symbol">:email</span>])</div><div class="line">    <span class="keyword">end</span></div><div class="line">    <span class="keyword">if</span> user &amp;&amp; user.valid_password?(params[<span class="symbol">:password</span>])</div><div class="line">      render <span class="symbol">:json</span> =&gt; &#123;</div><div class="line">          <span class="symbol">:message</span> =&gt; <span class="string">"ok"</span>,</div><div class="line">          <span class="symbol">:auth_token</span> =&gt; user.auth_token,</div><div class="line">          <span class="symbol">:user_id</span> =&gt; user.id</div><div class="line">      &#125;</div><div class="line">    <span class="keyword">else</span></div><div class="line">      render <span class="symbol">:json</span> =&gt; &#123;<span class="symbol">:message</span> =&gt; <span class="string">"Email or Password is wrong"</span>&#125;, <span class="symbol">:status</span> =&gt; <span class="number">400</span></div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">logout</span></span></div><div class="line">    current_user.generate_authentication_token</div><div class="line">    current_user.save!</div><div class="line">    render <span class="symbol">:json</span> =&gt; &#123;<span class="symbol">:message</span> =&gt; <span class="string">"logout successful"</span>&#125;</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>编辑<code>app/controllers/api_controller.rb</code>， 添加如下验证：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">before_action <span class="symbol">:authenticate_user_from_token!</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">authenticate_user_from_token!</span></span></div><div class="line">  <span class="keyword">if</span> params[<span class="symbol">:auth_token</span>]</div><div class="line">    user = User.find_by_auth_token(params[<span class="symbol">:auth_token</span>])</div><div class="line">    sign_in(user, <span class="symbol">store:</span> <span class="literal">false</span>) <span class="keyword">if</span> user</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这里可以改成将auth_token放在了header中传递，看这篇<a href="https://lupeipei.github.io/2017/12/29/pass-auth-token-through-header-rails-api/">如何将auth token放入headers进行传递？</a></p>
<p>重启服务器，用postman测试看看：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fmz38xhtclj30mq0b3t9m.jpg" alt=""></p>
<p>login ,获取auth_token</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fmz3xbnayjj30n10c40tv.jpg" alt=""></p>
<p>logout, 传递auth_token</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fmz3y7tr8nj30mr0acdgs.jpg" alt=""></p>
</li>
</ul>
<ul>
<li><p>最后，给event添加上认证，修改<code>app/controllers/api/v1/events_controller.rb</code>中，添加：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">......</div><div class="line">before_action <span class="symbol">:authenticate_user!</span>, <span class="symbol">:only</span> =&gt; [<span class="symbol">:create</span>, <span class="symbol">:update</span>, <span class="symbol">:destroy</span>]</div><div class="line">....</div></pre></td></tr></table></figure>
<p>用postman测试看看，现在新建event需要传递一个auth_token才行：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fmz45zlkyej30mn0bydgy.jpg" alt=""></p>
<p> 添加上auth_token， 创建成功：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fmz48dnhi8j30mo0dnjsp.jpg" alt=""></p>
<p>Patch, delete同理，可以用postman 进行测试看看，这里就不细看了。</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>我这边列出来的都是非常基础的API接口，其他复杂点的都是可以按照这个方式来做的，比如你可以在这个的基础上，添加comment，让用户通过接口给event做评论，点赞，自定义like method等等。</p>
<p>对于routes的写法，上面我用了rails自身的resource方式：<code>resources :events, :only =&gt; [:index, :show, :create, :update, :destroy]</code>， 也用了较易于理解的逐条列出路径的方式：<code>post &quot;/signup&quot; =&gt; &quot;auth#signup&quot;</code>, 可根据实际情况自行选择.</p>
<p>Happy coding! : )</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/29/pass-auth-token-through-header-rails-api/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/29/pass-auth-token-through-header-rails-api/" itemprop="url">
                  Rails API：如何将auth token放入headers进行传递？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-29T15:14:34+08:00">
                2017-12-29
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/29/pass-auth-token-through-header-rails-api/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/29/pass-auth-token-through-header-rails-api/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h4><p>最近在做Rails API，遇到一个问题：</p>
<blockquote>
<p> 加入用户登录验证后，每次新建一个project时，发出post请求，都要将auth_token放在body中进行传递，如果是get，则将auth_token作为参数放在URL的后面，因为get是没有body的。</p>
</blockquote>
<p>这么做有什么不好呢？</p>
<blockquote>
<p>这导致URL特别长，看着很不清爽，每次用postman发出get请求，都觉得这种做法真的是太太小白了，想着要把auth_token放在headers中才好。</p>
</blockquote>
<p>Google了下，问题解决，附上解决方法。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>以project为例，在postman中，你的请求如下：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fmxm7liq7rj30u80iztbe.jpg" alt=""></p>
<p> 这时，如果你将auth_token放在headers中进行传递，发出get请求后，会出现error，如下：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1fmxnlzbshrj30ub0etdh6.jpg" alt=""></p>
<p><strong>怎么破？</strong></p>
<p>原先对于user 的auth_token的传递，在<code>api_controller.rb</code>中的定义如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApiController</span> &lt; ActionController::Base</span></div><div class="line">  before_action <span class="symbol">:authenticate_user_from_token!</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">authenticate_user_from_token!</span></span></div><div class="line">    <span class="keyword">if</span> params[<span class="symbol">:auth_token</span>].present?</div><div class="line">      user = User.find_by_authentication_token(params[<span class="symbol">:auth_token</span>])</div><div class="line">      sign_in(user, <span class="symbol">store:</span> <span class="literal">false</span>) <span class="keyword">if</span> user</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line">  ......</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这里，可以看到接收的是<code>params[:auth_token]</code>, 我们稍稍修改下，用<code>request.headers[&#39;auth_token&#39;]</code>来代替<code>params[:auth_token]</code>：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ApiController</span> &lt; ActionController::Base</span></div><div class="line">  before_action <span class="symbol">:authenticate_user_from_token!</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">authenticate_user_from_token!</span></span></div><div class="line">    <span class="keyword">if</span> request.headers[<span class="string">'auth_token'</span>]</div><div class="line">      user = User.find_by_authentication_token(request.headers[<span class="string">'auth_token'</span>])</div><div class="line">      sign_in(user, <span class="symbol">store:</span> <span class="literal">false</span>) <span class="keyword">if</span> user</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line">  ......</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这时，再看看postman, OK !</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fmxncwu45bj30t90hv0vb.jpg" alt=""></p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://www.reddit.com/r/rails/comments/4l3hwv/how_to_send_auth_token_in_header_to_rails_api/" target="_blank" rel="external">How to send auth token in header to Rails API?</a></p>
<p><a href="https://stackoverflow.com/questions/17081499/pass-authenticity-token-through-http-header" target="_blank" rel="external">Pass Authenticity token through http header</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/27/Elizabeth-quotations/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/27/Elizabeth-quotations/" itemprop="url">
                  伊丽莎白语录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-27T20:09:03+08:00">
                2017-12-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/碎语成篇/" itemprop="url" rel="index">
                    <span itemprop="name">碎语成篇</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>我怕鬼片</p>
<p>我怕没实体的鬼片</p>
<p>我看鬼片一般都捂着眼睛的……</p>
<p>跟你说果酒啊</p>
<p>可能有些人，就注定胖吧</p>
<p>看来能熬夜是成为老大的必要条件之一啊</p>
<p>欲拒还迎</p>
<p>那你也去啃个西瓜吧</p>
<p>我喜欢英国电影，因为英伦腔听着很好听</p>
<p>喜欢昆汀的电影，因为他的电影经常有大段对白比较话痨</p>
<p>《告白》你觉得恐怖，《杀死比尔》你又觉得正常</p>
<p>我突然想到《热血高校》，我很喜欢的漫改电影</p>
<p>月牙儿说了啊，不能让人卷铺盖睡大街</p>
<p>游泳馆两边都有拿大叉子的工作人员</p>
<p>抓紧，你就十分钟了</p>
<p>广撒网</p>
<p>取一瓢饮</p>
<p>like what</p>
<p>今天是GOT日啊</p>
<p>我很喜欢《银魂》动漫~</p>
<p>同时开两个坑……基本会两个都填不了</p>
<p>恩，我最爱的水果之一，柚子</p>
<p>喜欢薯片，蕃茄味的薯片</p>
<p>嗑瓜子重要的是节奏，一气呵成</p>
<p>我喜欢奶制品</p>
<p>什么鬼</p>
<p>Mr.rainbow</p>
<p>放心，就算我看了那些还是会比你快</p>
<p>你要是有真迹，他肯定不会</p>
<p>我是麦霸</p>
<p>用户表示体验不佳啊</p>
<p>嘿嘿，你猜我在哪儿</p>
<p>我最高纪录3min</p>
<p>1.0版本的有眼泪</p>
<p>还好，不怎么疼了</p>
<p>我神经比较大条</p>
<p>我可能实时比较敏感，但很快就忘了……</p>
<p>明天还要工作！</p>
<p>你工作很不饱和啊</p>
<p>大概就是记在小本本上以后去实现吧</p>
<p>那不是我一个人喝的</p>
<p>我有999， 可斩感冒</p>
<p>night might</p>
<hr>
<p>Happy birthday，伊丽莎白</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/26/git-clone-repos-with-submodules/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/26/git-clone-repos-with-submodules/" itemprop="url">
                  clone git repos with submodules
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-26T20:01:49+08:00">
                2017-12-26
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Git/" itemprop="url" rel="index">
                    <span itemprop="name">Git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/26/git-clone-repos-with-submodules/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/26/git-clone-repos-with-submodules/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>当你需要clone的repos中，含有submodules时，我们会用到<code>git clone —recursive</code>这个命令，我今个也遇到了，然后很不幸地掉坑了，一直无法成功clone，Google后，搞定！现附上解答细节。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>先来认识下git中的子模块submodule。</p>
<p>A <strong>submodule</strong> in a git repository is like a sub-directory which is really a separate git repository in its own right. This is a useful feature when you have a project in git which depends on a particular versions of other projects。</p>
<p>我的理解是当你的repos需要依赖于第三方的repos时，可以用submodule的方式，把这些repos作为你的子模块引入进来使用，而这些repos本身仍是独立的。</p>
<p>「添加submodule可以使用命令：<code>git submodule add</code> 后面加上URL即可。」</p>
<p>以clone<a href="https://github.com/strongqa/howitzer_example_cucumber" target="_blank" rel="external">howitzer_example_cucumber</a>为例。可以看到有四个文件长得不大一样，这些其实就是submodule。</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fmue1wst1nj306i0dat95.jpg" alt=""></p>
<p>如果你直接clone, 使用命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone git@github.com:strongqa/howitzer_example_cucumber.git</div></pre></td></tr></table></figure>
<p>你会发现clone到本地后，那些submodule的文件存在，但里面没有任何文件。</p>
<p>这时就需要添加<code>`--recursive</code> `这个选项，<a href="https://github.com/strongqa/howitzer_example_cucumber" target="_blank" rel="external">howitzer_example_cucumber</a>文档下也列出了命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone --recursive git@github.com:strongqa/howitzer_example_cucumber.git</div></pre></td></tr></table></figure>
<p>终端输入后，报错：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fmuf22enbcj30s303s74w.jpg" alt=""></p>
<p>没有clone成功，显示<code>Permission denied (publickey)</code></p>
<p>google了一下，大部分人都是说修改你的ssh, 可我发现clone其他的repos没问题啊，说明我的ssh没毛病，clone带有submodule的却出问题，被拒绝，肯定跟submodule有关， 应该有其他方法。在stack overflow: <a href="https://stackoverflow.com/questions/39286354/git-clone-recursive-fails/47977557#47977557" target="_blank" rel="external">git clone –recursive fails</a>上找到了最方便的解答。</p>
<p><strong>非常直接：使用https格式</strong></p>
<p>终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone --recursive https://github.com/strongqa/howitzer_example_cucumber</div></pre></td></tr></table></figure>
<p>搞定！</p>
<p>PS. 看了其他文档，发现<strong>还有个方法</strong>，使用<code>git submodule init</code> , <code>git submodule update</code>.</p>
<p> 亲测有效，一并附上：</p>
<p>还是clone上面的repos，终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/strongqa/howitzer_example_cucumber</div><div class="line">cd howitzer_example_cucumber</div><div class="line">git submodule init</div><div class="line">git submodule update</div></pre></td></tr></table></figure>
<p>OK  !!</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97" target="_blank" rel="external">Git 工具 - 子模块</a></p>
<p><a href="https://stackoverflow.com/questions/39286354/git-clone-recursive-fails/47977557#47977557" target="_blank" rel="external">git clone –recursive fails</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/25/concepts-in-howitzer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/25/concepts-in-howitzer/" itemprop="url">
                  有关Howitzer中的几个概念
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-25T20:03:42+08:00">
                2017-12-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Howitzer/" itemprop="url" rel="index">
                    <span itemprop="name">Howitzer</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/25/concepts-in-howitzer/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/25/concepts-in-howitzer/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p><a href="http://howitzer-framework.io/" target="_blank" rel="external">howitzer</a>是一个基于ruby脚本的web验收测试框架， 初学时，对这个新伙伴是不甚了解，按照老规矩，看doc，看API。看完后，结合自己的理解，简单过一下里面几个重要的概念。</p>
<p>基本思路：</p>
<blockquote>
<ul>
<li>是什么？</li>
<li>怎么用？</li>
<li>用的时候要注意什么？</li>
</ul>
</blockquote>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>Driver</p>
<blockquote>
<p>是一个针对多个浏览器进行测试的通用界面，所有的Driver可以分成两类：</p>
<ul>
<li>Headless testing: 没有用户操作界面的模拟浏览器</li>
<li>real browser testing: 通过扩展程序或者插件来与真实的浏览器进行集成</li>
</ul>
</blockquote>
<p>Howitzer使用Capybara来对driver进行管理和设置，可以在<code>config/default.yml</code>中进行设置</p>
</li>
<li><p>Pages</p>
<p>介绍pages之前，介绍一下Page Object Model。</p>
<p>Page Object Model是一个自动化测试模版，创建用于测试的用户界面的抽象实体。可以将网站的每个page看作是一个类，然后通过调用这些类的实例来进行测试，而每个页面的元素可以看作是一个page的method，通过调用这些method来对该页面的元素进行调用。</p>
<p>这样，page就很好理解了。</p>
<p>Page是用于描述真实页面的类，比如在<code>web/pages</code>目录下，建立主页的文件，可以这样写：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Homepage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">path <span class="string">'/'</span></div><div class="line"><span class="keyword">end</span></div><div class="line">HomePage.open <span class="comment">#打开主页</span></div></pre></td></tr></table></figure>
<p>当然，这里的前提是你在<code>config/default.yml</code>中已经设置好了app_host</p>
<p>再比如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">ProductPage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  path <span class="string">'/products&#123;/id&#125;'</span></div><div class="line"><span class="keyword">end</span></div><div class="line">ProductPage.open(<span class="symbol">id:</span> <span class="number">1</span>) <span class="comment">#=&gt; 访问 /products/1</span></div></pre></td></tr></table></figure>
<p>如果要指定特定的host，可以这样：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AuthPage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">	site <span class="string">'https://example.com'</span></div><div class="line">	path <span class="string">'/auth'</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p><strong>Pages的验证：</strong></p>
<p>其实就是用于区分每个page的anchor，有三种不同的类型：</p>
<p><strong>URL，title，element</strong></p>
<p>比如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  path <span class="string">'/'</span></div><div class="line">  validate <span class="symbol">:url</span>, <span class="regexp">/\A(?:.*?:\/\/)?[^\/]*\/?\z/</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>使用<code>.displayed?</code>可以去判断一个页面的所有验证是否都通过。</p>
<p>用这个可以检查特定的页面成功打开，比如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">AccountPage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  path <span class="string">'/accounts/&#123;id&#125;'</span></div><div class="line"> <span class="keyword">end</span></div><div class="line"> AccountPage.open(<span class="symbol">id:</span> <span class="number">22</span>)</div><div class="line"> expect(AccountPage).to be_displayed</div></pre></td></tr></table></figure>
</li>
<li><p>Elements</p>
<p>页面的元素，可以是单个元素，比如搜索栏，也可以是元素集合，比如菜单中的选项集。</p>
<p>比如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  element <span class="symbol">:test_name1</span>, <span class="string">'.foo'</span>                         <span class="comment">#css locator, default</span></div><div class="line">  element <span class="symbol">:test_name2</span>, <span class="symbol">:css</span>, <span class="string">'.foo'</span>                   <span class="comment">#css locator</span></div><div class="line">  element <span class="symbol">:test_name3</span>, <span class="symbol">:xpath</span>, <span class="string">'//div[@value="bar"]'</span>  <span class="comment">#xpath locator</span></div><div class="line"></div><div class="line">  element <span class="symbol">:test_link1</span>, <span class="symbol">:link</span>, <span class="string">'Foo'</span>                   <span class="comment">#link locator by 'Foo' text</span></div><div class="line">  element <span class="symbol">:test_link2</span>, <span class="symbol">:link</span>, <span class="string">'bar'</span>                   <span class="comment">#link locator by 'bar' id</span></div><div class="line"></div><div class="line">  element <span class="symbol">:test_field1</span>, <span class="symbol">:fillable_field</span>, <span class="string">'Foo'</span>        <span class="comment">#field locator by 'Foo' text</span></div><div class="line">  element <span class="symbol">:test_field2</span>, <span class="symbol">:fillable_field</span>, <span class="string">'bar'</span>        <span class="comment">#field locator by 'bar' id</span></div><div class="line">  element <span class="symbol">:test_field3</span>, <span class="symbol">:fillable_field</span>, <span class="string">'baz'</span>        <span class="comment">#field locator by 'baz' name</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这里要注意，不能通过page类直接调用element，需要在page类中定义一个method来调用element。</p>
<p>比如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  element <span class="symbol">:new_button</span>, <span class="symbol">:xpath</span>, <span class="string">".//*[@name='New']"</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">start_new_project</span></span></div><div class="line">    new_button_element.click</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">HomePage.on &#123; new_button_element.click &#125; <span class="comment"># 不正确的用法</span></div><div class="line">HomePage.on &#123; start_new_project &#125; <span class="comment"># 正确的打开方式</span></div></pre></td></tr></table></figure>
</li>
<li><p>Sections</p>
<p>在howitzer中，有一个Howitzer::Web::Section类。</p>
<p>section的使用场景：当多个页面中出现相同的部分时，或者某部分在一个页面中频繁出现，类似rails中的公用表单。</p>
<p>使用<code>&lt;section_name&gt;_section</code>来生成一个section的实例,  这里使用一个特别的me方法，通过参数指定section，比如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MenuSection</span> &lt; Howitzer::Web::<span class="title">Section</span></span></div><div class="line">  me <span class="string">"#gbx3"</span> <span class="comment">#section的父元素</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>使用的时候，这么用：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 定义section:</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MenuSection</span> &lt; Howitzer::Web::<span class="title">Section</span></span></div><div class="line">  me <span class="string">"#gbx3"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 包含menusection的页面:</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  section <span class="symbol">:menu</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 页面调用section:</span></div><div class="line"></div><div class="line">HomePage.on &#123; menu_section &#125;</div></pre></td></tr></table></figure>
<p>当两个页面有相同的section，但是跟节点不同时，可以这么用：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># 定义section</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MenuSection</span> &lt; Howitzer::Web::<span class="title">Section</span></span></div><div class="line">  me <span class="string">'#gbx3'</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># 定义两个page类，都包含有menu这个section</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  section <span class="symbol">:menu</span> <span class="comment"># 使用默认的selector</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SearchResultsPage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  section <span class="symbol">:menu</span>, <span class="string">"#gbx48"</span> <span class="comment"># 覆盖了默认的selector</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>测试section是否存在某个页面：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MenuSection</span> &lt; Howitzer::Web::<span class="title">Section</span></span></div><div class="line">  me <span class="string">'#gbx3'</span></div><div class="line">  element <span class="symbol">:search</span>, <span class="string">"a.search"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  section <span class="symbol">:menu</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">HomePage.on &#123; has_menu_section? &#125; <span class="comment">#=&gt; returns true or false</span></div></pre></td></tr></table></figure>
<p>多层级section的使用，看一个登陆的例子，结合了cucumber 的step定义：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># define a page that contains an area that contains a section for both logging in and registration, then modeling each of the sub sections separately</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginSection</span> &lt; Howitzer::Web::<span class="title">Section</span></span></div><div class="line">  me <span class="string">"div.login-area"</span></div><div class="line">  element <span class="symbol">:username</span>, <span class="string">"#username"</span></div><div class="line">  element <span class="symbol">:password</span>, <span class="string">"#password"</span></div><div class="line">  element <span class="symbol">:sign_in</span>, <span class="string">"button"</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username, password)</span></span></div><div class="line">    username_element.set username</div><div class="line">    password_element.set password</div><div class="line">    sign_in_element.click</div><div class="line">  <span class="keyword">end</span>  </div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">RegistrationSection</span> &lt; Howitzer::Web::<span class="title">Section</span></span></div><div class="line">  me <span class="string">"div.reg-area"</span></div><div class="line">  element <span class="symbol">:first_name</span>, <span class="string">"#first_name"</span></div><div class="line">  element <span class="symbol">:last_name</span>, <span class="string">"#last_name"</span></div><div class="line">  element <span class="symbol">:next_step</span>, <span class="string">"button.next-reg-step"</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">sign_up</span><span class="params">(first_name, last_name)</span></span></div><div class="line">    first_name_element.set first_name</div><div class="line">    first_name_element.set last_name</div><div class="line">    next_step_element.click</div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginRegistrationFormSection</span> &lt; Howitzer::Web::<span class="title">Section</span></span></div><div class="line">  me <span class="string">"div.login-registration"</span></div><div class="line">  section <span class="symbol">:login</span></div><div class="line">  section <span class="symbol">:registration</span>  </div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  section <span class="symbol">:login_and_registration</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># how to login (fatuous, but demonstrates the point):</span></div><div class="line">Then /^I sign <span class="keyword">in</span>$/ <span class="keyword">do</span></div><div class="line">  HomePage.open</div><div class="line">  HomePage.on <span class="keyword">do</span></div><div class="line">    is_expected.to have_login_and_registration_section</div><div class="line">    login_and_registration_section.login_section.login(<span class="string">'bob'</span>, <span class="string">'p4ssw0rd'</span>)</div><div class="line">  <span class="keyword">end</span>  </div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># how to sign up:</span></div><div class="line"></div><div class="line">When /^I enter my name into the home page<span class="string">'s registration form$/ do</span></div><div class="line">  HomePage.open</div><div class="line">  HomePage.on do</div><div class="line">    expect(login_and_registration_section.registration_section).to have_first_name</div><div class="line">    expect(login_and_registration_section.registration_section).to have_last_name</div><div class="line">    login_and_registration_section.registration_section.signup('Bob<span class="string">', '</span>Arum<span class="string">')</span></div><div class="line">  end  </div><div class="line">end</div></pre></td></tr></table></figure>
</li>
<li><p>IFrames</p>
<p>IFrames 在howitzer中被声明为一个 <code>Howitzer::Web::Page</code>类，通过包含该frame 的section或者page来引用，比如：</p>
<p>创建一个frame实例，在DashboardPage中引用它，测试该frame是否在DashboardPage中存在。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">FbPage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  element <span class="symbol">:some_text_field</span>, <span class="string">"input.username"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">DashboardPage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  iframe <span class="symbol">:fb</span>, <span class="string">"#fb"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">DashboardPage.open</div><div class="line">DashboardPage.on &#123; is_expected.to have_fb_iframe &#125;</div></pre></td></tr></table></figure>
<p>与iframe中的元素进行交互, 这里用了cucumber login的step definition来说明：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Howitzer::Web::Page representing the iframe</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoginPage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  element <span class="symbol">:username</span>, <span class="string">"input.username"</span></div><div class="line">  element <span class="symbol">:password</span>, <span class="string">"input.password"</span></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">def</span> <span class="title">login</span><span class="params">(username, password)</span></span></div><div class="line">    username_element.set username</div><div class="line">    password_element.set password</div><div class="line">  <span class="keyword">end</span>  </div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># Howitzer::Web::Page representing the page that contains the iframe</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomePage</span> &lt; Howitzer::Web::<span class="title">Page</span></span></div><div class="line">  iframe <span class="symbol">:login</span>, <span class="string">"#login_and_registration"</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="comment"># cucumber step that performs login</span></div><div class="line">When /^I log <span class="keyword">in</span>$/ <span class="keyword">do</span></div><div class="line">  HomePage.open</div><div class="line">  HomePage.on <span class="keyword">do</span></div><div class="line">    login_iframe <span class="keyword">do</span> <span class="params">|frame|</span></div><div class="line">      <span class="comment">#`frame` is an instance of the `LoginPage` class</span></div><div class="line">      frame.login(<span class="string">'admin'</span>, <span class="string">'p4ssword'</span>)</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span>  </div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>参考：</p>
<p><a href="http://docs.howitzer-framework.io/" target="_blank" rel="external">howitzer doc</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/17/use-simple-navigation-in-rails/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/17/use-simple-navigation-in-rails/" itemprop="url">
                  在rails中使用simple navigation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-17T17:31:24+08:00">
                2017-12-17
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/ROR/" itemprop="url" rel="index">
                    <span itemprop="name">ROR</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/17/use-simple-navigation-in-rails/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/17/use-simple-navigation-in-rails/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p><a href="https://github.com/codeplant/simple-navigation" target="_blank" rel="external">simple navigation</a>是一个ruby库，用来生成navigation的，它的优势是可以定制自己的导航菜单，特别是当你有多个菜单或者你的菜单相对比较复杂的时候。</p>
<p>可是官方只是给出了一个<a href="http://simple-navigation-demo.codeplant.ch/" target="_blank" rel="external">online demo</a>，并没有给到具体的install  和 usage，这让初次接触simple navigation的小白有些被动，Google了一些文章，实做了一下，知道怎么玩啦，记录下以备用。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>安装gem</p>
<p>在gemfile文件中，添加如下：【建议把bootstrap也安装了】</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">gem <span class="string">'bootstrap-sass'</span></div><div class="line">gem <span class="string">'simple-navigation'</span></div><div class="line">gem <span class="string">'simple-navigation-bootstrap'</span></div></pre></td></tr></table></figure>
<p>终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bundle install</div></pre></td></tr></table></figure>
<p>重启服务器：<code>rails s</code></p>
<p>将<code>application.css</code>文件更名为<code>application.scss</code>，终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mv app/assets/stylesheets/application.css app/assets/stylesheets/application.scss</div></pre></td></tr></table></figure>
<p>在<code>application.scss</code>文件中，添加如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">@import &quot;bootstrap-sprockets&quot;;</div><div class="line">@import &quot;bootstrap&quot;;</div></pre></td></tr></table></figure>
<p>生成menu 的configuration文件<code>navigation.rb</code>， 终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bundle exec rails g navigation_config</div></pre></td></tr></table></figure>
<p>此时，config文件下会生成一个<code>navigation.rb</code>文件，长这样：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1fmjtnki6lbj30o007tmyr.jpg" alt=""></p>
<p>在文件的下方，已经列出了一些用法，包括如何添加有sub navigation的item，添加指定条件的item，比如登陆，是否为管理员等等。</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fmjtwnw2dzj30nv0gb42w.jpg" alt=""></p>
</li>
</ul>
<ul>
<li><p>设置menu</p>
<p>我们来改改，定制一下，比如下面这样：【当然，请确保你写的path是有效的……】</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fmjvdavg84j30le04n74t.jpg" alt=""></p>
</li>
<li><p>展示menu</p>
<p>在需要展示的页面中，添加:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= render_navigation(:expand_all =&gt; true)%&gt;</div></pre></td></tr></table></figure>
<p>这里，expand_all 为true是指全部铺开，即子菜单未被激活也是展开的，效果类似这样：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tNc79gy1fmjve7qr4oj305z04it8l.jpg" alt=""></p>
<p>这里可以用参数level来控制层级的显示，上面菜单 + 子菜单，只有两级，所以用</p>
<p><code>render_navigation(:level =&gt; 2)</code>也是可以的。如果改成：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt;%= render_navigation(:level =&gt; 1)%&gt;</div></pre></td></tr></table></figure>
<p>则显示一级菜单，像这样：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fmjvz5s8kej3063027q2r.jpg" alt=""></p>
<p>另：</p>
<p>看到GitHub 中提到使用<code>&lt;%= render_navigation(:expand_all =&gt; false)%&gt;</code> 来让未被激活的子菜单隐藏，没有设置的情况下，:expand_all是默认为false的, 我试了一下，没有成功，所有菜单还是全部铺开，有些奇怪。</p>
</li>
</ul>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://github.com/codeplant/simple-navigation" target="_blank" rel="external">simple-navigation</a></p>
<p><a href="https://github.com/pdf/simple-navigation-bootstrap" target="_blank" rel="external">simple-navigation-bootstrap</a></p>
<p><a href="http://www.xoen.org/2012/05/bootstrap-menus-in-rails/" target="_blank" rel="external">bootstrap menu in rails</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/13/methods-of-Array-in-Ruby/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/13/methods-of-Array-in-Ruby/" itemprop="url">
                  Ruby中Array 的一些常用方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-13T17:11:08+08:00">
                2017-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ruby/" itemprop="url" rel="index">
                    <span itemprop="name">Ruby</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/13/methods-of-Array-in-Ruby/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/13/methods-of-Array-in-Ruby/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>工作中常常要处理Array，索性把ruby 中Array的一些常用方法小结一下，加深印象。</p>
<p>先来看看Array中除去继承自Object之外的，有多少public methods</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(Array.instance_methods - Object.instance_methods).count</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">120</span></div><div class="line"><span class="comment"># ruby版本为 2.3.1</span></div></pre></td></tr></table></figure>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>建立空数组：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[]</div><div class="line">Array.new</div></pre></td></tr></table></figure>
</li>
<li><p>使用%w, %i 创建非空数组</p>
<p><strong>创建不包含空白的字符串数组，可用%w</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">%w(Ruby Python Scheme)</span></div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="string">"Ruby"</span>, <span class="string">"Python"</span>, <span class="string">"Scheme"</span>]</div></pre></td></tr></table></figure>
<p><strong>创建元素为符号的数组，可用%i</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">%i(Ruby Python Scheme)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="symbol">:Ruby</span>, <span class="symbol">:Python</span>, <span class="symbol">:Scheme</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>数组的大小</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>].count</div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>].size</div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>].length</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">6</span></div><div class="line"><span class="number">6</span></div><div class="line"><span class="number">6</span></div></pre></td></tr></table></figure>
</li>
<li><p>将string转化为array</p>
<p> split</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">"a, b, c, d"</span>.split(<span class="string">", "</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>将array转化为string</p>
<p>join</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>].join(<span class="string">", "</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="string">"a, b, c, d"</span></div></pre></td></tr></table></figure>
</li>
<li><p>将hash 转化为array</p>
<p>to_a</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">table = &#123;<span class="symbol">:<span class="string">"color1"</span></span> =&gt; <span class="string">"blue"</span>, <span class="symbol">:<span class="string">"color2"</span></span> =&gt; <span class="string">"red"</span>&#125;</div><div class="line">table.to_a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[[<span class="symbol">:color1</span>, <span class="string">"blue"</span>], [<span class="symbol">:color2</span>, <span class="string">"red"</span>]]</div><div class="line"></div><div class="line">table.to_a.flatten</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="symbol">:color1</span>, <span class="string">"blue"</span>, <span class="symbol">:color2</span>, <span class="string">"red"</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>在数组中提取元素</p>
<p>index从0开始，index为正时，从array的第一个元素开始，index为负时，从最后一个元素开始</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>][<span class="number">2</span>]</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">3</span></div><div class="line"></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>][-<span class="number">1</span>]</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">5</span></div></pre></td></tr></table></figure>
</li>
<li><p>给数组添加元素</p>
<p>在尾部添加&lt;&lt;  or push</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] &lt;&lt; <span class="string">"woot"</span></div><div class="line"><span class="comment"># 输出: [1, 2, 3, 4, 5, "woot"]</span></div><div class="line"></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].push(<span class="string">"woot"</span>)</div><div class="line"><span class="comment"># 输出: [1, 2, 3, 4, 5, "woot"]</span></div></pre></td></tr></table></figure>
<p>在开头添加 unshift</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].unshift(<span class="number">0</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>连接数组concat ／ +</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].concat([<span class="number">6</span>, <span class="number">7</span>])</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</div><div class="line"></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] + [<span class="number">6</span>, <span class="number">7</span>]</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>数组转换map, collect</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].map &#123;<span class="params">|x|</span> x * <span class="number">3</span>&#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">15</span>]</div><div class="line"></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].collect &#123;<span class="params">|x|</span> x + <span class="number">2</span> &#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>获取分散的数组values_at</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>].values_at(<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>筛选特定的元素 select</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>].select &#123;<span class="params">|number|</span> number % <span class="number">2</span> == <span class="number">0</span>&#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>删除元素 delete</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>]</div><div class="line">a.delete(<span class="number">5</span>) <span class="comment"># 注意这里delete的参数是元素，不是index</span></div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">5</span></div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
<p>删除指定index的元素delete_at 【破坏性修改】</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>]</div><div class="line">a.delete_at(<span class="number">5</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">7</span></div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>]</div></pre></td></tr></table></figure>
<p>删除符合要求的delete_if【破坏性修改】, reject</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>].delete_if&#123;<span class="params">|x|</span> x % <span class="number">2</span> == <span class="number">0</span>&#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</div><div class="line"></div><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>].reject&#123;<span class="params">|x|</span> x % <span class="number">2</span> == <span class="number">0</span>&#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</div></pre></td></tr></table></figure>
<p>删除所有nil元素compact</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [<span class="literal">nil</span>, <span class="number">4</span>, <span class="literal">nil</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="literal">nil</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="literal">nil</span>]</div><div class="line">a.compact</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>]</div></pre></td></tr></table></figure>
<p>删除指定部分slice</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>]</div><div class="line">a.slice(<span class="number">1</span>,<span class="number">2</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">3</span>, <span class="number">5</span>]</div><div class="line"></div><div class="line">a.slice!(<span class="number">1</span>,<span class="number">2</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">3</span>, <span class="number">5</span>]</div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
<p>删除第X个元素shift, 默认是第一个【破坏性修改】</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</div><div class="line">a.shift</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">1</span></div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div><div class="line"></div><div class="line">a.shift(<span class="number">2</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">2</span>, <span class="number">3</span>]</div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[ <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div></pre></td></tr></table></figure>
<p>删除最后X个元素pop ，默认是最后一个【破坏性修改】</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</div><div class="line">a.pop</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">9</span></div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</div><div class="line"></div><div class="line">a.pop(<span class="number">3</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</div></pre></td></tr></table></figure>
<p>ruby中method后面带有！符号的都是具有破坏性的修改, 但是那些没有带！尾巴的也不是那么友好，比如上面的shift， pop。 那么可有办法保护我们的array？有滴，上freeze</p>
<p>freeze可以禁止具有破坏性的方法来修改对象。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</div><div class="line">a.freeze</div><div class="line">a.pop</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="comment"># can't modify frozen Array</span></div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>去除重复元素uniq</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>]</div><div class="line">a.uniq</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>平坦化数组flatten</p>
<p>前面出现过，再多看些例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">4</span>, [<span class="number">8</span>], [<span class="number">15</span>], [<span class="number">16</span>, [<span class="number">23</span>, <span class="number">42</span>]]].flatten</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>]</div></pre></td></tr></table></figure>
<p>不传递参数时，默认是完全平坦化，传递参数，则平坦化层级X，例如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[<span class="number">4</span>, [<span class="number">8</span>], [<span class="number">15</span>], [<span class="number">16</span>, [<span class="number">23</span>, [<span class="number">42</span>, <span class="number">43</span>]]]].flatten(<span class="number">1</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, [<span class="number">23</span>, [<span class="number">42</span>, <span class="number">43</span>]]]</div><div class="line"></div><div class="line">[<span class="number">4</span>, [<span class="number">8</span>], [<span class="number">15</span>], [<span class="number">16</span>, [<span class="number">23</span>, [<span class="number">42</span>, <span class="number">43</span>]]]].flatten(<span class="number">2</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, [<span class="number">42</span>, <span class="number">43</span>]]</div><div class="line"></div><div class="line">[<span class="number">4</span>, [<span class="number">8</span>], [<span class="number">15</span>], [<span class="number">16</span>, [<span class="number">23</span>, [<span class="number">42</span>, <span class="number">43</span>]]]].flatten(<span class="number">3</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"> [<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="number">43</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>获取某个元素的出现次数count</p>
<p>count前面已经出现过，用于计算数组的长度，不带参数，如果传递参数给到count，则返回该元素在数组中出现的次数。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">42</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>].count(<span class="number">42</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure>
</li>
<li><p>排序sort</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]</div><div class="line">a.sort</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"> [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
<p>使用块来指定排序规则：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [<span class="string">"ruby"</span>, <span class="string">"python"</span>, <span class="string">"C"</span>, <span class="string">"C++"</span>, <span class="string">"java"</span>]</div><div class="line">a.sort</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="string">"C"</span>, <span class="string">"C++"</span>, <span class="string">"java"</span>, <span class="string">"python"</span>, <span class="string">"ruby"</span>]    <span class="comment"># 默认按照首字母排序</span></div><div class="line"></div><div class="line">a.sort &#123;<span class="params">|a, b|</span> a.length &lt;=&gt; b.length&#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="string">"C"</span>, <span class="string">"C++"</span>, <span class="string">"ruby"</span>, <span class="string">"java"</span>, <span class="string">"python"</span>]   <span class="comment"># 按照字符长度来排序</span></div></pre></td></tr></table></figure>
<p>同样的，sort！方法具有破坏性。</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>先整这么多，用到新的再补上，嘿哈</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/06/about-music/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/06/about-music/" itemprop="url">
                  关于听歌这件事
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-06T19:55:29+08:00">
                2017-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/碎语成篇/" itemprop="url" rel="index">
                    <span itemprop="name">碎语成篇</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>送君一掬温柔</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=28921691&auto=1&height=66"></iframe>

<p>一直觉得音乐是个特别神奇的东西。</p>
<p>无形无色，却能有着撩拨人心的力量。</p>
<p>开心了，听歌助兴，不开心了，听歌释怀。</p>
<p>疲惫时，一首歌，仿佛能治愈，能满血复活。</p>
<p>晴朗的日子里，踩着单车，塞上耳机，哼歌吹哨，真真是享受。</p>
<p>记得《偷影子的人》中，男主有个嗜好，每天早上都要来一段大提琴曲，而他最终找到了那个有着大提琴音色般笑声的克蕾尔，彼时她已经是一名大提琴家。</p>
<p>也许耳朵才是抵达心灵的窗口。</p>
<p>嗯，深情不过陪伴，温柔最是得人心。</p>
<p>愿你在音符中寻觅到那份温暖与温柔。</p>
<p>好了，不矫情了，听歌吧。</p>
<p>PS：</p>
<p>为什么要写这么一篇小短文？</p>
<p>其实，我只是想试试如何在hexo里面添加音乐文件……</p>
<p>事实证明，可以边看文章边听歌了……</p>
<p>嗯，其实，还是一心一意听歌的好，好音乐值得去专注。</p>
<hr>
<p>参考：</p>
<p><a href="http://www.jianshu.com/p/a52b68794a6b" target="_blank" rel="external">hexo创建个人博客（附加插入音乐、分享、评论、标签页、搜索）</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/01/deal-with-special-character-when-using-restclient-url/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/01/deal-with-special-character-when-using-restclient-url/" itemprop="url">
                  RestClient：URL中特殊字符的处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-01T19:49:13+08:00">
                2017-12-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/01/deal-with-special-character-when-using-restclient-url/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/01/deal-with-special-character-when-using-restclient-url/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>URL中通常会遇到特殊字符的处理，比如某一个参数中含有中文 或者”#$ ^ &amp; * + =”等特殊符号。</p>
<p>如何处理才能正确传递参数？</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p><strong>处理之前，先来点小知识。</strong></p>
<p>URL中一些特殊字符及对应的Url编码如下：</p>
<table>
<thead>
<tr>
<th>Character</th>
<th>From UTF-8</th>
</tr>
</thead>
<tbody>
<tr>
<td>space</td>
<td>%20</td>
</tr>
<tr>
<td>!</td>
<td>%21</td>
</tr>
<tr>
<td>“</td>
<td>%22</td>
</tr>
<tr>
<td>#</td>
<td>%23</td>
</tr>
<tr>
<td>$</td>
<td>%24</td>
</tr>
<tr>
<td>%</td>
<td>%25</td>
</tr>
<tr>
<td>&amp;</td>
<td>%26</td>
</tr>
<tr>
<td>‘</td>
<td>%27</td>
</tr>
<tr>
<td>(</td>
<td>%28</td>
</tr>
<tr>
<td>)</td>
<td>%29</td>
</tr>
<tr>
<td>*</td>
<td>%2A</td>
</tr>
<tr>
<td>+</td>
<td>%2B</td>
</tr>
<tr>
<td>,</td>
<td>%2C</td>
</tr>
<tr>
<td>-</td>
<td>%2D</td>
</tr>
<tr>
<td>.</td>
<td>%2E</td>
</tr>
<tr>
<td>/</td>
<td>%2F</td>
</tr>
</tbody>
</table>
<p><strong>小案例：从一个中文字符的处理开始</strong></p>
<p>restclient中，如果URL含有中文等非英文的特殊字符， 只需要使用<strong>URI::encode</strong>即可。比如下面这个例子：</p>
<p>网址是 <a href="http://example.com，" target="_blank" rel="external">http://example.com，</a> 用户输入关键字“伊丽莎白好乖滴 ”查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">url = &apos;http://example.com/search?keyword=伊丽莎白好乖滴&apos;</div><div class="line">RestClient.get(url)</div></pre></td></tr></table></figure>
<p>这里，使用restclient发出get请求，会出现URI::InvalidURIError 的错误.</p>
<p>正确的打开方式可以像这样：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">require &apos;addressable/uri&apos;</div><div class="line">url = &apos;http://example.com/search?keyword=伊丽莎白好乖滴&apos;</div><div class="line">RestClient.get(URI::encode(url))</div></pre></td></tr></table></figure>
<p>这样，url中的中文字符会转化为下面这样的ascii码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://example.com/search?keyword=%E4%BC%8A%E4%B8%BD%E8%8E%8E%E7%99%BD%E5%A5%BD%E4%B9%96%E6%BB%B4</div></pre></td></tr></table></figure>
<p><strong>特别加餐：传递给参数的值中，含有&amp;等特殊字符</strong></p>
<p>需要特别提一句的是，如果你的URL是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url = &apos;http://example.com/search?keyword=XXX&amp;city=shanghai&amp;type=food&apos;</div></pre></td></tr></table></figure>
<p>而你希望将<code>&amp;s</code>传递给keyword， 使用URI::encode时，会是这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://example.com/search?keyword=&amp;s&amp;city=shanghai&amp;type=food</div></pre></td></tr></table></figure>
<p>这里，因为URL中传递参数时，是用”&amp;”符号隔开的，所以rest client识别的时候，会认为keyword这个参数并没有赋值， 而<code>&amp;s</code>中，s表示另一个参数, 且没有赋值，这样，发出请求后会报错，这种情况如何解决？做这样的处理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">URI::encode(url).sub(&quot;&amp;&quot;, &quot;%26&quot;)</div></pre></td></tr></table></figure>
<p>encode后，将第一个&amp;, 也就是<code>&amp;s</code>转变为”%26s”, 再传递给RestClient。</p>
<p>这里你可能想要问，为什么不直接传递”%26s”？</p>
<p>问得好！如果直接将”%26s”传递给keyword，经过URI::encode之后，keyword接收到的就会是：“%2526s”， why？Cause it will encode “%” to “%25”。</p>
<p>当然，不只是rest client，其他需要针对URL进行encoding的，也可以进行类似的处理。</p>
<h4 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h4><p><a href="https://github.com/rest-client/rest-client/issues/476" target="_blank" rel="external">URL with square brackets: URI::InvalidURIError</a></p>
<p><a href="https://www.w3schools.com/tags/ref_urlencode.asp" target="_blank" rel="external">HTML URL Encoding Reference</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Lucia" />
          <p class="site-author-name" itemprop="name">Lucia</p>
           
              <p class="site-description motion-element" itemprop="description">曲肱而枕</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">70</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Lupeipei" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/Luciapeipei" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lucia</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://https-lupeipei-github-io.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  





  

  

  

  

</body>
</html>
