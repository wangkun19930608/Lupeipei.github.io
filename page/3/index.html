<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="曲肱而枕">
<meta property="og:type" content="website">
<meta property="og:title" content="Lucia">
<meta property="og:url" content="http://lupeipei.github.io/page/3/index.html">
<meta property="og:site_name" content="Lucia">
<meta property="og:description" content="曲肱而枕">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lucia">
<meta name="twitter:description" content="曲肱而枕">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lupeipei.github.io/page/3/"/>





  <title> Lucia </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Lucia</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/13/methods-of-Array-in-Ruby/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/13/methods-of-Array-in-Ruby/" itemprop="url">
                  Ruby中Array 的一些常用方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-13T17:11:08+08:00">
                2017-12-13
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ruby/" itemprop="url" rel="index">
                    <span itemprop="name">Ruby</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/13/methods-of-Array-in-Ruby/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/13/methods-of-Array-in-Ruby/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>工作中常常要处理Array，索性把ruby 中Array的一些常用方法小结一下，加深印象。</p>
<p>先来看看Array中除去继承自Object之外的，有多少public methods</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">(Array.instance_methods - Object.instance_methods).count</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">120</span></div><div class="line"><span class="comment"># ruby版本为 2.3.1</span></div></pre></td></tr></table></figure>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><ul>
<li><p>建立空数组：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[]</div><div class="line">Array.new</div></pre></td></tr></table></figure>
</li>
<li><p>使用%w, %i 创建非空数组</p>
<p><strong>创建不包含空白的字符串数组，可用%w</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">%w(Ruby Python Scheme)</span></div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="string">"Ruby"</span>, <span class="string">"Python"</span>, <span class="string">"Scheme"</span>]</div></pre></td></tr></table></figure>
<p><strong>创建元素为符号的数组，可用%i</strong></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">%i(Ruby Python Scheme)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="symbol">:Ruby</span>, <span class="symbol">:Python</span>, <span class="symbol">:Scheme</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>数组的大小</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>].count</div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>].size</div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>].length</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">6</span></div><div class="line"><span class="number">6</span></div><div class="line"><span class="number">6</span></div></pre></td></tr></table></figure>
</li>
<li><p>将string转化为array</p>
<p> split</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="string">"a, b, c, d"</span>.split(<span class="string">", "</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>将array转化为string</p>
<p>join</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"c"</span>, <span class="string">"d"</span>].join(<span class="string">", "</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="string">"a, b, c, d"</span></div></pre></td></tr></table></figure>
</li>
<li><p>将hash 转化为array</p>
<p>to_a</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">table = &#123;<span class="symbol">:<span class="string">"color1"</span></span> =&gt; <span class="string">"blue"</span>, <span class="symbol">:<span class="string">"color2"</span></span> =&gt; <span class="string">"red"</span>&#125;</div><div class="line">table.to_a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[[<span class="symbol">:color1</span>, <span class="string">"blue"</span>], [<span class="symbol">:color2</span>, <span class="string">"red"</span>]]</div><div class="line"></div><div class="line">table.to_a.flatten</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="symbol">:color1</span>, <span class="string">"blue"</span>, <span class="symbol">:color2</span>, <span class="string">"red"</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>在数组中提取元素</p>
<p>index从0开始，index为正时，从array的第一个元素开始，index为负时，从最后一个元素开始</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>][<span class="number">2</span>]</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">3</span></div><div class="line"></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>][-<span class="number">1</span>]</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">5</span></div></pre></td></tr></table></figure>
</li>
<li><p>给数组添加元素</p>
<p>在尾部添加&lt;&lt;  or push</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] &lt;&lt; <span class="string">"woot"</span></div><div class="line"><span class="comment"># 输出: [1, 2, 3, 4, 5, "woot"]</span></div><div class="line"></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].push(<span class="string">"woot"</span>)</div><div class="line"><span class="comment"># 输出: [1, 2, 3, 4, 5, "woot"]</span></div></pre></td></tr></table></figure>
<p>在开头添加 unshift</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].unshift(<span class="number">0</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>连接数组concat ／ +</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].concat([<span class="number">6</span>, <span class="number">7</span>])</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</div><div class="line"></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>] + [<span class="number">6</span>, <span class="number">7</span>]</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>数组转换map, collect</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].map &#123;<span class="params">|x|</span> x * <span class="number">3</span>&#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">3</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">15</span>]</div><div class="line"></div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].collect &#123;<span class="params">|x|</span> x + <span class="number">2</span> &#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>获取分散的数组values_at</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>].values_at(<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>筛选特定的元素 select</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>].select &#123;<span class="params">|number|</span> number % <span class="number">2</span> == <span class="number">0</span>&#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>删除元素 delete</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>]</div><div class="line">a.delete(<span class="number">5</span>) <span class="comment"># 注意这里delete的参数是元素，不是index</span></div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">5</span></div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
<p>删除指定index的元素delete_at 【破坏性修改】</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>]</div><div class="line">a.delete_at(<span class="number">5</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">7</span></div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>]</div></pre></td></tr></table></figure>
<p>删除符合要求的delete_if【破坏性修改】, reject</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>].delete_if&#123;<span class="params">|x|</span> x % <span class="number">2</span> == <span class="number">0</span>&#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</div><div class="line"></div><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>].reject&#123;<span class="params">|x|</span> x % <span class="number">2</span> == <span class="number">0</span>&#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>]</div></pre></td></tr></table></figure>
<p>删除所有nil元素compact</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [<span class="literal">nil</span>, <span class="number">4</span>, <span class="literal">nil</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="literal">nil</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="literal">nil</span>]</div><div class="line">a.compact</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>]</div></pre></td></tr></table></figure>
<p>删除指定部分slice</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>]</div><div class="line">a.slice(<span class="number">1</span>,<span class="number">2</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">3</span>, <span class="number">5</span>]</div><div class="line"></div><div class="line">a.slice!(<span class="number">1</span>,<span class="number">2</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">3</span>, <span class="number">5</span>]</div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
<p>删除第X个元素shift, 默认是第一个【破坏性修改】</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</div><div class="line">a.shift</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">1</span></div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div><div class="line"></div><div class="line">a.shift(<span class="number">2</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">2</span>, <span class="number">3</span>]</div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[ <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div></pre></td></tr></table></figure>
<p>删除最后X个元素pop ，默认是最后一个【破坏性修改】</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</div><div class="line">a.pop</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">9</span></div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</div><div class="line"></div><div class="line">a.pop(<span class="number">3</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>]</div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</div></pre></td></tr></table></figure>
<p>ruby中method后面带有！符号的都是具有破坏性的修改, 但是那些没有带！尾巴的也不是那么友好，比如上面的shift， pop。 那么可有办法保护我们的array？有滴，上freeze</p>
<p>freeze可以禁止具有破坏性的方法来修改对象。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</div><div class="line">a.freeze</div><div class="line">a.pop</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="comment"># can't modify frozen Array</span></div><div class="line"></div><div class="line">a</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>去除重复元素uniq</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">7</span>]</div><div class="line">a.uniq</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>平坦化数组flatten</p>
<p>前面出现过，再多看些例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">4</span>, [<span class="number">8</span>], [<span class="number">15</span>], [<span class="number">16</span>, [<span class="number">23</span>, <span class="number">42</span>]]].flatten</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>]</div></pre></td></tr></table></figure>
<p>不传递参数时，默认是完全平坦化，传递参数，则平坦化层级X，例如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[<span class="number">4</span>, [<span class="number">8</span>], [<span class="number">15</span>], [<span class="number">16</span>, [<span class="number">23</span>, [<span class="number">42</span>, <span class="number">43</span>]]]].flatten(<span class="number">1</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, [<span class="number">23</span>, [<span class="number">42</span>, <span class="number">43</span>]]]</div><div class="line"></div><div class="line">[<span class="number">4</span>, [<span class="number">8</span>], [<span class="number">15</span>], [<span class="number">16</span>, [<span class="number">23</span>, [<span class="number">42</span>, <span class="number">43</span>]]]].flatten(<span class="number">2</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, [<span class="number">42</span>, <span class="number">43</span>]]</div><div class="line"></div><div class="line">[<span class="number">4</span>, [<span class="number">8</span>], [<span class="number">15</span>], [<span class="number">16</span>, [<span class="number">23</span>, [<span class="number">42</span>, <span class="number">43</span>]]]].flatten(<span class="number">3</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"> [<span class="number">4</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>, <span class="number">43</span>]</div></pre></td></tr></table></figure>
</li>
<li><p>获取某个元素的出现次数count</p>
<p>count前面已经出现过，用于计算数组的长度，不带参数，如果传递参数给到count，则返回该元素在数组中出现的次数。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[<span class="number">42</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">23</span>, <span class="number">42</span>].count(<span class="number">42</span>)</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"><span class="number">2</span></div></pre></td></tr></table></figure>
</li>
<li><p>排序sort</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">a = [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">7</span>]</div><div class="line">a.sort</div><div class="line"><span class="comment"># 输出:</span></div><div class="line"> [<span class="number">1</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>]</div></pre></td></tr></table></figure>
<p>使用块来指定排序规则：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">a = [<span class="string">"ruby"</span>, <span class="string">"python"</span>, <span class="string">"C"</span>, <span class="string">"C++"</span>, <span class="string">"java"</span>]</div><div class="line">a.sort</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="string">"C"</span>, <span class="string">"C++"</span>, <span class="string">"java"</span>, <span class="string">"python"</span>, <span class="string">"ruby"</span>]    <span class="comment"># 默认按照首字母排序</span></div><div class="line"></div><div class="line">a.sort &#123;<span class="params">|a, b|</span> a.length &lt;=&gt; b.length&#125;</div><div class="line"><span class="comment"># 输出:</span></div><div class="line">[<span class="string">"C"</span>, <span class="string">"C++"</span>, <span class="string">"ruby"</span>, <span class="string">"java"</span>, <span class="string">"python"</span>]   <span class="comment"># 按照字符长度来排序</span></div></pre></td></tr></table></figure>
<p>同样的，sort！方法具有破坏性。</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>先整这么多，用到新的再补上，嘿哈</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/06/about-music/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/06/about-music/" itemprop="url">
                  关于听歌这件事
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-06T19:55:29+08:00">
                2017-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/碎语成篇/" itemprop="url" rel="index">
                    <span itemprop="name">碎语成篇</span>
                  </a>
                </span>

                
                
              
            </span>
          

          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>送君一掬温柔</p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=28921691&auto=1&height=66"></iframe>

<p>一直觉得音乐是个特别神奇的东西。</p>
<p>无形无色，却能有着撩拨人心的力量。</p>
<p>开心了，听歌助兴，不开心了，听歌释怀。</p>
<p>疲惫时，一首歌，仿佛能治愈，能满血复活。</p>
<p>晴朗的日子里，踩着单车，塞上耳机，哼歌吹哨，真真是享受。</p>
<p>记得《偷影子的人》中，男主有个嗜好，每天早上都要来一段大提琴曲，而他最终找到了那个有着大提琴音色般笑声的克蕾尔，彼时她已经是一名大提琴家。</p>
<p>也许耳朵才是抵达心灵的窗口。</p>
<p>嗯，深情不过陪伴，温柔最是得人心。</p>
<p>愿你在音符中寻觅到那份温暖与温柔。</p>
<p>好了，不矫情了，听歌吧。</p>
<p>PS：</p>
<p>为什么要写这么一篇小短文？</p>
<p>其实，我只是想试试如何在hexo里面添加音乐文件……</p>
<p>事实证明，可以边看文章边听歌了……</p>
<p>嗯，其实，还是一心一意听歌的好，好音乐值得去专注。</p>
<hr>
<p>参考：</p>
<p><a href="http://www.jianshu.com/p/a52b68794a6b" target="_blank" rel="external">hexo创建个人博客（附加插入音乐、分享、评论、标签页、搜索）</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/12/01/deal-with-special-character-when-using-restclient-url/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/12/01/deal-with-special-character-when-using-restclient-url/" itemprop="url">
                  RestClient：URL中特殊字符的处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-12-01T19:49:13+08:00">
                2017-12-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Web/" itemprop="url" rel="index">
                    <span itemprop="name">Web</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/12/01/deal-with-special-character-when-using-restclient-url/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/12/01/deal-with-special-character-when-using-restclient-url/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>URL中通常会遇到特殊字符的处理，比如某一个参数中含有中文 或者”#$ ^ &amp; * + =”等特殊符号。</p>
<p>如何处理才能正确传递参数？</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p><strong>处理之前，先来点小知识。</strong></p>
<p>URL中一些特殊字符及对应的Url编码如下：</p>
<table>
<thead>
<tr>
<th>Character</th>
<th>From UTF-8</th>
</tr>
</thead>
<tbody>
<tr>
<td>space</td>
<td>%20</td>
</tr>
<tr>
<td>!</td>
<td>%21</td>
</tr>
<tr>
<td>“</td>
<td>%22</td>
</tr>
<tr>
<td>#</td>
<td>%23</td>
</tr>
<tr>
<td>$</td>
<td>%24</td>
</tr>
<tr>
<td>%</td>
<td>%25</td>
</tr>
<tr>
<td>&amp;</td>
<td>%26</td>
</tr>
<tr>
<td>‘</td>
<td>%27</td>
</tr>
<tr>
<td>(</td>
<td>%28</td>
</tr>
<tr>
<td>)</td>
<td>%29</td>
</tr>
<tr>
<td>*</td>
<td>%2A</td>
</tr>
<tr>
<td>+</td>
<td>%2B</td>
</tr>
<tr>
<td>,</td>
<td>%2C</td>
</tr>
<tr>
<td>-</td>
<td>%2D</td>
</tr>
<tr>
<td>.</td>
<td>%2E</td>
</tr>
<tr>
<td>/</td>
<td>%2F</td>
</tr>
</tbody>
</table>
<p><strong>小案例：从一个中文字符的处理开始</strong></p>
<p>restclient中，如果URL含有中文等非英文的特殊字符， 只需要使用<strong>URI::encode</strong>即可。比如下面这个例子：</p>
<p>网址是 <a href="http://example.com，" target="_blank" rel="external">http://example.com，</a> 用户输入关键字“伊丽莎白好乖滴 ”查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">url = &apos;http://example.com/search?keyword=伊丽莎白好乖滴&apos;</div><div class="line">RestClient.get(url)</div></pre></td></tr></table></figure>
<p>这里，使用restclient发出get请求，会出现URI::InvalidURIError 的错误.</p>
<p>正确的打开方式可以像这样：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">require &apos;addressable/uri&apos;</div><div class="line">url = &apos;http://example.com/search?keyword=伊丽莎白好乖滴&apos;</div><div class="line">RestClient.get(URI::encode(url))</div></pre></td></tr></table></figure>
<p>这样，url中的中文字符会转化为下面这样的ascii码。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://example.com/search?keyword=%E4%BC%8A%E4%B8%BD%E8%8E%8E%E7%99%BD%E5%A5%BD%E4%B9%96%E6%BB%B4</div></pre></td></tr></table></figure>
<p><strong>特别加餐：传递给参数的值中，含有&amp;等特殊字符</strong></p>
<p>需要特别提一句的是，如果你的URL是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">url = &apos;http://example.com/search?keyword=XXX&amp;city=shanghai&amp;type=food&apos;</div></pre></td></tr></table></figure>
<p>而你希望将<code>&amp;s</code>传递给keyword， 使用URI::encode时，会是这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://example.com/search?keyword=&amp;s&amp;city=shanghai&amp;type=food</div></pre></td></tr></table></figure>
<p>这里，因为URL中传递参数时，是用”&amp;”符号隔开的，所以rest client识别的时候，会认为keyword这个参数并没有赋值， 而<code>&amp;s</code>中，s表示另一个参数, 且没有赋值，这样，发出请求后会报错，这种情况如何解决？做这样的处理:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">URI::encode(url).sub(&quot;&amp;&quot;, &quot;%26&quot;)</div></pre></td></tr></table></figure>
<p>encode后，将第一个&amp;, 也就是<code>&amp;s</code>转变为”%26s”, 再传递给RestClient。</p>
<p>这里你可能想要问，为什么不直接传递”%26s”？</p>
<p>问得好！如果直接将”%26s”传递给keyword，经过URI::encode之后，keyword接收到的就会是：“%2526s”， why？Cause it will encode “%” to “%25”。</p>
<p>当然，不只是rest client，其他需要针对URL进行encoding的，也可以进行类似的处理。</p>
<h4 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h4><p><a href="https://github.com/rest-client/rest-client/issues/476" target="_blank" rel="external">URL with square brackets: URI::InvalidURIError</a></p>
<p><a href="https://www.w3schools.com/tags/ref_urlencode.asp" target="_blank" rel="external">HTML URL Encoding Reference</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/22/custom-exceptions-in-ruby/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/22/custom-exceptions-in-ruby/" itemprop="url">
                  如何在ruby中的定制你的exception？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-22T20:31:02+08:00">
                2017-11-22
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ruby/" itemprop="url" rel="index">
                    <span itemprop="name">Ruby</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/22/custom-exceptions-in-ruby/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/22/custom-exceptions-in-ruby/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>在ruby中抛出异常时，除了输出程序本身的exception之外，你可能还希望它输出一些其他信息，例如指出是哪个文件，对应的id是什么等，以便后期查找。</p>
<p>这时，可以通过定制ruby的exception来解决。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p><strong>看个场景：</strong></p>
<p>以接口测试的一个情况为例，说明一下怎么玩。</p>
<p>用户A在做接口测试时，使用restclient的get, put, post, delete发出请求，出错，这时，用户A除了希望获取到rest client本身的Exception外，还希望可以输出reponse.headers中的traceid， 类似这样：</p>
<p><img src="https://ws1.sinaimg.cn/large/006tNc79gy1flr4wg5vwhj30pp015gll.jpg" alt=""></p>
<p>那么如何将traceid加入到exception的message内容中去呢？</p>
<p><strong>重新定义一个class，继承自ruby的StandardError， 将需要输出的信息作为变量传递给该class即可。</strong></p>
<p>具体这么来：</p>
<p>新建一个class ： MyError</p>
<p><img src="https://ws3.sinaimg.cn/large/006tNc79gy1flr4v3whjkj30kp0423yq.jpg" alt=""></p>
<p>在使用restclient时，raise 异常即可。具体代码类似这样👇：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1flr4ju0i95j30k305f0tb.jpg" alt=""></p>
<p>简单说明一下：</p>
<p>我们去获取网站example.com首页的内容，用rescue来捕捉异常，并将restclient的异常信息<code>e. message</code> 和<code>e.response.headers[:traceid]</code>合并起来作为参数传递，生成MyError的一个实例 <code>my_error</code> ，并针对response的code做判断，如果code不在200～206， 则抛出<code>my_error</code>.</p>
<p>这里，其实是将标准的出错信息加了个定制的尾巴，父对象StandardError接受到新的message，在出错时抛出。</p>
<p>OK啦。</p>
<p>很简单是不是？得空可以试试定制化你的exceptions：P</p>
<h4 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h4><p>参考：</p>
<p><a href="http://blog.honeybadger.io/ruby-custom-exceptions/" target="_blank" rel="external">Custom exceptions in Ruby</a></p>
<p><a href="http://blog.honeybadger.io/ruby-exception-vs-standarderror-whats-the-difference/" target="_blank" rel="external">Ruby’s Exception vs StandardError: What’s the difference?</a>Â</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/21/read-the-body-of-400-response-with-ruby-exception-handling/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/21/read-the-body-of-400-response-with-ruby-exception-handling/" itemprop="url">
                  使用ruby的异常处理来读取rest client中的bad request
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-21T20:35:58+08:00">
                2017-11-21
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/BDD/" itemprop="url" rel="index">
                    <span itemprop="name">BDD</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/21/read-the-body-of-400-response-with-ruby-exception-handling/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/21/read-the-body-of-400-response-with-ruby-exception-handling/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>我们在使用rest-client去发出请求时，result code是200 固然很好，但有时候我们也希望能读取到Exceptions， 例如读取result code是400bad request的response内容，怎么做？</p>
<p>看个例子。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>场景：用户A想要通过接口获取到个人信息，代码如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">respoonse = RestClient.get 'http://example.com/myprofile?access_token=#&#123;access_token&#125;'</div><div class="line">profile_response = JSON.parse(respoonse.body)</div></pre></td></tr></table></figure>
<p>其中，如果<code>access_token</code>过期或者无效，用户希望得到这样的结果：</p>
<ul>
<li>返回 400 Bad Request</li>
<li>返回一个JSON格式的reponse body ，内容像这样：</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&#123;	      </div><div class="line">   <span class="attr">"code"</span>: <span class="number">400</span>,</div><div class="line">   <span class="attr">"error"</span>: &#123;</div><div class="line">      <span class="attr">"message"</span>: <span class="string">"The access token could not be decrypted"</span>,</div><div class="line">      <span class="attr">"type"</span>: <span class="string">"OAuthException"</span></div><div class="line">   &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这时，如果你的<code>access_token</code>是过期或者无效的，终端运行的时候，会报错400 Bad Request ，但是却没有返回对应的response。</p>
<p>如何解决？</p>
<p>其实，如果你熟悉ruby的异常处理，就会发现很简单，把上述的代码改成如下：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">body = begin</div><div class="line">  respoonse = RestClient.get 'http://example.com/myprofile?access_token=#&#123;access_token&#125;'</div><div class="line">  response.body</div><div class="line">rescue RestClient::ExceptionWithResponse  =&gt; e</div><div class="line">  e.response.body</div><div class="line">end</div><div class="line"></div><div class="line">profile_response = JSON.parse(body)</div></pre></td></tr></table></figure>
<p>这里，使用了<code>rescue RestClient::ExceptionWithResponse  =&gt; e</code> 获取异常对象，并赋给了变量e，通过<code>e.response.body</code>来回传需要的error信息。</p>
<p>大功告成。</p>
<p>其实，看到这里，你就明白，不仅仅是 400bad request的response内容可以读取，其他如403 Forbidden，404 not found 等的response内容也是可以依葫芦画瓢来做的。：P</p>
<h4 id="The-end"><a href="#The-end" class="headerlink" title="The end"></a>The end</h4><p>参考：</p>
<ul>
<li><a href="https://stackoverflow.com/questions/23623330/reading-the-body-of-a-400-response" target="_blank" rel="external">Reading the body of a 400 response?</a></li>
<li><a href="https://stackoverflow.com/questions/23623330/reading-the-body-of-a-400-response" target="_blank" rel="external">Response callbacks, error handing</a></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/15/how-to-pass-array-in-examples/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/15/how-to-pass-array-in-examples/" itemprop="url">
                  如何在cucumber 的example中传递Array
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-15T22:22:52+08:00">
                2017-11-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cucumber/" itemprop="url" rel="index">
                    <span itemprop="name">Cucumber</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/15/how-to-pass-array-in-examples/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/15/how-to-pass-array-in-examples/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>实际上，还是传递字符……</p>
<p>看下面的例子👇</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>当你想要在examples中传递一个Array时，要怎么做？直接传递？我们试试。</p>
<p>背景如下：</p>
<p>在文件<code>search.feature</code>中，search_terms的数据是一个数组[ ‘chocolate’ , ‘Nigella Lawson’]：</p>
 <figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Scenario <span class="symbol">Outline:</span></div><div class="line">When I search <span class="keyword">for</span> <span class="string">"&lt;search_terms&gt;"</span></div><div class="line">Then I should get a list of <span class="string">"&lt;recipe_title&gt;"</span></div><div class="line"><span class="symbol">Examples:</span></div><div class="line">        <span class="params">| search_terms |</span> recipe_title <span class="params">|</span></div><div class="line">        | [ <span class="string">'chocolate'</span> , <span class="string">'Nigella Lawson'</span>] <span class="params">| White chocolate <span class="keyword">and</span> mintmousse |</span></div></pre></td></tr></table></figure>
<p>对应的step文件，如<code>search_step.rb</code>，内容：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">When(<span class="regexp">/^I search for "([^"]*)"$/</span>) <span class="keyword">do</span> <span class="params">|terms|</span></div><div class="line">  search_terms = terms</div><div class="line">  ......</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">Then(<span class="regexp">/^I should get a list of "([^"]*)"$/</span>) <span class="keyword">do</span> <span class="params">|recipe_title|</span></div><div class="line">  ......</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这时如果直接在终端运行cucumber会报错，因为你的search_terms传递的是一个array。</p>
<p>在 <a href="http://thread.gmane.org/gmane.comp.programming.tools.cucumber/9315" target="_blank" rel="external">Cucumber:10316 -  Passing arrays in tables</a>中有位mswinson提到了这个问题，然后有位叫Andy的回复了他。【蛮好玩的，有兴趣的可以看看。】</p>
<p>解决方法就是<strong>避开Array，传递String，用“，”来区分各个element，然后在step definitions中用<code>split(/, /)</code>将其转换为Array</strong>。</p>
<p>比如上面的这个例子，可以这么来：</p>
<p>修改文件<code>search.feature</code>内容：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Scenario <span class="symbol">Outline:</span></div><div class="line">When I search <span class="keyword">for</span> <span class="string">"&lt;search_terms&gt;"</span></div><div class="line">Then I should get a list of <span class="string">"&lt;recipe_title&gt;"</span></div><div class="line"></div><div class="line"><span class="symbol">Examples:</span></div><div class="line">        <span class="params">| search_terms |</span> recipe_title <span class="params">|</span></div><div class="line">        | chocolate , Nigella Lawson<span class="params">| White chocolate <span class="keyword">and</span> mintmousse |</span></div></pre></td></tr></table></figure>
<p>在对应的step文件中， 使用<code>search_terms = terms.split(/, /)</code>。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">When(<span class="regexp">/^I search for "([^"]*)"$/</span>) <span class="keyword">do</span> <span class="params">|terms|</span></div><div class="line">  search_terms = terms.split(<span class="regexp">/, /</span>) <span class="comment">## 这时search_terms就是一个array了</span></div><div class="line">  ......</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">Then(<span class="regexp">/^I should get a list of "([^"]*)"$/</span>) <span class="keyword">do</span> <span class="params">|recipe_title|</span></div><div class="line">  ......</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>OK，完成。</p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>嗯，就这么简单，可我还是想把它写出来，硬生生整出了一篇文章来……</p>
<p>参考： <a href="http://thread.gmane.org/gmane.comp.programming.tools.cucumber/9315" target="_blank" rel="external">Cucumber:10316 -  Passing arrays in tables</a></p>
<p>enjoy ：D</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/09/usage-of-restclient/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/09/usage-of-restclient/" itemprop="url">
                  RestClient的用法及封装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-09T07:40:00+08:00">
                2017-11-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Ruby/" itemprop="url" rel="index">
                    <span itemprop="name">Ruby</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/09/usage-of-restclient/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/09/usage-of-restclient/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p><a href="https://github.com/rest-client/rest-client" target="_blank" rel="external">Rest-client</a>， 顾名思义，遵守RESTful规则的客户端，可以对服务器发出请求。</p>
<p>每次使用时以<code>RestClient.get／post/put/delete</code>起头，更高级的用法是以<code>RestClient::Request.execute()</code>为固定结构。</p>
<p>如果你的专案中多处需要用到rest-client，你一定希望可以封装起来，易于调用，让代码更优雅。</p>
<p>我们开始吧。</p>
<h4 id="用法简介"><a href="#用法简介" class="headerlink" title="用法简介"></a>用法简介</h4><p><a href="https://github.com/rest-client/rest-client" target="_blank" rel="external">Rest-client</a>的<a href="http://www.rubydoc.info/github/rest-client/rest-client/RestClient#post-class_method" target="_blank" rel="external">官方文档</a>中， 详细地列出了各个method的参数情况，我们挑出最重要的那四个：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">.get(url, headers = &#123;&#125;, &amp;block)</div><div class="line">.post(url, payload, headers = &#123;&#125;, &amp;block)</div><div class="line">.put(url, payload, headers = &#123;&#125;, &amp;block)</div><div class="line">.delete(url, headers = &#123;&#125;, &amp;block)</div></pre></td></tr></table></figure>
<p>会发现四个verb请求都带有headers，block，但是这两个参数都不是必填的。比如<code>get</code>， 只给一个URL就满足了。</p>
<p>在<a href="https://github.com/rest-client/rest-client" target="_blank" rel="external">GitHub</a>库上有相关的实例，长这样：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1flbgi7h7mgj30oh07r407.jpg" alt=""></p>
<p>用起来很简单，那么在ruby中如何封装呢？比如有个图书model，我想要对某个书进行修改，使用put时，就要传递至少三个参数，冗长的URL表明是哪本书，你的登录信息，比如sessionId, 要更新的内容。类似这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">RestClient.post &apos;http://book.com/books/bookid&apos;, &#123;:sessionId =&gt; &apos;XXXXXXXX&apos;, :token =&gt; &quot;xxxx&quot;&#125;,&#123;&quot;name&quot;: &quot;XXX&quot;, &quot;description:&quot; &quot;XXXXX&quot; .......&#125;</div></pre></td></tr></table></figure>
<p>代码看着很不整洁，如何改进？</p>
<p>别急，先来看看在ruby中如何实现全局调用一个method。</p>
<h4 id="call-method-from-the-global-scope"><a href="#call-method-from-the-global-scope" class="headerlink" title="call method from the global scope"></a>call method from the global scope</h4><p>比如你定义了method C</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">C</span><span class="params">(name)</span></span></div><div class="line">	puts <span class="string">"hello, <span class="subst">#&#123;name&#125;</span>"</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>你想要在专案的多个文件中均可以调用这个method C，怎么实现？</p>
<p>使用module，这么来，在文件A.rb中，放入如下内容：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">A</span></span></div><div class="line">	<span class="class"><span class="keyword">module</span> <span class="title">B</span></span></div><div class="line">		<span class="function"><span class="keyword">def</span> <span class="title">C</span><span class="params">(name)</span></span></div><div class="line">			puts <span class="string">"hello, <span class="subst">#&#123;name&#125;</span>"</span></div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这时候，你引用C，需要写成A::B.C， 呃，这不是我们想要的结果，继续优化。</p>
<p>在Ruby中，任何一个method都绑定了一个对象。当我们调用比较常见的method，比如<code>puts</code>， <code>require</code>时，其实我们是在调用<code>main.puts</code>, <code>main.require</code>, 也就是它们有一个默认的object，叫做main。</p>
<p>那我们也想给C挂上这样的object，让它也可以像puts一样被直接调用，怎么做？</p>
<p>让Object这个class中，包含我们的A::B即可，修改文件A.rb：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">A</span></span></div><div class="line">	<span class="class"><span class="keyword">module</span> <span class="title">B</span></span></div><div class="line">		<span class="function"><span class="keyword">def</span> <span class="title">C</span><span class="params">(name)</span></span></div><div class="line">			puts <span class="string">"hello, <span class="subst">#&#123;name&#125;</span>"</span></div><div class="line">		<span class="keyword">end</span></div><div class="line">	<span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Object</span></span></div><div class="line">	<span class="keyword">include</span> A::B</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这样当你在其他文件中，比如app.rb中调用C时，只要加上如下代码即可：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'A'</span> <span class="comment">#C定义的文件名</span></div><div class="line">extend A::B</div></pre></td></tr></table></figure>
<p>好，回到我们的restclient, 现在就很好做了。</p>
<h4 id="简化restclient的调用"><a href="#简化restclient的调用" class="headerlink" title="简化restclient的调用"></a>简化restclient的调用</h4><p>知道如何对method进行global 调用，我们可以这么玩。</p>
<p>新建<code>myclient.rb</code>文件，内容如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'rest-client'</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">MyClient</span></span></div><div class="line">  <span class="class"><span class="keyword">module</span> <span class="title">Client</span></span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>里面没有任何method，我们加上get。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'rest-client'</span></div><div class="line">$apiurl = <span class="symbol">http:</span>/<span class="regexp">/example.com/api</span>. <span class="comment">#这是你API的URL，请自行修改</span></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">MyClient</span></span></div><div class="line">  <span class="class"><span class="keyword">module</span> <span class="title">Client</span></span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(url, headers = <span class="literal">nil</span>)</span></span></div><div class="line">      response = RestClient.get(</div><div class="line">          $apiurl + url,</div><div class="line">          headers</div><div class="line">      )</div><div class="line">    <span class="keyword">end</span></div><div class="line">   <span class="keyword">end</span></div><div class="line"> <span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Object</span></span></div><div class="line">  <span class="keyword">include</span> MyClient::Client</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>这时，如果要在其他文件调用，比如app.rb文件中，使用get,就可以这么用了。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">require_relative <span class="string">'my_client'</span></div><div class="line">extend MyClient::Client</div><div class="line"></div><div class="line">......</div><div class="line">headers =  &#123;<span class="symbol">:<span class="string">'session'</span></span> =&gt; <span class="string">'XXXX'</span>&#125;</div><div class="line">get(<span class="string">"/books"</span>, headers)</div><div class="line">.....</div></pre></td></tr></table></figure>
<p>同样的，将post，put， delete 加入，补全代码，如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">require</span> <span class="string">'rest-client'</span></div><div class="line">$apiurl = <span class="symbol">http:</span>/<span class="regexp">/example.com/api</span>. <span class="comment">#这是你API的URL，请自行修改</span></div><div class="line"><span class="class"><span class="keyword">module</span> <span class="title">MyClient</span></span></div><div class="line">  <span class="class"><span class="keyword">module</span> <span class="title">Client</span></span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(url, headers = <span class="literal">nil</span>)</span></span></div><div class="line">      response = RestClient.get(</div><div class="line">          $apiurl + url,</div><div class="line">          headers</div><div class="line">      )</div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(url, payload, headers = <span class="literal">nil</span> )</span></span></div><div class="line">      response = RestClient.post(</div><div class="line">          $apiurl + url,</div><div class="line">          payload,</div><div class="line">          headers</div><div class="line">      )</div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(url, payload, headers = <span class="literal">nil</span> )</span></span></div><div class="line">      response = RestClient.put(</div><div class="line">          $apiurl + url,</div><div class="line">          payload,</div><div class="line">          headers</div><div class="line">      )</div><div class="line">    <span class="keyword">end</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(url, headers = <span class="literal">nil</span> )</span></span></div><div class="line">      response = RestClient.delete(</div><div class="line">          $apiurl + url,</div><div class="line">          headers</div><div class="line">      )</div><div class="line">    <span class="keyword">end</span></div><div class="line">  <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Object</span></span></div><div class="line">  <span class="keyword">include</span> MyClient::Client</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>搞定，可以欢快地调用啦！！</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://stackoverflow.com/questions/18964016/how-can-i-add-a-method-to-the-global-scope-in-ruby" target="_blank" rel="external">How can I add a method to the global scope in Ruby?</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/07/how-to-run-the-feature-you-want/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/07/how-to-run-the-feature-you-want/" itemprop="url">
                  如何在cucumber中运行指定的feature？
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-07T22:56:29+08:00">
                2017-11-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cucumber/" itemprop="url" rel="index">
                    <span itemprop="name">Cucumber</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/07/how-to-run-the-feature-you-want/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/07/how-to-run-the-feature-you-want/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>只运行指定的feature时，有两种方法。</p>
<ul>
<li>可以类似RSpec那样，指定文件位置 ，比如 <code>cucumber features/your_feature.feature</code></li>
<li>可以添加tag</li>
</ul>
<p>比如：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@approved @car_buy</div><div class="line"></div><div class="line">　　<span class="symbol">Feature:</span> Car Buy</div><div class="line"></div><div class="line">        　　@wip</div><div class="line"></div><div class="line">        　　<span class="symbol">Scenario:</span> Buy a car <span class="keyword">in</span> store</div></pre></td></tr></table></figure>
<p>　　一个Scenario会继承指定给Feature的tags，所以在上面的例子中，Scenario有三个tags：@approved @car_buy @wip.  </p>
<p>调用时，使用<code>cucumber  --tags tag_name</code>。</p>
<p>比如运行feature，终端输入：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cucumber  --tags @car_buy</div></pre></td></tr></table></figure>
<p>使用tag的好处是可以细化到scenario。比如上例， 就可以使用命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cucumber –tags @wip</div></pre></td></tr></table></figure>
<p>来运行你想要的那部分Scenario.</p>
<p>插一句：cucumber默认加载<code>features/support/.</code>. 即support下的所有文件。</p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="http://www.cnblogs.com/puresoul/archive/2011/12/28/2305160.html" target="_blank" rel="external">cucumber 入门之Gherkin</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/03/cucumber-first-try/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/03/cucumber-first-try/" itemprop="url">
                  初尝Cucumber
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-03T21:33:56+08:00">
                2017-11-03
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cucumber/" itemprop="url" rel="index">
                    <span itemprop="name">Cucumber</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/03/cucumber-first-try/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/03/cucumber-first-try/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="写在前面"><a href="#写在前面" class="headerlink" title="写在前面"></a>写在前面</h4><p>使用cucumber 实作了个小小的例子，来感受一下小黄瓜的魅力：P。</p>
<h4 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h4><p>做了一个用于计算的专案，名为calculator。</p>
<p>calculator会做这样的事情：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">如果你输入了：</div><div class="line">2+2</div><div class="line">那么它会输出4</div><div class="line">如果你输入了：</div><div class="line">3*3</div><div class="line">那么它会输出9</div><div class="line">……</div></pre></td></tr></table></figure>
<p>其实就是一个简单的计算器。</p>
<p>好，我们开始吧。</p>
<p>终端运行:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">rails new calculator</div><div class="line">cd calculator</div></pre></td></tr></table></figure>
<p>建立专案calculator, 安装cucumber。参考：<a href="https://github.com/cucumber/cucumber-rails/blob/master/README.md" target="_blank" rel="external">Cucumber-Rails</a></p>
<p>在gemfile文件中添加 cucumber-rails：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fl533xnblyj30fm037t90.jpg" alt=""></p>
<p>database_cleaner这个gem是用来清理测试数据的，可加可不加，不过建议添加。</p>
<p>终端运行：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">bundle install</div><div class="line">rails g cucumber:install</div></pre></td></tr></table></figure>
<p>会自动生成一些文件：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tKfTcgy1fl53d5jnsaj30oq06ota5.jpg" alt=""></p>
<p>它帮我们生成好了features文件夹， 还有step_definitions.</p>
<p>让我们删除rails自带的test:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">rm -rf test</div></pre></td></tr></table></figure>
<p>终端输入cucumber试试：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fl53j79w13j30st072gng.jpg" alt=""></p>
<p>显示Deprecated了，针对这个问题我 Google了一下，你可以在cucumber-rails的<a href="https://github.com/cucumber/cucumber-rails/issues/346" target="_blank" rel="external">issues346</a>中看到, 但是没有找到解答，如果你留意，你会发现config文件下的<code>cucumber.yml</code>里面确实有<code>~@wip</code>, 如果你尝试着把所有的<code>~@wip</code> 替换成<code>not @tag</code> 会出现报错，鉴于它并不影响测试，所以你可以选择无视这些Deprecated：P</p>
<p>好，我们继续添加测试文件吧！新增<code>adding.feature</code>文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch features/adding.feature</div></pre></td></tr></table></figure>
<p><code>adding.feature</code>文件的内容如下：</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fl54cns0dnj30fx04aaab.jpg" alt=""></p>
<p>终端运行cucumber，显示如下：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fl54f04mr0j30zk0k9tdg.jpg" alt=""></p>
<p>会发现报错了，我们并没有定义step_definitions来告诉cucumber如何将这些直白的英文转换成专案中具体的action。但是，你也会发现小黄瓜贴心的地方，它告诉你step definitions里面要加一些snippets。</p>
<p>新建<code>features/step_definitions/calculator_steps.rb</code> 文件，文件内容如下：</p>
<p>【其实就是复制了它告诉我们的代码：P】</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fl54onlhmaj30g605rmy1.jpg" alt=""></p>
<p>再次运行cucumber试试：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fl54qokbosj30j807kjse.jpg" alt=""></p>
<p>显示一个pending，2个skipped了，我们来修改一下<code>calculator_steps.rb</code>，让第一个step可以pass。</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Given(<span class="string">"the input &#123;string&#125;"</span>) <span class="keyword">do</span> <span class="params">|string|</span></div><div class="line">  @input = string</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">When(<span class="string">"the calculator is run"</span>) <span class="keyword">do</span></div><div class="line">  pending <span class="comment"># Write code here that turns the phrase above into concrete actions</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">Then(<span class="string">"the output should be &#123;string&#125;"</span>) <span class="keyword">do</span> <span class="params">|string|</span></div><div class="line">  pending <span class="comment"># Write code here that turns the phrase above into concrete actions</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>运行cucumber，step1 pass.</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fl54vc0mf4j30kk07g3zj.jpg" alt=""></p>
<p>第二个step pending，Oops，我们继续。</p>
<p>这里可以梳理一下，第一步是input，最后是output，所以第二步应当是调用了method进行计算。好，我们添加一个ruby文件: calc.rb, 修改<code>calculator_steps.rb</code>，如下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Given(<span class="string">"the input &#123;string&#125;"</span>) <span class="keyword">do</span> <span class="params">|string|</span></div><div class="line">  @input = string</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">When(<span class="string">"the calculator is run"</span>) <span class="keyword">do</span></div><div class="line">  @output = <span class="string">`ruby calc.rb <span class="subst">#&#123;@input&#125;</span>`</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">Then(<span class="string">"the output should be &#123;string&#125;"</span>) <span class="keyword">do</span> <span class="params">|string|</span></div><div class="line">  pending <span class="comment"># Write code here that turns the phrase above into concrete actions</span></div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>运行cucumber，step2 pass.</p>
<p><img src="https://ws1.sinaimg.cn/large/006tKfTcgy1fl56z0meapj30ma07jq43.jpg" alt=""></p>
<p>注意到这里<code>calc.rb</code>还只是一个空文件，而且需要注意<code>calc.rb</code>是在根目录下。</p>
<p>继续修改<code>calculator_steps.rb</code>, 让第三个step pass：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Given(<span class="string">"the input &#123;string&#125;"</span>) <span class="keyword">do</span> <span class="params">|string|</span></div><div class="line">  @input = string</div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">When(<span class="string">"the calculator is run"</span>) <span class="keyword">do</span></div><div class="line">  @output = <span class="string">`ruby calc.rb <span class="subst">#&#123;@input&#125;</span>`</span></div><div class="line"><span class="keyword">end</span></div><div class="line"></div><div class="line">Then(<span class="string">"the output should be &#123;string&#125;"</span>) <span class="keyword">do</span> <span class="params">|string|</span></div><div class="line">  expect(@output).to eq string</div><div class="line"><span class="keyword">end</span></div></pre></td></tr></table></figure>
<p>在<code>calc.rb</code>中加入一行，使得output等于预期:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">print eval (ARGV[0])</div></pre></td></tr></table></figure>
<p>不了解eval的用法？👉戳这里<a href="https://ruby-hacking-guide.github.io/anyeval.html" target="_blank" rel="external">Dynamic evaluation</a></p>
<p>简单来说，这里input是”2 + 2”，那么eval(input)就是会4.</p>
<p>这时继续运行cucumber，出现这样的报错：</p>
<p><img src="https://ws3.sinaimg.cn/large/006tKfTcgy1fl5763tsrqj30mg084jsm.jpg" alt=""></p>
<p>显示except是undefined method，那是由于没有安装RSpec，在gemfile中加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gem &apos;rspec-rails&apos;</div></pre></td></tr></table></figure>
<p>然后<code>bundle install</code>，再次运行<code>cucumber</code>，Pass！</p>
<p><img src="https://ws2.sinaimg.cn/large/006tKfTcgy1fl579bi1l5j30mf04r3yx.jpg" alt=""></p>
<p>整个流程算是走完了。</p>
<p>以上就是一个cucumber测试的基本流程了。</p>
<p>cucumber的整个语法结构有个名字叫做<a href="https://github.com/cucumber/cucumber/wiki/Gherkin" target="_blank" rel="external">Gherkin</a>，例子中我们的<code>add.feature</code>就是遵守着Gherkin的语法。</p>
<p>Gherkin的大致结构类似这样：</p>
<p><img src="https://ws4.sinaimg.cn/large/006tNc79gy1fl57tq18wej30av03474i.jpg" alt=""></p>
<h4 id="The-End"><a href="#The-End" class="headerlink" title="The End"></a>The End</h4><p>实作的时候还是踩了些坑的，看报错却又找不到哪里出问题，看stack overflow也是一脸懵逼，这里略去一万字的吐糟……</p>
<p>推荐：</p>
<p><a href="https://forums.pragprog.com/forums/166" target="_blank" rel="external">the cucumber book‘s forums</a></p>
<p><a href="https://book.douban.com/subject/24843412/" target="_blank" rel="external">Cucumber：行为驱动开发指南</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://lupeipei.github.io/2017/11/02/cucumber-intro-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lucia">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lucia">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/02/cucumber-intro-1/" itemprop="url">
                  对Cucumber的一点理解
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-02T18:28:12+08:00">
                2017-11-02
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Cucumber/" itemprop="url" rel="index">
                    <span itemprop="name">Cucumber</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2017/11/02/cucumber-intro-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2017/11/02/cucumber-intro-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p><a href="https://cucumber.io/" target="_blank" rel="external">Cucumber</a>是BDD测试中的明星。</p>
<h4 id="关键字"><a href="#关键字" class="headerlink" title="关键字"></a>关键字</h4><p>Csucumber中的几个关键字：</p>
<p><strong>feature, scenario, given, when, then,  and,  but</strong></p>
<p>简单说说这些关键字的含义。</p>
<p>Feature：你可以把它看作是一个user story</p>
<p>scenario用于描述一个简单的场景。</p>
<p>一个feature可以有1个或者多个scenario。</p>
<p>一个scenario可以有3～8个steps。</p>
<p>其中，steps的定义类似于Ruby中method的定义。</p>
<p>step中的5个关键字：</p>
<ul>
<li>Given : 表示事件发生之前的状态， preconditions。</li>
<li>When： 表示事件本身，比如用户push 了一个button</li>
<li>Then：表示事件发生后的预期结果，比如push了一个button，要跳转到某个特定的页面</li>
<li>And &amp; But：用来延续之前的steps</li>
</ul>
<h4 id="用例"><a href="#用例" class="headerlink" title="用例"></a>用例</h4><p>看个例子：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">Feature:</span> user can manually add movie</div><div class="line"></div><div class="line"><span class="symbol">Scenario:</span> Add a movie</div><div class="line">	Given I am on the RottenPotatoes home page</div><div class="line">	When I follow <span class="string">"Add new movie"</span></div><div class="line">	Then I should be on the Create New Movie page</div><div class="line">	<span class="keyword">when</span> I fill <span class="keyword">in</span> <span class="string">"Title"</span> with <span class="string">"Men In Black"</span></div><div class="line">	And I select <span class="string">"PG-13"</span> from <span class="string">"Rating"</span></div><div class="line">	And I press <span class="string">"Save changes"</span></div><div class="line">	Then I shoud be on the RottenPotatoes home page</div><div class="line">	And I should see <span class="string">"Men in Black"</span></div></pre></td></tr></table></figure>
<p>这里测试一个feature，用户可以手动添加电影，添加的电影会在首页显示，表明添加成功。</p>
<p>具体的steps是这样的：</p>
<p>Given：用户在烂番茄主页，<strong>这是precondition</strong></p>
<p>When：用户点击新增电影，<strong>这是事件本身</strong></p>
<p>Then：用户应该会跳转到新建电影的页面，<strong>这是事件发生后的预期结果</strong></p>
<p>When：电影有title字段，用户将“Men in Black” 填入到title中，<strong>这是事件本身</strong></p>
<p>And：用户在星级中选择了“PG-13”，<strong>这是上一步的延续</strong></p>
<p>And：用户按下“保存”，<strong>继续延续上一步</strong></p>
<p>Then：用户应该跳转回烂番茄首页，<strong>这是事件发生后的预期结果</strong></p>
<p>And：用户应该看到“Men in Black”，<strong>这是上一步结果的延续</strong></p>
<p>此外，用cucumber去测试的一个好处是，它会提示你如何做可以让测试通过。</p>
<p>再看一个实例，看看如何DRY：P。</p>
<p>用户在TMDb首页搜索movie，可能出现的两种结果: 搜索到该影片(happy path)，没有搜索到(bad path)</p>
<p>测试文件长这样：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">Feature:</span> User can add movie by searching <span class="keyword">in</span> The Movie</div><div class="line">	Database(TMDb)</div><div class="line">	As a movie fan</div><div class="line">	so that I can add new movies without manual tedium</div><div class="line">	I want to add movies by looking up their details <span class="keyword">in</span> TMDb</div><div class="line"><span class="symbol">Scenario:</span> Try to add nonexistent movie(sad path)</div><div class="line">	Given I am on the RottenPotatoes home page</div><div class="line">	Then I should see <span class="string">"Search TMDb for a movie"</span></div><div class="line">	When I fill <span class="keyword">in</span> <span class="string">"Search Terms"</span> with <span class="string">"Movie that Does Not Exist"</span></div><div class="line">	And I press <span class="string">"Search TMDb"</span></div><div class="line">	Then I should be on the RottenPotatoes home page</div><div class="line">	And I should see <span class="string">"Movie That Does Not Exist"</span> was <span class="keyword">not</span> found <span class="keyword">in</span> TMDb</div><div class="line"><span class="symbol">Scenario:</span> Try to add nonexistent movie(happy path)</div><div class="line">	Given I am on the RottenPotatoes home page</div><div class="line">	Then I should see <span class="string">"Search TMDb for a movie"</span></div><div class="line">	When I fill <span class="keyword">in</span> <span class="string">"Search Terms"</span> with <span class="string">"Inception"</span></div><div class="line">	And I press <span class="string">"Search TMDb"</span></div><div class="line">	Then I should be on the RottenPotatoes home page</div><div class="line">	And I should see <span class="string">"Inception"</span></div></pre></td></tr></table></figure>
<p>其中，sad path ，happy path都有6个 steps，两者的前两个steps是一样的，how to DRY it?</p>
<p>这里用到<strong>background</strong>，我的理解是background类似于RSpec中的before。</p>
<p>我们重构一下：</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">Feature:</span> User can add movie by searching <span class="keyword">in</span> The Movie</div><div class="line">	Database(TMDb)</div><div class="line">	As a movie fan</div><div class="line">	so that I can add new movies without manual tedium</div><div class="line">	I want to add movies by looking up their details <span class="keyword">in</span> TMDb</div><div class="line"><span class="symbol">Background:</span> Start from the Search form on the home page</div><div class="line">			Given I am on the RottenPotatoes home page</div><div class="line">			Then I should see <span class="string">"Search TMDb for a movie"</span></div><div class="line"><span class="symbol">Scenario:</span> Try to add nonexistent movie(sad path)</div><div class="line">	When I fill <span class="keyword">in</span> <span class="string">"Search Terms"</span> with <span class="string">"Movie that Does Not Exist"</span></div><div class="line">	And I press <span class="string">"Search TMDb"</span></div><div class="line">	Then I should be on the RottenPotatoes home page</div><div class="line">	And I should see <span class="string">"Movie That Does Not Exist"</span> was <span class="keyword">not</span> found <span class="keyword">in</span> TMDb</div><div class="line"><span class="symbol">Scenario:</span> Try to add nonexistent movie(happy path)</div><div class="line">	When I fill <span class="keyword">in</span> <span class="string">"Search Terms"</span> with <span class="string">"Inception"</span></div><div class="line">	And I press <span class="string">"Search TMDb"</span></div><div class="line">	Then I should be on the RottenPotatoes home page</div><div class="line">	And I should see <span class="string">"Inception"</span></div></pre></td></tr></table></figure>
<p>OK，大功告成。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="Lucia" />
          <p class="site-author-name" itemprop="name">Lucia</p>
           
              <p class="site-description motion-element" itemprop="description">曲肱而枕</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">63</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Lupeipei" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.facebook.com/Luciapeipei" target="_blank" title="Facebook">
                  
                    <i class="fa fa-fw fa-facebook"></i>
                  
                  Facebook
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lucia</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i>
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      
    </span>
  
</div>


        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  


  

    
      <script id="dsq-count-scr" src="https://https-lupeipei-github-io.disqus.com/count.js" async></script>
    

    

  




	





  





  





  






  





  

  

  

  

</body>
</html>
